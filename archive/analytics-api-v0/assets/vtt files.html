<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><meta name="robots" content="noindex">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title id="bclPageTitle">VTT files</title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1187.37">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 16.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 20.0px 0.0px; font: 30.0px Helvetica}
    p.p3 {margin: 0.0px 0.0px 19.0px 0.0px; font: 24.0px Helvetica; color: #444444}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px Helvetica}
    p.p5 {margin: 0.0px 0.0px 13.0px 0.0px; font: 13.0px Helvetica}
    p.p6 {margin: 0.0px 0.0px 8.0px 0.0px; font: 16.0px Helvetica; min-height: 19.0px}
    p.p7 {margin: 0.0px 0.0px 17.0px 60.0px; font: 18.0px Helvetica}
    p.p8 {margin: 0.0px 0.0px 16.0px 0.0px; font: 16.0px Helvetica}
    p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Courier}
    p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Courier; min-height: 16.0px}
    p.p14 {margin: 0.0px 0.0px 19.0px 0.0px; font: 19.0px Helvetica; color: #444444}
    p.p15 {margin: 0.0px 0.0px 16.0px 0.0px; font: 16.0px Helvetica; background-color: #fcfaee}
    p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Courier; background-color: #fcfaee}
    p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Courier; background-color: #fcfaee; min-height: 16.0px}
    p.p18 {margin: 0.0px 0.0px 16.0px 0.0px; font: 16.0px Helvetica; color: #e52100}
    p.p20 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px Helvetica; color: #22bb22; background-color: #e9fbe9}
    p.p21 {margin: 0.0px 0.0px 16.0px 0.0px; font: 16.0px Helvetica; background-color: #e9fbe9}
    p.p23 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 16.0px Helvetica}
    p.p24 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Courier; color: #ff4501}
    p.p25 {margin: 0.0px 0.0px 21.0px 0.0px; font: 16.0px Helvetica; color: #444444}
    p.p26 {margin: 0.0px 0.0px 22.0px 0.0px; font: 13.0px Helvetica}
    p.p27 {margin: 0.0px 0.0px 19.0px 0.0px; font: 24.0px Helvetica}
    p.p28 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px Courier; background-color: #eeeeee}
    p.p29 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px Helvetica; background-color: #d9e6f8}
    p.p30 {margin: 0.0px 0.0px 16.0px 0.0px; font: 16.0px Helvetica; background-color: #d9e6f8}
    p.p31 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 13.0px Courier; color: #ff4501}
    p.p32 {margin: 0.0px 0.0px 19.0px 0.0px; font: 16.0px Courier; color: #ff4501}
    li.li4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px Helvetica}
    li.li8 {margin: 0.0px 0.0px 16.0px 0.0px; font: 16.0px Helvetica}
    li.li9 {margin: 0.0px 0.0px 4.0px 0.0px; font: 16.0px Helvetica; color: #0326cc}
    li.li10 {margin: 0.0px 0.0px 4.0px 0.0px; font: 16.0px Helvetica}
    li.li11 {margin: 0.0px 0.0px 4.0px 0.0px; font: 13.0px Courier; color: #ff4501}
    li.li18 {margin: 0.0px 0.0px 16.0px 0.0px; font: 16.0px Helvetica; color: #e52100}
    li.li19 {margin: 0.0px 0.0px 4.0px 0.0px; font: 13.0px Courier}
    li.li22 {margin: 0.0px 0.0px 4.0px 0.0px; font: 16.0px Helvetica; background-color: #fcfaee}
    li.li23 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 16.0px Helvetica}
    li.li24 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Courier; color: #ff4501}
    span.s1 {text-decoration: underline}
    span.s2 {color: #000000}
    span.s3 {color: #0326cc}
    span.s4 {font: 16.0px Helvetica; color: #000000}
    span.s5 {font: 13.0px Courier; color: #ff4501}
    span.s6 {text-decoration: underline ; color: #0326cc}
    span.s7 {color: #ff4501}
    span.s8 {font: 16.0px Helvetica}
    span.s9 {font: 13.0px Helvetica}
    span.s10 {font: 16.0px 'Lucida Grande'}
    span.s11 {color: #22bb22; background-color: #e9fbe9}
    span.s12 {background-color: #e9fbe9}
    span.s13 {font: 13.0px Courier}
    span.s14 {color: #444444}
    span.s15 {font: 19.0px Helvetica; color: #444444}
    table.t1 {border-collapse: collapse}
    td.td1 {width: 105.0px; border-style: solid; border-width: 0.0px 3.0px 1.0px 3.0px; border-color: transparent #000000 #000000 #000000; padding: 3.0px 3.0px 3.0px 3.0px}
    td.td2 {width: 1080.0px; border-style: solid; border-width: 0.0px 3.0px 1.0px 3.0px; border-color: transparent #000000 #000000 #000000; padding: 3.0px 3.0px 3.0px 3.0px}
    td.td3 {width: 186.0px; border-style: solid; border-width: 0.0px 3.0px 1.0px 3.0px; border-color: transparent #000000 #000000 #000000; padding: 3.0px 3.0px 3.0px 3.0px}
    td.td4 {width: 123.0px; border-style: solid; border-width: 0.0px 3.0px 1.0px 3.0px; border-color: transparent #000000 #000000 #000000; padding: 3.0px 3.0px 3.0px 3.0px}
    td.td5 {width: 423.0px; border-style: solid; border-width: 0.0px 3.0px 1.0px 3.0px; border-color: transparent #000000 #000000 #000000; padding: 3.0px 3.0px 3.0px 3.0px}
    td.td6 {width: 228.0px; border-style: solid; border-width: 0.0px 3.0px 1.0px 3.0px; border-color: transparent #000000 #000000 #000000; padding: 3.0px 3.0px 3.0px 3.0px}
    td.td7 {width: 138.0px; border-style: solid; border-width: 0.0px 3.0px 1.0px 3.0px; border-color: transparent #000000 #000000 #000000; padding: 3.0px 3.0px 3.0px 3.0px}
    td.td8 {width: 85.0px; border-style: solid; border-width: 0.0px 3.0px 1.0px 3.0px; border-color: transparent #000000 #000000 #000000; padding: 3.0px 3.0px 3.0px 3.0px}
    ol.ol1 {list-style-type: decimal}
    ul.ul1 {list-style-type: none}
    ul.ul2 {list-style-type: disc}
    ul.ul3 {list-style-type: square}
    ul.ul4 {list-style-type: circle}
  </style>
</head>
<body>
<p class="p1"><a href="//www.w3.org/"><img src="vtt%20files.w3c_home.png" alt="w3c_home.png"></a></p>
<p class="p2"><b>WebVTT: The Web Video Text Tracks Format</b></p>
<p class="p3"><b>Draft Community Group Specification 15 April 2013</b></p>
<p class="p4"><b>Latest editor's draft:</b></p>
<p class="p4"><span class="s1"><a href="https://dvcs.w3.org/hg/text-tracks/raw-file/default/webvtt/webvtt.html">https://dvcs.w3.org/hg/text-tracks/raw-file/default/webvtt/webvtt.html</a></span></p>
<p class="p4"><b>Editors:</b></p>
<p class="p4"><span class="s1"><a href="mailto:silviapfeiffer1@gmail.com">Silvia Pfeiffer</a></span>, <a href="//nicta.com.au/"><span class="s1">NICTA</span></a></p>
<p class="p4"><span class="s1"><a href="mailto:ian@hixie.ch">Ian Hickson</a></span>, <a href="//google.com/"><span class="s1">Google</span></a> (previous editor)</p>
<p class="p5"><span class="s1"><a href="//www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a></span> © 2011-2013 the Contributors to the WebVTT: The Web Video Text Tracks Format Specification, published by the <a href="//www.w3.org/community/texttracks/"><span class="s1">Text Tracks Community Group</span></a> under the <a href="https://www.w3.org/community/about/agreements/cla/"><span class="s1">W3C Community Contributor License Agreement (CLA)</span></a>. A human-readable <a href="//www.w3.org/community/about/agreements/cla-deed/"><span class="s1">summary</span></a> is available.</p>
<p class="p6"><br></p>
<p class="p3"><b>Abstract</b></p>
<p class="p7">This is the specification of WebVTT, the Web Video Text Tracks format.</p>
<p class="p3"><b>Status of This Document</b></p>
<p class="p8">This specification was published by the <a href="//www.w3.org/community/texttracks/"><span class="s1">Text Tracks Community Group</span></a>. It is not a W3C Standard nor is it on the W3C Standards Track. Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/"><span class="s1">W3C Community Contributor License Agreement (CLA)</span></a> there is a limited opt-out and other conditions apply. Learn more about <a href="//www.w3.org/community/"><span class="s1">W3C Community and Business Groups</span></a>.</p>
<p class="p8">This specification was originally created by the WHATWG as a Living Standard and last published at <a href="//dev.w3.org/html5/webvtt/"><span class="s1">http://dev.w3.org/html5/webvtt/</span></a>.</p>
<p class="p3"><b>Table of Contents</b></p>
<ul class="ul1">
  <li class="li9"><span class="s2">1. </span>Introduction</li>
  <ul class="ul1">
    <li class="li9"><span class="s2">1.1 </span>Cues with multiple lines</li>
    <li class="li9"><span class="s2">1.2 </span>Comments</li>
    <li class="li9"><span class="s2">1.3 </span>Other features</li>
  </ul>
  <li class="li9"><span class="s2">2. </span>Conformance</li>
  <ul class="ul1">
    <li class="li9"><span class="s2">2.1 </span>Dependencies</li>
  </ul>
  <li class="li9"><span class="s2">3. </span>Data model</li>
  <li class="li9"><span class="s2">4. </span>The <span class="s2">WebVTT </span>file format</li>
  <ul class="ul1">
    <li class="li10">4.1 <span class="s3">Syntax</span></li>
    <li class="li9"><span class="s2">4.2 </span>Parsing</li>
    <li class="li9"><span class="s2">4.3 WebVTT </span>cue text parsing rules</li>
    <li class="li9"><span class="s2">4.4 WebVTT </span>cue text DOM construction rules</li>
  </ul>
  <li class="li9"><span class="s2">5. </span>Rendering</li>
  <ul class="ul1">
    <li class="li9"><span class="s2">5.1 </span>Cues in isolation</li>
    <li class="li9"><span class="s2">5.2 </span>Cues with video</li>
    <ul class="ul1">
      <li class="li9"><span class="s2">5.2.1 </span>Processing model</li>
      <li class="li9"><span class="s2">5.2.2 </span>Applying CSS properties to <span class="s2">WebVTT </span>Node Objects</li>
      <li class="li9"><span class="s2">5.2.3 </span>CSS extensions</li>
      <ul class="ul1">
        <li class="li9"><span class="s2">5.2.3.1 </span>The '::cue' pseudo-element</li>
        <li class="li9"><span class="s2">5.2.3.2 </span>The ':past' and ':future' pseudo-classes</li>
      </ul>
    </ul>
  </ul>
  <li class="li10">6. WebVTT <span class="s3">API</span></li>
  <li class="li9"><span class="s2">7. </span>IANA considerations</li>
  <ul class="ul1">
    <li class="li11"><span class="s4">7.1 </span>text/vtt</li>
  </ul>
  <li class="li9"><span class="s2">8. </span>References</li>
  <li class="li9"><span class="s2">9. </span>Acknowledgements</li>
</ul>
<p class="p3"><b>1. Introduction</b></p>
<p class="p8"><i>This section is non-normative.</i></p>
<p class="p8">The <b><i>WebVTT</i></b> (Web Video Text Tracks) format is intended for marking up external text track resources.</p>
<p class="p8">The main use for WebVTT files is captioning video content. Here is a sample file that captions an interview:</p>
<p class="p12">WEBVTT</p>
<p class="p13"><br></p>
<p class="p12">00:11.000 --&gt; 00:13.000</p>
<p class="p12">&lt;v Roger Bingham&gt;We are in New York City</p>
<p class="p13"><br></p>
<p class="p12">00:13.000 --&gt; 00:16.000</p>
<p class="p12">&lt;v Roger Bingham&gt;We're actually at the Lucern Hotel, just down the street</p>
<p class="p13"><br></p>
<p class="p12">00:16.000 --&gt; 00:18.000</p>
<p class="p12">&lt;v Roger Bingham&gt;from the American Museum of Natural History</p>
<p class="p13"><br></p>
<p class="p12">00:18.000 --&gt; 00:20.000</p>
<p class="p12">&lt;v Roger Bingham&gt;And with me is Neil deGrasse Tyson</p>
<p class="p13"><br></p>
<p class="p12">00:20.000 --&gt; 00:22.000</p>
<p class="p12">&lt;v Roger Bingham&gt;Astrophysicist, Director of the Hayden Planetarium</p>
<p class="p13"><br></p>
<p class="p12">00:22.000 --&gt; 00:24.000</p>
<p class="p12">&lt;v Roger Bingham&gt;at the AMNH.</p>
<p class="p13"><br></p>
<p class="p12">00:24.000 --&gt; 00:26.000</p>
<p class="p12">&lt;v Roger Bingham&gt;Thank you for walking down here.</p>
<p class="p13"><br></p>
<p class="p12">00:27.000 --&gt; 00:30.000</p>
<p class="p12">&lt;v Roger Bingham&gt;And I want to do a follow-up on the last conversation we did.</p>
<p class="p13"><br></p>
<p class="p12">00:30.000 --&gt; 00:31.500 align:end size:50%</p>
<p class="p12">&lt;v Roger Bingham&gt;When we e-mailed—</p>
<p class="p13"><br></p>
<p class="p12">00:30.500 --&gt; 00:32.500 align:start size:50%</p>
<p class="p12">&lt;v Neil deGrasse Tyson&gt;Didn't we talk about enough in that conversation?</p>
<p class="p13"><br></p>
<p class="p12">00:32.000 --&gt; 00:35.500 align:end size:50%</p>
<p class="p12">&lt;v Roger Bingham&gt;No! No no no no; 'cos 'cos obviously 'cos</p>
<p class="p13"><br></p>
<p class="p12">00:32.500 --&gt; 00:33.500 align:start size:50%</p>
<p class="p12">&lt;v Neil deGrasse Tyson&gt;&lt;i&gt;Laughs&lt;/i&gt;</p>
<p class="p13"><br></p>
<p class="p12">00:35.500 --&gt; 00:38.000</p>
<p class="p12">&lt;v Roger Bingham&gt;You know I'm so excited my glasses are falling off here.</p>
<p class="p14"><b>1.1 Cues with multiple lines</b></p>
<p class="p8"><i>This section is non-normative.</i></p>
<p class="p8">Line breaks in cues are honored. User agents will also insert extra line breaks if necessary to fit the cue in the cue's width. In general, therefore, authors are encouraged to write cues all on one line except when a line break is definitely necessary, and to not manually line-wrap for aesthetic reasons alone.</p>
<p class="p15">These captions on a public service announcement video demonstrate line breaking:</p>
<p class="p16">WEBVTT</p>
<p class="p17"><br></p>
<p class="p16">00:01.000 --&gt; 00:04.000</p>
<p class="p16">Never drink liquid nitrogen.</p>
<p class="p17"><br></p>
<p class="p16">00:05.000 --&gt; 00:09.000</p>
<p class="p16">— It will perforate your stomach.</p>
<p class="p16">— You could die.</p>
<p class="p17"><br></p>
<p class="p16">00:10.000 --&gt; 00:14.000</p>
<p class="p16">The Organisation for Sample Public Service Announcements accepts no liability for the content of this advertisement, or for the consequences of any actions taken on the basis of the information provided.</p>
<p class="p15">The first cue is simple, it will probably just display on one line. The second will take two lines, one for each speaker. The third will wrap to fit the width of the video, possibly taking multiple lines. For example, the three cues could look like this:</p>
<p class="p16"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>Never drink liquid nitrogen.</p>
<p class="p17"><br></p>
<p class="p16"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span>— It will perforate your stomach.</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>— You could die.</p>
<p class="p17"><br></p>
<p class="p16"><span class="Apple-converted-space">&nbsp; &nbsp; </span>The Organisation for Sample Public Service</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; &nbsp; </span>Announcements accepts no liability for the</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; &nbsp; </span>content of this advertisement, or for the</p>
<p class="p16"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; </span>consequences of any actions taken on the</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span>basis of the information provided.</p>
<p class="p15">If the width of the cues is smaller, the first two cues could wrap as well, as in the following example. Note how the second cue's explicit line break is still honored, however:</p>
<p class="p16"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; </span>Never drink</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; &nbsp; </span>liquid nitrogen.</p>
<p class="p17"><br></p>
<p class="p16"><span class="Apple-converted-space">&nbsp; </span>— It will perforate</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; </span>your stomach.</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; &nbsp; </span>— You could die.</p>
<p class="p17"><br></p>
<p class="p16"><span class="Apple-converted-space">&nbsp; </span>The Organisation for</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; </span>Sample Public Service</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; </span>Announcements accepts</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; </span>no liability for the</p>
<p class="p16"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; </span>content of this</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; </span>advertisement, or for</p>
<p class="p16"><span class="Apple-converted-space">&nbsp;&nbsp; </span>the consequences of</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; </span>any actions taken on</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; &nbsp; </span>the basis of the</p>
<p class="p16"><span class="Apple-converted-space">&nbsp; </span>information provided.</p>
<p class="p15">Also notice how the wrapping is done so as to keep the line lengths balanced.</p>
<p class="p14"><b>1.2 Comments</b></p>
<p class="p8"><i>This section is non-normative.</i></p>
<p class="p8">Comments can be included in WebVTT files.</p>
<p class="p8">Comments are just blocks that start with the word "<span class="s5">NOTE</span>" (followed by a space or newline). A comment ends at the first blank line.</p>
<p class="p15">Here, a one-line comment is used to note a possible problem with a cue.</p>
<p class="p16">WEBVTT</p>
<p class="p17"><br></p>
<p class="p16">00:01.000 --&gt; 00:04.000</p>
<p class="p16">Never drink liquid nitrogen.</p>
<p class="p17"><br></p>
<p class="p16">NOTE I'm not sure the timing is right on the following cue.</p>
<p class="p17"><br></p>
<p class="p16">00:05.000 --&gt; 00:09.000</p>
<p class="p16">— It will perforate your stomach.</p>
<p class="p16">— You could die.</p>
<p class="p15">In this example, the author has written many comments.</p>
<p class="p16">WEBVTT</p>
<p class="p17"><br></p>
<p class="p16">NOTE</p>
<p class="p16">This file was written by Jill. I hope</p>
<p class="p16">you enjoy reading it. Some things to</p>
<p class="p16">bear in mind:</p>
<p class="p16">- I was lip-reading, so the cues may</p>
<p class="p16">not be 100% accurate</p>
<p class="p16">- I didn't pay too close attention to</p>
<p class="p16">when the cues should start or end.</p>
<p class="p17"><br></p>
<p class="p16">00:01.000 --&gt; 00:04.000</p>
<p class="p16">Never drink liquid nitrogen.</p>
<p class="p17"><br></p>
<p class="p16">NOTE check next cue</p>
<p class="p17"><br></p>
<p class="p16">00:05.000 --&gt; 00:09.000</p>
<p class="p16">— It will perforate your stomach.</p>
<p class="p16">— You could die.</p>
<p class="p17"><br></p>
<p class="p16">NOTE end of file</p>
<p class="p14"><b>1.3 Other features</b></p>
<p class="p8"><i>This section is non-normative.</i></p>
<p class="p8">WebVTT also supports some less-often used features.</p>
<p class="p15">In this example, one of the cues has an identifier:</p>
<p class="p16">WEBVTT</p>
<p class="p17"><br></p>
<p class="p16">00:00.000 --&gt; 00:02.000</p>
<p class="p16">That's an, an, that's an L!</p>
<p class="p17"><br></p>
<p class="p16">transcription-credit</p>
<p class="p16">00:04.000 --&gt; 00:05.000</p>
<p class="p16">Transcribed by Celestials™</p>
<p class="p15">This allows a style sheet to specifically target that cue:</p>
<p class="p16">::cue(#transcription-credit) { color: red }</p>
<p class="p15">In this example, each cue says who is talking using voice spans. In the first cue, the span specifying the speaker is also annotated with two classes, "first" and "loud". In the third cue, there is also some italics text (not associated with a specific speaker). The last cue is annotated with just the class "loud".</p>
<p class="p16">WEBVTT</p>
<p class="p17"><br></p>
<p class="p16">00:00.000 --&gt; 00:02.000</p>
<p class="p16">&lt;v.first.loud Esme&gt;It's a blue apple tree!</p>
<p class="p17"><br></p>
<p class="p16">00:02.000 --&gt; 00:04.000</p>
<p class="p16">&lt;v Mary&gt;No way!</p>
<p class="p17"><br></p>
<p class="p16">00:04.000 --&gt; 00:06.000</p>
<p class="p16">&lt;v Esme&gt;Hee!&lt;/v&gt; &lt;i&gt;laughter&lt;/i&gt;</p>
<p class="p17"><br></p>
<p class="p16">00:06.000 --&gt; 00:08.000</p>
<p class="p16">&lt;v.loud Mary&gt;That's awesome!</p>
<p class="p15">Notice that as a special exception, the voice spans don't have to be closed if they cover the entire cue text.</p>
<p class="p15">Style sheets can style these spans:</p>
<p class="p16">::cue(v[voice="Esme"]) { color: blue }</p>
<p class="p16">::cue(v[voice="Mary"]) { color: green }</p>
<p class="p16">::cue(i) { font-style: italic }</p>
<p class="p16">::cue(.loud) { font-size: 2em }</p>
<p class="p3"><b>2. Conformance</b></p>
<p class="p18">This section remains to be written. In the meantime, please see the HTML standard. <span class="s6">[HTML5]</span></p>
<p class="p14"><b>2.1 Dependencies</b></p>
<p class="p8">This specification relies upon the following terms defined in the HTML standard. <span class="s6">[HTML5]</span></p>
<ul class="ul2">
  <li class="li10"><b><i>HTML elements</i></b></li>
  <li class="li10"><b><i>Script's document</i></b></li>
  <li class="li10"><b><i>Entry script</i></b></li>
  <li class="li10"><b><i>MIME type</i></b></li>
  <li class="li10"><b><i>UTF-8 decode</i></b></li>
  <li class="li10"><b><i>Case-sensitive</i></b></li>
  <li class="li10"><b><i>Collect a sequence of characters</i></b></li>
  <li class="li10"><b><i>ASCII digits</i></b></li>
  <li class="li10"><b><i>Alphanumeric ASCII characters</i></b></li>
  <li class="li10"><b><i>Space character</i></b></li>
  <li class="li10"><b><i>Skip whitespace</i></b></li>
  <li class="li10"><b><i>Split a string on spaces</i></b></li>
  <li class="li10"><b><i>HTML namespace</i></b></li>
  <li class="li10"><b><i>Media element</i></b></li>
  <li class="li10"><b><i>Current playback position</i></b></li>
  <li class="li10"><b><i>Expose a user interface to the user</i></b></li>
  <li class="li10"><b><i>List of text tracks</i></b></li>
  <li class="li10"><b><i>Text track</i></b></li>
  <li class="li10"><b><i>Text track kind</i></b></li>
  <li class="li10"><b><i>Text track mode</i></b></li>
  <li class="li10"><b><i>Text track showing</i></b></li>
  <li class="li10"><b><i>Text track cue</i></b></li>
  <li class="li10"><b><i>Text track list of cues</i></b></li>
  <li class="li10"><b><i>Text track cue order</i></b></li>
  <li class="li10"><b><i>Text track cue identifier</i></b></li>
  <li class="li10"><b><i>Text track cue start time</i></b></li>
  <li class="li10"><b><i>Text track cue end time</i></b></li>
  <li class="li10"><b><i>Text track cue pause-on-exit flag</i></b></li>
  <li class="li10"><b><i>Text track cue text</i></b></li>
  <li class="li10"><b><i>Text track cue active flag</i></b></li>
  <li class="li10"><b><i>Text track cue display state</i></b></li>
  <li class="li10"><b><i>Rules for updating the text track rendering</i></b></li>
  <li class="li10"><b><i>Rules for rendering the cue in isolation</i></b></li>
  <li class="li19"><span class="s7"><b><i></i></b></span><b><i>TextTrackCue</i></b><span class="s8"> interface</span></li>
</ul>
<p class="p3"><b>3. Data model</b></p>
<p class="p8">WebVTT cues are HTML text track cues that additionally consist of the following: <span class="s6">[HTML5]</span></p>
<p class="p4"><b><i>A writing direction</i></b></p>
<p class="p8">A writing direction, either <b><i>horizontal</i></b> (a line extends horizontally and is positioned vertically, with consecutive lines displayed below each other), <b><i>vertical growing left</i></b> (a line extends vertically and is positioned horizontally, with consecutive lines displayed to the left of each other), or <b><i>vertical growing right</i></b> (a line extends vertically and is positioned horizontally, with consecutive lines displayed to the right of each other).</p>
<p class="p8">If the writing direction is horizontal, then line position percentages are relative to the height of the video, and text position and size percentages are relative to the width of the video.</p>
<p class="p8">Otherwise, line position percentages are relative to the width of the video, and text position and size percentages are relative to the height of the video.</p>
<p class="p4"><b><i>A snap-to-lines flag</i></b></p>
<p class="p8">A boolean indicating whether the line's position is a line position (positioned to a multiple of the line dimensions of the first line of the cue), or whether it is a percentage of the dimension of the video.</p>
<p class="p8">Cues whose text track cue snap-to-lines flag is set will be placed within the title-safe area on user agents that use overscan. Cues with the flag unset will be positioned as requested (modulo overlap avoidance if multiple cues are in the same place).</p>
<p class="p4"><b><i>A line position</i></b></p>
<p class="p8">Either a number giving the position of the lines of the cue, to be interpreted as defined by the writing direction and snap-to-lines flag of the cue, or the special value <b><i>auto</i></b>, which means the position is to depend on the other active tracks.</p>
<p class="p8">A text track cue has a <b><i>text track cue computed line position</i></b> whose value is that returned by the following algorithm, which is defined in terms of the other aspects of the cue:</p>
<ol class="ol1">
  <li class="li8">If the text track cue line position is numeric, the text track cue snap-to-lines flag of the text track cue is not set, and the text track cue line position is negative or greater than 100, then return 100 and abort these steps.</li>
  <li class="li8">If the text track cue line position is numeric, return the value of the text track cue line position and abort these steps. (Either the text track cue snap-to-lines flag is set, so any value, not just those in the range 0..100, is valid, or the value is in the range 0..100 and is thus valid regardless of the value of that flag.)</li>
  <li class="li8">If the text track cue snap-to-lines flag of the text track cue is not set, return the value 100 and abort these steps. (The text track cue line position is the special value auto.)</li>
  <li class="li8">Let <i>cue</i> be the text track cue.</li>
  <li class="li8">If <i>cue</i> is not in a list of cues of a text track, or if that text track is not in the list of text tracks of a media element, return −1 and abort these steps.</li>
  <li class="li8">Let <i>track</i> be the text track whose list of cues the <i>cue</i> is in.</li>
  <li class="li8">Let <i>n</i> be the number of text tracks whose text track mode is showing and that are in the media element's list of text tracks before <i>track</i>.</li>
  <li class="li8">Increment <i>n</i> by one.</li>
  <li class="li8">Negate <i>n</i>.</li>
  <li class="li8">Return <i>n</i>.</li>
</ol>
<p class="p4"><b><i>A text position</i></b></p>
<p class="p8">A number giving the position of the text of the cue within each line, to be interpreted as a percentage of the video, as defined by the writing direction.</p>
<p class="p4"><b><i>A size</i></b></p>
<p class="p8">A number giving the size of the box within which the text of each line of the cue is to be aligned, to be interpreted as a percentage of the video, as defined by the writing direction.</p>
<p class="p4"><b><i>An alignment</i></b></p>
<p class="p8">An alignment for the text of each line of the cue, one of:</p>
<p class="p4"><b><i>Start alignment</i></b></p>
<p class="p4">The text is aligned towards its start side.</p>
<p class="p4"><b><i>Middle alignment</i></b></p>
<p class="p4">The text is aligned centered between its start and end sides.</p>
<p class="p4"><b><i>End alignment</i></b></p>
<p class="p4">The text is aligned towards its end side.</p>
<p class="p4"><b><i>Left alignment</i></b></p>
<p class="p4">The text is aligned to the left.</p>
<p class="p4"><b><i>Right alignment</i></b></p>
<p class="p4">The text is aligned to the right.</p>
<p class="p8">Which sides are the start and end sides depends on the Unicode bidirectional algorithm and the writing direction. <span class="s6">[BIDI]</span></p>
<p class="p8">The associated rules for updating the text track rendering of WebVTT text track cues are the rules for updating the display of WebVTT text tracks.</p>
<p class="p8">When a WebVTT text track cue whose active flag is set has its writing direction, snap-to-lines flag, line position, text position, size, alignment, or text change value, then the user agent must empty the text track cue display state, and then immediately run the text track's rules for updating the display of WebVTT text tracks.</p>
<p class="p3"><b>4. The </b><span class="s2"><b>WebVTT </b></span><b>file format</b></p>
<p class="p14"><b>4.1 Syntax</b></p>
<p class="p8">A <b><i>WebVTT file</i></b> must consist of a WebVTT file body encoded as UTF-8 and labeled with the MIME type <span class="s5">text/vtt</span>. <span class="s6">[RFC3629]</span></p>
<p class="p8">A <b><i>WebVTT file body</i></b> consists of the following components, in the following order:</p>
<ol class="ol1">
  <li class="li4">An optional U+FEFF BYTE ORDER MARK (BOM) character.</li>
  <li class="li4">The string "<span class="s5">WEBVTT</span>".</li>
  <li class="li4">Optionally, either a U+0020 SPACE character or a U+0009 CHARACTER TABULATION (tab) character followed by any number of characters that are not U+000A LINE FEED (LF) or U+000D CARRIAGE RETURN (CR) characters.</li>
  <li class="li4">Two or more WebVTT line terminators.</li>
  <li class="li4">Zero or more WebVTT cues and WebVTT comments separated from each other by two or more WebVTT line terminators.</li>
  <li class="li4">Zero or more WebVTT line terminators.</li>
</ol>
<p class="p8">A <b><i>WebVTT cue</i></b> consists of the following components, in the given order:</p>
<ol class="ol1">
  <li class="li4">Optionally, a WebVTT cue identifier followed by a WebVTT line terminator.</li>
  <li class="li4">WebVTT cue timings.</li>
  <li class="li4">Optionally, one or more U+0020 SPACE characters or U+0009 CHARACTER TABULATION (tab) characters followed by WebVTT cue settings.</li>
  <li class="li4">A WebVTT line terminator.</li>
  <li class="li4">The <b><i>cue payload</i></b>: either WebVTT cue text, WebVTT chapter title text, or WebVTT metadata text, but it must not contain the substring "<span class="s5">--&gt;</span>" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN).</li>
</ol>
<p class="p20">NOTE</p>
<p class="p21">A WebVTT cue corresponds to one piece of time-aligned text or data in the WebVTT file, for example one subtitle. The cue payload is the text or data associated with the cue.</p>
<p class="p8">WebVTT chapter title text is syntactically a subset of WebVTT cue text, and WebVTT cue text is syntactically a subset of WebVTT metadata text. Conformance checkers, when validating WebVTT files, may offer to restrict all cues to only having WebVTT chapter title text or WebVTT cue text as their cue payload; WebVTT metadata text cues are only useful for scripted applications (using the <span class="s5">metadata</span> text track kind).</p>
<p class="p8">A WebVTT file whose cues all have a cue payload that is WebVTT chapter title text is said to be a <b><i>WebVTT file using chapter title text</i></b>.</p>
<p class="p8">A WebVTT file whose cues all have a cue payload that is WebVTT cue text is said to be a <b><i>WebVTT file using cue text</i></b>. By definition, any file that is a WebVTT file using chapter title text is also a WebVTT file using cue text.</p>
<p class="p8">A <b><i>WebVTT comment</i></b> consists of the following components, in the given order:</p>
<ol class="ol1">
  <li class="li4">The string "<span class="s5">NOTE</span>".</li>
  <li class="li4">Optionally, the following components, in the given order:</li>
  <ol class="ol1">
    <li class="li4">Either:</li>
    <ul class="ul3">
      <li class="li10">A U+0020 SPACE character or U+0009 CHARACTER TABULATION (tab) character.</li>
      <li class="li10">A WebVTT line terminator.</li>
    </ul>
    <li class="li4">Any sequence of zero or more characters other than U+000A LINE FEED (LF) characters and U+000D CARRIAGE RETURN (CR) characters, each optionally separated from the next by a WebVTT line terminator, except that the entire resulting string must not contain the substring "<span class="s5">--&gt;</span>" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN).</li>
  </ol>
</ol>
<p class="p20">NOTE</p>
<p class="p21">A WebVTT comment is ignored by the parser.</p>
<p class="p8">A <b><i>WebVTT line terminator</i></b> consists of one of the following:</p>
<ul class="ul2">
  <li class="li10">A U+000D CARRIAGE RETURN U+000A LINE FEED (CRLF) character pair.</li>
  <li class="li10">A single U+000A LINE FEED (LF) character.</li>
  <li class="li10">A single U+000D CARRIAGE RETURN (CR) character.</li>
</ul>
<p class="p8">A <b><i>WebVTT cue identifier</i></b> is any sequence of one or more characters not containing the substring "<span class="s5">--&gt;</span>" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN), nor containing any U+000A LINE FEED (LF) characters or U+000D CARRIAGE RETURN (CR) characters.</p>
<p class="p20">NOTE</p>
<p class="p21">A WebVTT cue identifier can be used to reference a specific cue, for example from script or CSS.</p>
<p class="p8">The <b><i>WebVTT cue timings</i></b> part of a WebVTT cue consists of the following components, in the given order:</p>
<ol class="ol1">
  <li class="li4">A WebVTT timestamp representing the start time offset of the cue. The time represented by this WebVTT timestamp must be greater than or equal to the start time offsets of all previous cues in the file.</li>
  <li class="li4">One or more U+0020 SPACE characters or U+0009 CHARACTER TABULATION (tab) characters.</li>
  <li class="li4">The string "<span class="s5">--&gt;</span>" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN).</li>
  <li class="li4">One or more U+0020 SPACE characters or U+0009 CHARACTER TABULATION (tab) characters.</li>
  <li class="li4">A WebVTT timestamp representing the end time offset of the cue. The time represented by this WebVTT timestamp must be greater than the start time offset of the cue.</li>
</ol>
<p class="p20">NOTE</p>
<p class="p21">The WebVTT cue timings give the start and end offsets of the WebVTT cue. Different cues can overlap. Cues are always listed ordered by their start time.</p>
<p class="p8">A WebVTT file whose cues all have an end time offset <i>x</i> greater than or equal to the end time offsets of all the cues whose start time offsets are less than <i>x</i> is said to be a <b><i>WebVTT file using only nested cues</i></b>.</p>
<p class="p15">The following example matches this definition:</p>
<p class="p16">WEBVTT</p>
<p class="p17"><br></p>
<p class="p16">00:00.000 --&gt; 01:24.000</p>
<p class="p16">Introduction</p>
<p class="p17"><br></p>
<p class="p16">00:00.000 --&gt; 00:44.000</p>
<p class="p16">Topics</p>
<p class="p17"><br></p>
<p class="p16">00:44.000 --&gt; 01:19.000</p>
<p class="p16">Presenters</p>
<p class="p17"><br></p>
<p class="p16">01:24.000 --&gt; 05:00.000</p>
<p class="p16">Scrolling Effects</p>
<p class="p17"><br></p>
<p class="p16">01:35.000 --&gt; 03:00.000</p>
<p class="p16">Achim's Demo</p>
<p class="p17"><br></p>
<p class="p16">03:00.000 --&gt; 05:00.000</p>
<p class="p16">Timeline Panel</p>
<p class="p15">Notice how you can express the cues in this WebVTT file as a tree structure:</p>
<ul class="ul2">
  <li class="li22">WebVTT file</li>
  <ul class="ul4">
    <li class="li22">Introduction</li>
    <ul class="ul3">
      <li class="li22">Topics</li>
      <li class="li22">Presenters</li>
    </ul>
    <li class="li22">Scrolling Effects</li>
    <ul class="ul3">
      <li class="li22">Achim's Demo</li>
      <li class="li22">Timeline Panel</li>
    </ul>
  </ul>
</ul>
<p class="p15">If the file has cues that can't be expressed in this fashion, then they don't match the definition of a WebVTT file using only nested cues. For example:</p>
<p class="p16">WEBVTT</p>
<p class="p17"><br></p>
<p class="p16">00:00.000 --&gt; 01:00.000</p>
<p class="p16">The First Minute</p>
<p class="p17"><br></p>
<p class="p16">00:30.000 --&gt; 01:30.000</p>
<p class="p16">The Final Minute</p>
<p class="p15">In this ninety-second example, the two cues partly overlap, with the first ending before the second ends and the second starting before the first ends. This therefore is not a WebVTT file using only nested cues.</p>
<p class="p8">A <b><i>WebVTT timestamp</i></b> representing a time in seconds and fractions of a second is a WebVTT timestamp representing hours <i>hours</i>, minutes <i>minutes</i>, seconds <i>seconds</i>, and thousandths of a second <i>seconds-frac</i>, calculated as follows:</p>
<ol class="ol1">
  <li class="li8">Let <i>seconds</i> be the integer part of the time.</li>
  <li class="li8">Let <i>seconds-frac</i> be the fractional component of the time, expressed as the digits of the decimal fraction given to three decimal digits.</li>
  <li class="li8">If <i>seconds</i> is greater than 59, then let <i>minutes</i> be the integer component of <i>seconds</i> divided by sixty, and then let <i>seconds</i> be the remainder of dividing <i>seconds</i> divided by sixty. Otherwise, let <i>minutes</i> be zero.</li>
  <li class="li8">If <i>minutes</i> is greater than 59, then let <i>hours</i> be the integer component of <i>minutes</i> divided by sixty, and then let <i>minutes</i> be the remainder of dividing <i>minutes</i> divided by sixty. Otherwise, let <i>hours</i> be zero.</li>
</ol>
<p class="p8">A WebVTT timestamp representing hours <i>hours</i>, minutes <i>minutes</i>, seconds <i>seconds</i>, and thousandths of a second <i>seconds-frac</i>, consists of the following components, in the given order:</p>
<ol class="ol1">
  <li class="li4">Optionally (required if <i>hour</i> is non-zero):</li>
  <ol class="ol1">
    <li class="li4">Two or more ASCII digits, representing the <i>hours</i> as a base ten integer.</li>
    <li class="li4">A U+003A COLON character (:)</li>
  </ol>
  <li class="li4">Two ASCII digits, representing the <i>minutes</i> as a base ten integer in the range 0&nbsp;≤&nbsp;<i>minutes</i>&nbsp;≤&nbsp;59.</li>
  <li class="li4">A U+003A COLON character (:)</li>
  <li class="li4">Two ASCII digits, representing the <i>seconds</i> as a base ten integer in the range 0&nbsp;≤&nbsp;<i>seconds</i>&nbsp;≤&nbsp;59.</li>
  <li class="li4">A U+002E FULL STOP character (.).</li>
  <li class="li4">Three ASCII digits, representing the thousandths of a second <i>seconds-frac</i> as a base ten integer.</li>
</ol>
<p class="p8">The <b><i>WebVTT cue settings</i></b> part of a WebVTT cue consists of zero or more of the following components, in any order, separated from each other by one or more U+0020 SPACE characters or U+0009 CHARACTER TABULATION (tab) characters. Each component must not be included more than once per WebVTT cue settings string.</p>
<ul class="ul2">
  <li class="li10">A WebVTT vertical text cue setting.</li>
  <li class="li10">A WebVTT line position cue setting.</li>
  <li class="li10">A WebVTT text position cue setting.</li>
  <li class="li10">A WebVTT size cue setting.</li>
  <li class="li10">A WebVTT alignment cue setting.</li>
</ul>
<p class="p20">NOTE</p>
<p class="p21">WebVTT cue settings give configuration options regarding the position and alignment of the cue. For example, it allows a cue to be aligned to the left or positioned at the top right.</p>
<p class="p8">A <b><i>WebVTT vertical text cue setting</i></b> consists of the following components, in the order given:</p>
<ol class="ol1">
  <li class="li4">The string "<span class="s5">vertical</span>".</li>
  <li class="li4">A U+003A COLON character (:).</li>
  <li class="li4">One of the following strings: "<span class="s5">rl</span>", "<span class="s5">lr</span>".</li>
</ol>
<p class="p20">NOTE</p>
<p class="p21">A WebVTT vertical text cue setting configures the cue to use vertical text layout rather than horizontal text layout. Vertical text layout is sometimes used in Japanese, for example. The default is horizontal layout.</p>
<p class="p8">A <b><i>WebVTT line position cue setting</i></b> consists of the following components, in the order given:</p>
<ol class="ol1">
  <li class="li8">The string "<span class="s5">line</span>".</li>
  <li class="li8">A U+003A COLON character (:).</li>
  <li class="li4">Either: <b>To represent a specific position relative to the video frame</b></li>
  <ol class="ol1">
    <li class="li4">One or more ASCII digits.</li>
    <li class="li4">A U+0025 PERCENT SIGN character (%).</li>
  </ol>
  <li class="li4"><br>
<b>To represent a line number</b></li>
  <ol class="ol1">
    <li class="li4">Optionally a U+002D HYPHEN-MINUS character (-).</li>
    <li class="li4">One or more ASCII digits.</li>
  </ol>
  <li class="li4"><br>
</li>
</ol>
<p class="p20">NOTE</p>
<p class="p21">A WebVTT line position cue setting configures the position of the cue. For horizontal cues, this is the vertical position. The position can be given either as a percentage, which gives the distance from the top of the frame, or as a line number. Line numbers are based on the size of the first line of the cue. Positive line numbers count from the top of the frame (the top line is numbered 0), negative line numbers from the bottom of the frame (the bottom line is numbered −1).</p>
<p class="p8">A <b><i>WebVTT text position cue setting</i></b> consists of the following components, in the order given:</p>
<ol class="ol1">
  <li class="li8">The string "<span class="s5">position</span>".</li>
  <li class="li4">A U+003A COLON character (:).</li>
  <li class="li4">One or more ASCII digits.</li>
  <li class="li4">A U+0025 PERCENT SIGN character (%).</li>
</ol>
<p class="p20">NOTE</p>
<p class="p21">A WebVTT text position cue setting configures the position of the text in the direction orthogonal to the WebVTT line position cue setting. For horizontal cues, this is the horizontal position. The WebVTT text position cue setting is given as a percentage, calculated from the edge of the frame that the text begins (so for left-to-right English text, the left edge).</p>
<p class="p8">A <b><i>WebVTT size cue setting</i></b> consists of the following components, in the order given:</p>
<ol class="ol1">
  <li class="li8">The string "<span class="s5">size</span>".</li>
  <li class="li4">A U+003A COLON character (:).</li>
  <li class="li4">One or more ASCII digits.</li>
  <li class="li4">A U+0025 PERCENT SIGN character (%).</li>
</ol>
<p class="p20">NOTE</p>
<p class="p21">A WebVTT size cue setting configures the size of the cue in the same direction as the WebVTT text position cue setting. For horizontal cues, this is the width of the cue. It is given as a percentage of the width of the frame.</p>
<p class="p8">A <b><i>WebVTT alignment cue setting</i></b> consists of the following components, in the order given:</p>
<ol class="ol1">
  <li class="li8">The string "<span class="s5">align</span>".</li>
  <li class="li4">A U+003A COLON character (:).</li>
  <li class="li4">One of the following strings: "<span class="s5">start</span>", "<span class="s5">middle</span>", "<span class="s5">end</span>", "<span class="s5">left</span>", "<span class="s5">right</span>"</li>
</ol>
<p class="p20">NOTE</p>
<p class="p21">A WebVTT alignment cue setting configures the alignment of the text within the cue. The keywords are relative to the text direction; for left-to-right English text, "<span class="s5">start</span>" means left-aligned.</p>
<p class="p8"><b><i>WebVTT metadata text</i></b> consists of any sequence of zero or more characters other than U+000A LINE FEED (LF) characters and U+000D CARRIAGE RETURN (CR) characters, each optionally separated from the next by a WebVTT line terminator. (In other words, any text that does not have two consecutive WebVTT line terminators and does not start or end with a WebVTT line terminator.)</p>
<p class="p8"><b><i>WebVTT chapter title text</i></b> consists of zero or more of the following, each optionally separated from the next by a WebVTT line terminator:</p>
<ul class="ul2">
  <li class="li10">A WebVTT cue text span, representing the text of the cue.</li>
  <li class="li10">A WebVTT cue amp escape, representing a "&amp;" character in the text of the cue.</li>
  <li class="li10">A WebVTT cue lt escape, representing a "&lt;" character in the text of the cue.</li>
  <li class="li10">A WebVTT cue gt escape, representing a "&gt;" character in the text of the cue.</li>
  <li class="li10">A WebVTT cue lrm escape, representing a U+200E LEFT-TO-RIGHT MARK Unicode bidirectional formatting character in the text of the cue.</li>
  <li class="li10">A WebVTT cue rlm escape, representing a U+200F RIGHT-TO-LEFT MARK Unicode bidirectional formatting character in the text of the cue.</li>
  <li class="li10">A WebVTT cue nbsp escape, representing a U+00A0 NO-BREAK SPACE character in the text of the cue.</li>
</ul>
<p class="p8"><b><i>WebVTT cue text</i></b> consists of zero or more WebVTT cue components, in any order, each optionally separated from the next by a WebVTT line terminator.</p>
<p class="p8">The <b><i>WebVTT cue components</i></b> are:</p>
<ul class="ul2">
  <li class="li10">A WebVTT cue class span.</li>
  <li class="li10">A WebVTT cue italics span.</li>
  <li class="li10">A WebVTT cue bold span.</li>
  <li class="li10">A WebVTT cue underline span.</li>
  <li class="li10">A WebVTT cue ruby span.</li>
  <li class="li10">A WebVTT cue voice span.</li>
  <li class="li10">A WebVTT cue language span.</li>
  <li class="li10">A WebVTT cue timestamp.</li>
  <li class="li10">A WebVTT cue text span, representing the text of the cue.</li>
  <li class="li10">A WebVTT cue amp escape, representing a "&amp;" character in the text of the cue.</li>
  <li class="li10">A WebVTT cue lt escape, representing a "&lt;" character in the text of the cue.</li>
  <li class="li10">A WebVTT cue gt escape, representing a "&gt;" character in the text of the cue.</li>
  <li class="li10">A WebVTT cue lrm escape, representing a U+200E LEFT-TO-RIGHT MARK Unicode bidirectional formatting character in the text of the cue.</li>
  <li class="li10">A WebVTT cue rlm escape, representing a U+200F RIGHT-TO-LEFT MARK Unicode bidirectional formatting character in the text of the cue.</li>
  <li class="li10">A WebVTT cue nbsp escape, representing a U+00A0 NO-BREAK SPACE character in the text of the cue.</li>
</ul>
<p class="p8"><b><i>WebVTT cue internal text</i></b> consists of an optional WebVTT line terminator, followed by zero or more WebVTT cue components, in any order, each optionally followed by a WebVTT line terminator.</p>
<p class="p8">A <b><i>WebVTT cue class span</i></b> consists of a WebVTT cue span start tag "<span class="s5">c</span>" that disallows an annotation, WebVTT cue internal text representing cue text, and a WebVTT cue span end tag "<span class="s5">c</span>".</p>
<p class="p8">A <b><i>WebVTT cue italics span</i></b> consists of a WebVTT cue span start tag "<span class="s5">i</span>" that disallows an annotation, WebVTT cue internal text representing the italicized text, and a WebVTT cue span end tag "<span class="s5">i</span>".</p>
<p class="p8">A <b><i>WebVTT cue bold span</i></b> consists of a WebVTT cue span start tag "<span class="s5">b</span>" that disallows an annotation, WebVTT cue internal text representing the boldened text, and a WebVTT cue span end tag "<span class="s5">b</span>".</p>
<p class="p8">A <b><i>WebVTT cue underline span</i></b> consists of a WebVTT cue span start tag "<span class="s5">u</span>" that disallows an annotation, WebVTT cue internal text representing the underlined text, and a WebVTT cue span end tag "<span class="s5">u</span>".</p>
<p class="p8">A <b><i>WebVTT cue ruby span</i></b> consists of the following components, in the order given:</p>
<ol class="ol1">
  <li class="li4">A WebVTT cue span start tag "<span class="s5">ruby</span>" that disallows an annotation.</li>
  <li class="li4">One or more occurrences of the following group of components, in the order given:</li>
  <ol class="ol1">
    <li class="li4">WebVTT cue internal text, representing the ruby base.</li>
    <li class="li4">A WebVTT cue span start tag "<span class="s5">rt</span>" that disallows an annotation.</li>
    <li class="li4">A <b><i>WebVTT cue ruby text span</i></b>: WebVTT cue internal text, representing the ruby text component of the ruby annotation.</li>
    <li class="li4">A WebVTT cue span end tag "<span class="s5">rt</span>". If this is the last occurrence of this group of components in the WebVTT cue ruby span, then this last end tag string may be omitted.</li>
  </ol>
  <li class="li4">If the last end tag string was not omitted: Optionally, a WebVTT line terminator.</li>
  <li class="li4">If the last end tag string was not omitted: Zero or more U+0020 SPACE characters or U+0009 CHARACTER TABULATION (tab) characters, each optionally followed by a WebVTT line terminator.</li>
  <li class="li4">A WebVTT cue span end tag "<span class="s5">ruby</span>".</li>
</ol>
<p class="p8">A <b><i>WebVTT cue voice span</i></b> consists of the following components, in the order given:</p>
<ol class="ol1">
  <li class="li4">A WebVTT cue span start tag "<span class="s5">v</span>" that requires an annotation; the annotation represents the name of the voice.</li>
  <li class="li4">WebVTT cue internal text.</li>
  <li class="li4">A WebVTT cue span end tag "<span class="s5">v</span>". If this WebVTT cue voice span is the only component of its WebVTT cue text sequence, then the end tag may be omitted for brevity.</li>
</ol>
<p class="p8">A <b><i>WebVTT cue language span</i></b> consists of the following components, in the order given:</p>
<ol class="ol1">
  <li class="li4">A WebVTT cue span start tag "<span class="s5">lang</span>" that requires an annotation; the annotation represents the language of the following component, and must be a valid BCP 47 language tag. <span class="s6">[BCP47]</span></li>
  <li class="li4">WebVTT cue internal text.</li>
  <li class="li4">A WebVTT cue span end tag "<span class="s5">lang</span>".</li>
</ol>
<p class="p8">A <b><i>WebVTT cue span start tag</i></b> has a <i>tag name</i> and either requires or disallows an annotation, and consists of the following components, in the order given:</p>
<ol class="ol1">
  <li class="li4">A U+003C LESS-THAN SIGN character (&lt;).</li>
  <li class="li4">The <i>tag name</i>.</li>
  <li class="li4">Zero or more occurrences of the following sequence:</li>
  <ol class="ol1">
    <li class="li4">U+002E FULL STOP character (.)</li>
    <li class="li4">One or more characters other than U+0009 CHARACTER TABULATION (tab) characters, U+000A LINE FEED (LF) characters, U+000D CARRIAGE RETURN (CR) characters, U+0020 SPACE characters, U+0026 AMPERSAND characters (&amp;), U+003C LESS-THAN SIGN characters (&lt;), U+003E GREATER-THAN SIGN characters (&gt;), and U+002E FULL STOP characters (.), representing a class that describes the cue span's significance.</li>
  </ol>
  <li class="li4">If the start tag requires an annotation: a U+0020 SPACE character or a U+0009 CHARACTER TABULATION (tab) character, followed by one or more of the following components, the concatenation of their representations having a value that contains at least one character other than U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters:</li>
  <ol class="ol1">
    <li class="li10">WebVTT cue span start tag annotation text, representing the text of the annotation.</li>
    <li class="li10">A WebVTT cue amp escape, representing a "&amp;" character in the text of the annotation.</li>
    <li class="li10">A WebVTT cue lt escape, representing a "&lt;" character in the text of the annotation.</li>
    <li class="li10">A WebVTT cue gt escape, representing a "&gt;" character in the text of the annotation.</li>
    <li class="li10">A WebVTT cue lrm escape, representing a U+200E LEFT-TO-RIGHT MARK Unicode bidirectional formatting character in the text of the cue.</li>
    <li class="li10">A WebVTT cue rlm escape, representing a U+200F RIGHT-TO-LEFT MARK Unicode bidirectional formatting character in the text of the cue.</li>
    <li class="li10">A WebVTT cue nbsp escape, representing a U+00A0 NO-BREAK SPACE character in the text of the cue.</li>
  </ol>
  <li class="li4">A U+003E GREATER-THAN SIGN character (&gt;).</li>
</ol>
<p class="p8">A <b><i>WebVTT cue span end tag</i></b> has a <i>tag name</i> and consists of the following components, in the order given:</p>
<ol class="ol1">
  <li class="li4">A U+003C LESS-THAN SIGN character (&lt;).</li>
  <li class="li4">U+002F SOLIDUS character (/).</li>
  <li class="li4">The <i>tag name</i>.</li>
  <li class="li4">A U+003E GREATER-THAN SIGN character (&gt;).</li>
</ol>
<p class="p8">A <b><i>WebVTT cue timestamp</i></b> consists of a U+003C LESS-THAN SIGN character (&lt;), followed by a WebVTT timestamp representing the time that the given point in the cue becomes active, followed by a U+003E GREATER-THAN SIGN character (&gt;). The time represented by the WebVTT timestamp must be greater than the times represented by any previous WebVTT cue timestamps in the cue, as well as greater than the cue's start time offset, and less than the cue's end time offset.</p>
<p class="p8">A <b><i>WebVTT cue text span</i></b> consists of one or more characters other than U+000A LINE FEED (LF) characters, U+000D CARRIAGE RETURN (CR) characters, U+0026 AMPERSAND characters (&amp;), and U+003C LESS-THAN SIGN characters (&lt;).</p>
<p class="p8"><b><i>WebVTT cue span start tag annotation text</i></b> consists of one or more characters other than U+000A LINE FEED (LF) characters, U+000D CARRIAGE RETURN (CR) characters, U+0026 AMPERSAND characters (&amp;), and U+003E GREATER-THAN SIGN characters (&gt;).</p>
<p class="p8">A <b><i>WebVTT cue amp escape</i></b> is the five character string "<span class="s5">&amp;amp;</span>".</p>
<p class="p8">A <b><i>WebVTT cue lt escape</i></b> is the four character string "<span class="s5">&amp;lt;</span>".</p>
<p class="p8">A <b><i>WebVTT cue gt escape</i></b> is the four character string "<span class="s5">&amp;gt;</span>".</p>
<p class="p8">A <b><i>WebVTT cue lrm escape</i></b> is the five character string "<span class="s5">&amp;lrm;</span>".</p>
<p class="p8">A <b><i>WebVTT cue rlm escape</i></b> is the five character string "<span class="s5">&amp;rlm;</span>".</p>
<p class="p8">A <b><i>WebVTT cue nbsp escape</i></b> is the six character string "<span class="s5">&amp;nbsp;</span>".</p>
<p class="p14"><b>4.2 Parsing</b></p>
<p class="p8">A <b><i>WebVTT parser</i></b>, given an input byte stream and a text track list of cues <i>output</i>, must decode the byte stream using the UTF-8 decode algorithm, and then must parse the resulting string according to the WebVTT parser algorithm below. This results in text track cues being added to <i>output</i>. <span class="s6">[RFC3629]</span></p>
<p class="p8">A WebVTT parser, specifically its conversion and parsing steps, is typically run asynchronously, with the input byte stream being updated incrementally as the resource is downloaded; this is called an <b><i>incremental WebVTT parser</i></b>.</p>
<p class="p8">A WebVTT parser verifies a file signature before parsing the provided byte stream. If the stream lacks this WebVTT file signature, then the parser aborts.</p>
<p class="p8">The <b><i>WebVTT parser algorithm</i></b> is as follows:</p>
<ol class="ol1">
  <li class="li8">Let <i>input</i> be the string being parsed, after conversion to Unicode, and with the following transformations applied:</li>
  <ul class="ul4">
    <li class="li8">Replace all U+0000 NULL characters by U+FFFD REPLACEMENT CHARACTERs.</li>
    <li class="li8">Replace each U+000D CARRIAGE RETURN U+000A LINE FEED (CRLF) character pair by a single U+000A LINE FEED (LF) character.</li>
    <li class="li8">Replace all remaining U+000D CARRIAGE RETURN characters by U+000A LINE FEED (LF) characters.</li>
  </ul>
  <li class="li8">Let <i>position</i> be a pointer into <i>input</i>, initially pointing at the start of the string. In an incremental WebVTT parser, when this algorithm (or further algorithms that it uses) moves the <i>position</i> pointer, the user agent must wait until appropriate further characters from the byte stream have been added to <i>input</i> before moving the pointer, so that the algorithm never reads past the end of the <i>input</i> string. Once the byte stream has ended, and all characters have been added to <i>input</i>, then the <i>position</i> pointer may, when so instructed by the algorithms, be moved past the end of <i>input</i>.</li>
  <li class="li4">Let <i>line</i> be a string variable. Unset the <i>already collected line</i> flag.</li>
  <li class="li8">Collect a sequence of characters that are <i>not</i> U+000A LINE FEED (LF) characters. Let <i>line</i> be those characters, if any.</li>
  <li class="li8">If <i>line</i> is less than six characters long, then abort these steps. The file does not start with the correct WebVTT file signature and was therefore not successfully processed.</li>
  <li class="li8">If <i>line</i> is exactly six characters long but does not exactly equal "<span class="s5">WEBVTT</span>", then abort these steps. The file does not start with the correct WebVTT file signature and was therefore not successfully processed.</li>
  <li class="li8">If <i>line</i> is more than six characters long but the first six characters do not exactly equal "<span class="s5">WEBVTT</span>", or the seventh character is neither a U+0020 SPACE character nor a U+0009 CHARACTER TABULATION (tab) character, then abort these steps. The file does not start with the correct WebVTT file signature and was therefore not successfully processed.</li>
  <li class="li8">If <i>position</i> is past the end of <i>input</i>, then abort these steps. The file was successfully processed, but it contains no useful data and so no text track cues where added to <i>output</i>.</li>
  <li class="li8">The character indicated by <i>position</i> is a U+000A LINE FEED (LF) character. Advance <i>position</i> to the next character in <i>input</i>.</li>
  <li class="li8"><i>Header</i>: Collect a sequence of characters that are <i>not</i> U+000A LINE FEED (LF) characters. Let <i>line</i> be those characters, if any.</li>
  <li class="li8">If <i>position</i> is past the end of <i>input</i>, then jump to the step labeled <i>end</i>.</li>
  <li class="li8">The character indicated by <i>position</i> is a U+000A LINE FEED (LF) character. Advance <i>position</i> to the next character in <i>input</i>.</li>
  <li class="li8">If <i>line</i> contains the three-character substring "<span class="s5">--&gt;</span>" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN), then set the <i>already collected line</i> flag and jump to the step labeled <i>cue loop</i>.</li>
  <li class="li8">If <i>line</i> is not the empty string, then jump back to the step labeled <i>header</i>.</li>
  <li class="li8"><i>Cue loop</i>: If the <i>already collected line</i> flag is set, then jump to the step labeled <i>cue creation</i>.</li>
  <li class="li8">Collect a sequence of characters that are U+000A LINE FEED (LF) characters.</li>
  <li class="li8">Collect a sequence of characters that are <i>not</i> U+000A LINE FEED (LF) characters. Let <i>line</i> be those characters, if any.</li>
  <li class="li8">If <i>line</i> is the empty string, then jump to the step labeled <i>end</i>. (In such a case, <i>position</i> is also forcibly past the end of <i>input</i>.)</li>
  <li class="li8"><i>Cue creation</i>: Let <i>cue</i> be a new text track cue.</li>
  <li class="li8">Let <i>cue</i>'s text track cue identifier be the empty string.</li>
  <li class="li8">Let <i>cue</i>'s text track cue pause-on-exit flag be false.</li>
  <li class="li8">Let <i>cue</i>'s text track cue writing direction be horizontal.</li>
  <li class="li8">Let <i>cue</i>'s text track cue snap-to-lines flag be true.</li>
  <li class="li8">Let <i>cue</i>'s text track cue line position be auto.</li>
  <li class="li8">Let <i>cue</i>'s text track cue text position be 50.</li>
  <li class="li8">Let <i>cue</i>'s text track cue size be 100.</li>
  <li class="li8">Let <i>cue</i>'s text track cue alignment be middle alignment.</li>
  <li class="li8">Let <i>cue</i>'s text track cue text be the empty string.</li>
  <li class="li8">If <i>line</i> contains the three-character substring "<span class="s5">--&gt;</span>" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN), then jump to the step labeled <i>timings</i> below.</li>
  <li class="li8">Let <i>cue</i>'s text track cue identifier be <i>line</i>.<br>
</li>
  <li class="li8">If <i>position</i> is past the end of <i>input</i>, then discard <i>cue</i> and jump to the step labeled <i>end</i>.</li>
  <li class="li8">If the character indicated by <i>position</i> is a U+000A LINE FEED (LF) character, advance <i>position</i> to the next character in <i>input</i>.</li>
  <li class="li8">Collect a sequence of characters that are <i>not</i> U+000A LINE FEED (LF) characters. Let <i>line</i> be those characters, if any.</li>
  <li class="li8">If <i>line</i> is the empty string, then discard <i>cue</i> and jump to the step labeled <i>cue loop</i>.</li>
  <li class="li8"><i>Timings</i>: Unset the <i>already collected line</i> flag.</li>
  <li class="li8">Collect WebVTT cue timings and settings from <i>line</i>, using <i>cue</i> for the results. If that fails, jump to the step labeled <i>bad cue</i>.</li>
  <li class="li8">Let <i>cue text</i> be the empty string.</li>
  <li class="li8"><i>Cue text loop</i>: If <i>position</i> is past the end of <i>input</i>, then jump to the step labeled <i>cue text processing</i>.</li>
  <li class="li8">If the character indicated by <i>position</i> is a U+000A LINE FEED (LF) character, advance <i>position</i> to the next character in <i>input</i>.</li>
  <li class="li8">Collect a sequence of characters that are <i>not</i> U+000A LINE FEED (LF) characters. Let <i>line</i> be those characters, if any.</li>
  <li class="li8">If <i>line</i> is the empty string, then jump to the step labeled <i>cue text processing</i>.</li>
  <li class="li8">If <i>line</i> contains the three-character substring "<span class="s5">--&gt;</span>" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN), then set the <i>already collected line</i> flag and jump to the step labeled <i>cue text processing</i>.</li>
  <li class="li8">If <i>cue text</i> is not empty, append a U+000A LINE FEED (LF) character to <i>cue text</i>.</li>
  <li class="li8">Let <i>cue text</i> be the concatenation of <i>cue text</i> and <i>line</i>.</li>
  <li class="li8">Return to the step labeled <i>cue text loop</i>.</li>
  <li class="li8"><i>Cue text processing</i>: Let the text track cue text of <i>cue</i> be <i>cue text</i>, and let the rules for rendering the cue in isolation be the rules for interpreting WebVTT cue text.</li>
  <li class="li8">Add <i>cue</i> to the text track list of cues <i>output</i>.</li>
  <li class="li8">Jump to the step labeled <i>cue loop</i>.</li>
  <li class="li8"><i>Bad cue</i>: Discard <i>cue</i>.</li>
  <li class="li8"><i>Bad cue loop</i>: If <i>position</i> is past the end of <i>input</i>, then jump to the step labeled <i>end</i>.</li>
  <li class="li8">If the character indicated by <i>position</i> is a U+000A LINE FEED (LF) character, advance <i>position</i> to the next character in <i>input</i>.</li>
  <li class="li8">Collect a sequence of characters that are <i>not</i> U+000A LINE FEED (LF) characters. Let <i>line</i> be those characters, if any.</li>
  <li class="li8">If <i>line</i> contains the three-character substring "<span class="s5">--&gt;</span>" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN), then set the <i>already collected line</i> flag and jump to the step labeled <i>cue loop</i>.</li>
  <li class="li8">If <i>line</i> is the empty string, then jump to the step labeled <i>cue loop</i>.</li>
  <li class="li8">Otherwise, jump to the step labeled <i>bad cue loop</i>.</li>
  <li class="li8"><i>End</i>: The file has ended. Abort these steps. The WebVTT parser has finished. The file was successfully processed.</li>
</ol>
<p class="p8">When the algorithm above requires that the user agent <b><i>Collect WebVTT cue timings and settings</i></b> from a string <i>input</i> for a text track cue <i>cue</i>, the user agent must run the following algorithm.</p>
<ol class="ol1">
  <li class="li8">Let <i>input</i> be the string being parsed.</li>
  <li class="li8">Let <i>position</i> be a pointer into <i>input</i>, initially pointing at the start of the string.</li>
  <li class="li8">Skip whitespace.</li>
  <li class="li8">Collect a WebVTT timestamp. If that algorithm fails, then abort these steps and return failure. Otherwise, let <i>cue</i>'s text track cue start time be the collected time.</li>
  <li class="li8">Skip whitespace.</li>
  <li class="li8">If the character at <i>position</i> is not a U+002D HYPHEN-MINUS character (-) then abort these steps and return failure. Otherwise, move <i>position</i> forwards one character.</li>
  <li class="li8">If the character at <i>position</i> is not a U+002D HYPHEN-MINUS character (-) then abort these steps and return failure. Otherwise, move <i>position</i> forwards one character.</li>
  <li class="li8">If the character at <i>position</i> is not a U+003E GREATER-THAN SIGN character (&gt;) then abort these steps and return failure. Otherwise, move <i>position</i> forwards one character.</li>
  <li class="li8">Skip whitespace.</li>
  <li class="li8">Collect a WebVTT timestamp. If that algorithm fails, then abort these steps and return failure. Otherwise, let <i>cue</i>'s text track cue end time be the collected time.</li>
  <li class="li8">Let <i>remainder</i> be the trailing substring of <i>input</i> starting at <i>position</i>.</li>
  <li class="li8">Parse the WebVTT settings given by <i>remainder</i> for <i>cue</i>.</li>
</ol>
<p class="p8">When the user agent is to <b><i>Parse the WebVTT settings</i></b> given by a string <i>input</i> for a text track cue <i>cue</i>, the user agent must run the following steps:</p>
<ol class="ol1">
  <li class="li8">Let <i>settings</i> be the result of splitting <i>input</i> on spaces.</li>
  <li class="li8">For each token <i>setting</i> in the list <i>settings</i>, run the following substeps:</li>
  <ol class="ol1">
    <li class="li8">If <i>setting</i> does not contain a U+003A COLON character (:), or if the first U+003A COLON character (:) in <i>setting</i> is either the first or last character of <i>setting</i>, then jump to the step labeled <i>next setting</i>.</li>
    <li class="li8">Let <i>name</i> be the leading substring of <i>setting</i> up to and excluding the first U+003A COLON character (:) in that string.</li>
    <li class="li8">Let <i>value</i> be the trailing substring of <i>setting</i> starting from the character immediately after the first U+003A COLON character (:) in that string.</li>
    <li class="li8">Run the appropriate substeps that apply for the value of <i>name</i>, as follows:<br>
<b>If <i>name</i> is a case-sensitive match for "</b><span class="s5"><b>vertical</b></span><b>"</b></li>
    <ol class="ol1">
      <li class="li8">If <i>value</i> is a case-sensitive match for the string "<span class="s5">rl</span>", then let <i>cue</i>'s text track cue writing direction be vertical growing left.</li>
      <li class="li8">Otherwise, if <i>value</i> is a case-sensitive match for the string "<span class="s5">lr</span>", then let <i>cue</i>'s text track cue writing direction be vertical growing right.</li>
    </ol>
    <li class="li4"><br>
<b>If <i>name</i> is a case-sensitive match for "</b><span class="s5"><b>line</b></span><b>"</b></li>
    <ol class="ol1">
      <li class="li8">If <i>value</i> contains any characters other than U+002D HYPHEN-MINUS characters (-), U+0025 PERCENT SIGN characters (%), and ASCII digits, then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">If <i>value</i> does not contain at least one ASCII digit, then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">If any character in <i>value</i> other than the first character is a U+002D HYPHEN-MINUS character (-), then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">If any character in <i>value</i> other than the last character is a U+0025 PERCENT SIGN character (%), then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">If the first character in <i>value</i> is a U+002D HYPHEN-MINUS character (-) <i>and</i> the last character in <i>value</i> is a U+0025 PERCENT SIGN character (%), then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">Ignoring the trailing percent sign, if any, interpret <i>value</i> as a (potentially signed) integer, and let <i>number</i> be that number.</li>
      <li class="li8">If the last character in <i>value</i> is a U+0025 PERCENT SIGN character (%), but <i>number</i> is not in the range 0&nbsp;≤&nbsp;<i>number</i>&nbsp;≤&nbsp;100, then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">Let <i>cue</i>'s text track cue line position be <i>number</i>.</li>
      <li class="li8">If the last character in <i>value</i> is a U+0025 PERCENT SIGN character (%), then let <i>cue</i>'s text track cue snap-to-lines flag be false. Otherwise, let it be true.</li>
    </ol>
    <li class="li4"><br>
<b>If <i>name</i> is a case-sensitive match for "</b><span class="s5"><b>position</b></span><b>"</b></li>
    <ol class="ol1">
      <li class="li8">If <i>value</i> contains any characters other than U+0025 PERCENT SIGN characters (%) and ASCII digits, then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">If <i>value</i> does not contain at least one ASCII digit, then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">If any character in <i>value</i> other than the last character is a U+0025 PERCENT SIGN character (%), then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">If the last character in <i>value</i> is not a U+0025 PERCENT SIGN character (%), then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">Ignoring the trailing percent sign, interpret <i>value</i> as an integer, and let <i>number</i> be that number.</li>
      <li class="li8">If <i>number</i> is not in the range 0&nbsp;≤&nbsp;<i>number</i>&nbsp;≤&nbsp;100, then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">Let <i>cue</i>'s text track cue text position be <i>number</i>.</li>
    </ol>
    <li class="li4"><br>
<b>If <i>name</i> is a case-sensitive match for "</b><span class="s5"><b>size</b></span><b>"</b></li>
    <ol class="ol1">
      <li class="li8">If <i>value</i> contains any characters other than U+0025 PERCENT SIGN characters (%) and ASCII digits, then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">If <i>value</i> does not contain at least one ASCII digit, then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">If any character in <i>value</i> other than the last character is a U+0025 PERCENT SIGN character (%), then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">If the last character in <i>value</i> is not a U+0025 PERCENT SIGN character (%), then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">Ignoring the trailing percent sign, interpret <i>value</i> as an integer, and let <i>number</i> be that number.</li>
      <li class="li8">If <i>number</i> is not in the range 0&nbsp;≤&nbsp;<i>number</i>&nbsp;≤&nbsp;100, then jump to the step labeled <i>next setting</i>.</li>
      <li class="li8">Let <i>cue</i>'s text track cue size be <i>number</i>.</li>
    </ol>
    <li class="li4"><br>
<b>If <i>name</i> is a case-sensitive match for "</b><span class="s5"><b>align</b></span><b>"</b></li>
    <ol class="ol1">
      <li class="li8">If <i>value</i> is a case-sensitive match for the string "<span class="s5">start</span>", then let <i>cue</i>'s text track cue alignment be start alignment.</li>
      <li class="li8">If <i>value</i> is a case-sensitive match for the string "<span class="s5">middle</span>", then let <i>cue</i>'s text track cue alignment be middle alignment.</li>
      <li class="li8">If <i>value</i> is a case-sensitive match for the string "<span class="s5">end</span>", then let <i>cue</i>'s text track cue alignment be end alignment.</li>
      <li class="li8">If <i>value</i> is a case-sensitive match for the string "<span class="s5">left</span>", then let <i>cue</i>'s text track cue alignment be left alignment.</li>
      <li class="li8">If <i>value</i> is a case-sensitive match for the string "<span class="s5">right</span>", then let <i>cue</i>'s text track cue alignment be right alignment.</li>
    </ol>
    <li class="li4"><br>
</li>
    <li class="li8"><i>Next setting</i>: Continue to the next token, if any.</li>
  </ol>
</ol>
<p class="p8">When this specification says that a user agent is to <b><i>Collect a WebVTT timestamp</i></b>, the user agent must run the following steps:</p>
<ol class="ol1">
  <li class="li8">Let <i>input</i> and <i>position</i> be the same variables as those of the same name in the algorithm that invoked these steps.</li>
  <li class="li8">Let <i>most significant units</i> be <i>minutes</i>.</li>
  <li class="li8">If <i>position</i> is past the end of <i>input</i>, return an error and abort these steps.</li>
  <li class="li8">If the character indicated by <i>position</i> is not an ASCII digit, then return an error and abort these steps.</li>
  <li class="li8">Collect a sequence of characters that are ASCII digits, and let <i>string</i> be the collected substring.</li>
  <li class="li8">Interpret <i>string</i> as a base-ten integer. Let <i>value</i><span class="s9"><i><sub>1</sub></i></span> be that integer.</li>
  <li class="li8">If <i>string</i> is not exactly two characters in length, or if <i>value</i><span class="s9"><i><sub>1</sub></i></span> is greater than 59, let <i>most significant units</i> be <i>hours</i>.</li>
  <li class="li8">If <i>position</i> is beyond the end of <i>input</i> or if the character at <i>position</i> is not a U+003A COLON character (:), then return an error and abort these steps. Otherwise, move <i>position</i> forwards one character.</li>
  <li class="li8">Collect a sequence of characters that are ASCII digits, and let <i>string</i> be the collected substring.</li>
  <li class="li8">If <i>string</i> is not exactly two characters in length, return an error and abort these steps.</li>
  <li class="li8">Interpret <i>string</i> as a base-ten integer. Let <i>value</i><span class="s9"><i><sub>2</sub></i></span> be that integer.</li>
  <li class="li8">If <i>most significant units</i> is <i>hours</i>, or if <i>position</i> is not beyond the end of <i>input</i> and the character at <i>position</i> is a U+003A COLON character (:), run these substeps:</li>
  <ol class="ol1">
    <li class="li8">If <i>position</i> is beyond the end of <i>input</i> or if the character at <i>position</i> is not a U+003A COLON character (:), then return an error and abort these steps. Otherwise, move <i>position</i> forwards one character.</li>
    <li class="li8">Collect a sequence of characters that are ASCII digits, and let <i>string</i> be the collected substring.</li>
    <li class="li8">If <i>string</i> is not exactly two characters in length, return an error and abort these steps.</li>
    <li class="li8">Interpret <i>string</i> as a base-ten integer. Let <i>value</i><span class="s9"><i><sub>3</sub></i></span> be that integer.</li>
  </ol>
  <li class="li8">Otherwise (if <i>most significant units</i> is not <i>hours</i>, and either <i>position</i> is beyond the end of <i>input</i>, or the character at <i>position</i> is not a U+003A COLON character (:)), let <i>value</i><span class="s9"><i><sub>3</sub></i></span> have the value of <i>value</i><span class="s9"><i><sub>2</sub></i></span>, then <i>value</i><span class="s9"><i><sub>2</sub></i></span> have the value of <i>value</i><span class="s9"><i><sub>1</sub></i></span>, then let <i>value</i><span class="s9"><i><sub>1</sub></i></span> equal zero.</li>
  <li class="li8">If <i>position</i> is beyond the end of <i>input</i> or if the character at <i>position</i> is not a U+002E FULL STOP character (.), then return an error and abort these steps. Otherwise, move <i>position</i> forwards one character.</li>
  <li class="li8">Collect a sequence of characters that are ASCII digits, and let <i>string</i> be the collected substring.</li>
  <li class="li8">If <i>string</i> is not exactly three characters in length, return an error and abort these steps.</li>
  <li class="li8">Interpret <i>string</i> as a base-ten integer. Let <i>value</i><span class="s9"><i><sub>4</sub></i></span> be that integer.</li>
  <li class="li8">If <i>value</i><span class="s9"><i><sub>2</sub></i></span> is greater than 59 or if <i>value</i><span class="s9"><i><sub>3</sub></i></span> is greater than 59, return an error and abort these steps.</li>
  <li class="li8">Let <i>result</i> be <i>value</i><span class="s9"><i><sub>1</sub></i></span>×60×60 + <i>value</i><span class="s9"><i><sub>2</sub></i></span>×60 + <i>value</i><span class="s9"><i><sub>3</sub></i></span> + <i>value</i><span class="s9"><i><sub>4</sub></i></span><span class="s10">∕</span>1000.<span class="Apple-converted-space">&nbsp;</span></li>
  <li class="li8">Return <i>result</i>.</li>
</ol>
<p class="p14"><b>4.3 </b><span class="s2"><b><i>WebVTT </i></b></span><b><i>cue text parsing rules</i></b></p>
<p class="p8">A <b><i>WebVTT Node Object</i></b> is a conceptual construct used to represent components of WebVTT cue text so that its processing can be described without reference to the underlying syntax.</p>
<p class="p8">There are two broad classes of WebVTT Node Objects: WebVTT Internal Node Objects and WebVTT Leaf Node Objects.</p>
<p class="p8"><b><i>WebVTT Internal Node Objects</i></b> are those that can contain further WebVTT Node Objects. They are conceptually similar to elements in HTML or the DOM. WebVTT Internal Node Objects have an ordered list of child WebVTT Node Objects. The WebVTT Internal Node Object is said to be the <i>parent</i> of the children. Cycles do not occur; the parent-child relationships so constructed form a tree structure. WebVTT Internal Node Objects also have an ordered list of class names, known as their <b><i>applicable classes</i></b>, and a language, known as their <b><i>applicable language</i></b>, which is to be interpreted as a BCP 47 language code. <span class="s6">[BCP47]</span></p>
<p class="p8">There are several concrete classes of WebVTT Internal Node Objects:</p>
<p class="p4"><b><i>Lists of WebVTT Node Objects</i></b></p>
<p class="p8">These are used as root nodes for trees of WebVTT Node Objects.</p>
<p class="p4"><b><i>WebVTT Class Objects</i></b></p>
<p class="p8">These represent spans of text (a WebVTT cue class span) in WebVTT cue text, and are used to annotate parts of the cue with applicable classes without implying further meaning (such as italics or bold).</p>
<p class="p4"><b><i>WebVTT Italic Objects</i></b></p>
<p class="p8">These represent spans of italic text (a WebVTT cue italics span) in WebVTT cue text.</p>
<p class="p4"><b><i>WebVTT Bold Objects</i></b></p>
<p class="p8">These represent spans of bold text (a WebVTT cue bold span) in WebVTT cue text.</p>
<p class="p4"><b><i>WebVTT Underline Objects</i></b></p>
<p class="p8">These represent spans of underline text (a WebVTT cue underline span) in WebVTT cue text.</p>
<p class="p4"><b><i>WebVTT Ruby Objects</i></b></p>
<p class="p8">These represent spans of ruby (a WebVTT cue ruby span) in WebVTT cue text.</p>
<p class="p4"><b><i>WebVTT Ruby Text Objects</i></b></p>
<p class="p8">These represent spans of ruby text (a WebVTT cue ruby text span) in WebVTT cue text.</p>
<p class="p4"><b><i>WebVTT Voice Objects</i></b></p>
<p class="p8">These represent spans of text associated with a specific voice (a WebVTT cue voice span) in WebVTT cue text. A WebVTT Voice Object has a value, which is the name of the voice.</p>
<p class="p4"><b><i>WebVTT Language Objects</i></b></p>
<p class="p8">These represent spans of text (a WebVTT cue language span) in WebVTT cue text, and are used to annotate parts of the cue where the applicable language might be different than the surrounding text's, without implying further meaning (such as italics or bold).</p>
<p class="p8"><b><i>WebVTT Leaf Node Objects</i></b> are those that contain data, such as text, and cannot contain child WebVTT Node Objects.</p>
<p class="p8">There are two concrete classes of WebVTT Leaf Node Objects:</p>
<p class="p4"><b><i>WebVTT Text Objects</i></b></p>
<p class="p8">A fragment of text. A WebVTT Text Object has a value, which is the text it represents.</p>
<p class="p4"><b><i>WebVTT Timestamp Objects</i></b></p>
<p class="p8">A timestamp. A WebVTT Timestamp Object has a value, in seconds and fractions of a second, which is the time represented by the timestamp.</p>
<p class="p8">To parse a string <i>input</i> supposedly containing WebVTT cue text, user agents must use the following algorithm. This algorithm returns a list of WebVTT Node Objects.</p>
<ol class="ol1">
  <li class="li8">Let <i>input</i> be the string being parsed.</li>
  <li class="li8">Let <i>position</i> be a pointer into <i>input</i>, initially pointing at the start of the string.</li>
  <li class="li8">Let <i>result</i> be a list of WebVTT Node Objects, initially empty.</li>
  <li class="li8">Let <i>current</i> be the WebVTT Internal Node Object <i>result</i>.</li>
  <li class="li8">Let <i>language stack</i> be a stack of language codes, initially empty.</li>
  <li class="li8"><i>Loop</i>: If <i>position</i> is past the end of <i>input</i>, return <i>result</i> and abort these steps.</li>
  <li class="li8">Let <i>token</i> be the result of invoking the WebVTT cue text tokenizer.</li>
  <li class="li8">Run the appropriate steps given the type of <i>token</i>:<br>
<b>If <i>token</i> is a string</b></li>
  <ol class="ol1">
    <li class="li8">Create a WebVTT Text Object whose value is the value of the string token <i>token</i>.</li>
    <li class="li8">Append the newly created WebVTT Text Object to <i>current</i>.</li>
  </ol>
  <li class="li4"><br>
<b>If <i>token</i> is a start tag<br>
</b>How the start tag token <i>token</i> is processed depends on its tag name, as follows:<br>
<b>If the tag name is "</b><span class="s5"><b>c</b></span><b>"<br>
</b>Attach a WebVTT Class Object.<br>
<br>
<b>If the tag name is "</b><span class="s5"><b>i</b></span><b>"<br>
</b>Attach a WebVTT Italic Object.<br>
<br>
<b>If the tag name is "</b><span class="s5"><b>b</b></span><b>"<br>
</b>Attach a WebVTT Bold Object.<br>
<br>
<b>If the tag name is "</b><span class="s5"><b>u</b></span><b>"<br>
</b>Attach a WebVTT Underline Object.<br>
<br>
<b>If the tag name is "</b><span class="s5"><b>ruby</b></span><b>"<br>
</b>Attach a WebVTT Ruby Object.<br>
<br>
<b>If the tag name is "</b><span class="s5"><b>rt</b></span><b>"<br>
</b>If <i>current</i> is a WebVTT Ruby Object, then attach a WebVTT Ruby Text Object.<br>
<br>
<b>If the tag name is "</b><span class="s5"><b>v</b></span><b>"<br>
</b>Attach a WebVTT Voice Object, and set its value to the token's annotation string, or the empty string if there is no annotation string.<br>
<br>
<b>If the tag name is "</b><span class="s5"><b>lang</b></span><b>"<br>
</b>Push the value of the token's annotation string, or the empty string if there is no annotation string, onto the <i>language stack</i>; then attach a WebVTT Language Object.<br>
<br>
<b>Otherwise<br>
</b>Ignore the token.<br>
<br>
<br>
When the steps above say to <b><i>attach a WebVTT Internal Node Object</i></b> of a particular concrete class, the user agent must run the following steps:</li>
  <ol class="ol1">
    <li class="li8">Create a new WebVTT Internal Node Object of the specified concrete class.</li>
    <li class="li8">Set the new object's list of applicable classes to the list of classes in the token, excluding any classes that are the empty string.</li>
    <li class="li8">Set the new object's applicable language to the top entry on the <i>language stack</i>, if the stack is not empty.</li>
    <li class="li8">Append the newly created node object to <i>current</i>.</li>
    <li class="li8">Let <i>current</i> be the newly created node object.</li>
  </ol>
  <li class="li4"><br>
<b>If <i>token</i> is an end tag<br>
</b>If any of the following conditions is true, then let <i>current</i> be the parent node of <i>current</i>.</li>
  <ol class="ol1">
    <li class="li10">The tag name of the end tag token <i>token</i> is "<span class="s5">c</span>" and <i>current</i> is a WebVTT Class Object.</li>
    <li class="li10">The tag name of the end tag token <i>token</i> is "<span class="s5">i</span>" and <i>current</i> is a WebVTT Italic Object.</li>
    <li class="li10">The tag name of the end tag token <i>token</i> is "<span class="s5">b</span>" and <i>current</i> is a WebVTT Bold Object.</li>
    <li class="li10">The tag name of the end tag token <i>token</i> is "<span class="s5">u</span>" and <i>current</i> is a WebVTT Underline Object.</li>
    <li class="li10">The tag name of the end tag token <i>token</i> is "<span class="s5">ruby</span>" and <i>current</i> is a WebVTT Ruby Object.</li>
    <li class="li10">The tag name of the end tag token <i>token</i> is "<span class="s5">rt</span>" and <i>current</i> is a WebVTT Ruby Text Object.</li>
    <li class="li10">The tag name of the end tag token <i>token</i> is "<span class="s5">v</span>" and <i>current</i> is a WebVTT Voice Object.</li>
  </ol>
  <li class="li8">Otherwise, if the tag name of the end tag token <i>token</i> is "<span class="s5">lang</span>" and <i>current</i> is a WebVTT Language Object, then let <i>current</i> be the parent node of <i>current</i>, and pop the top value from the <i>language stack</i>.<br>
Otherwise, if the tag name of the end tag token <i>token</i> is "<span class="s5">ruby</span>" and <i>current</i> is a WebVTT Ruby Text Object, then let <i>current</i> be the parent node of the parent node of <i>current</i>.<br>
Otherwise, ignore the token.<br>
<br>
<b>If <i>token</i> is a timestamp tag</b></li>
  <ol class="ol1">
    <li class="li8">Let <i>input</i> be the tag value.</li>
    <li class="li8">Let <i>position</i> be a pointer into <i>input</i>, initially pointing at the start of the string.</li>
    <li class="li8">Collect a WebVTT timestamp.</li>
    <li class="li8">If that algorithm does not fail, and if <i>position</i> now points at the end of <i>input</i> (i.e. there are no trailing characters after the timestamp), then create a WebVTT Timestamp Object whose value is the collected time, then append it to <i>current</i>.<br>
Otherwise, ignore the token.</li>
  </ol>
  <li class="li4"><br>
</li>
  <li class="li8">Jump to the step labeled <i>loop</i>.</li>
</ol>
<p class="p8">The <b><i>WebVTT cue text tokenizer</i></b> is as follows. It emits a token, which is either a string (whose value is a sequence of characters), a start tag (with a tag name, a list of classes, and optionally an annotation), an end tag (with a tag name), or a timestamp tag (with a tag value).</p>
<ol class="ol1">
  <li class="li8">Let <i>input</i> and <i>position</i> be the same variables as those of the same name in the algorithm that invoked these steps.</li>
  <li class="li8">Let <i>tokenizer state</i> be WebVTT data state.</li>
  <li class="li8">Let <i>result</i> be the empty string.</li>
  <li class="li8">Let <i>buffer</i> be the empty string.</li>
  <li class="li8">Let <i>classes</i> be an empty list.</li>
  <li class="li8"><i>Loop</i>: If <i>position</i> is past the end of <i>input</i>, let <i>c</i> be an end-of-file marker. Otherwise, let <i>c</i> be the character in <i>input</i> pointed to by <i>position</i>.<br>
<span class="s11">NOTE<br>
</span><span class="s12">An end-of-file marker is not a Unicode character, it is used to end the tokenizer.<br>
</span></li>
  <li class="li8">Jump to the state given by <i>tokenizer state</i>:<br>
<b><i>WebVTT data state</i><br>
</b>Jump to the entry that matches the value of <i>c</i>:<br>
<b>U+0026 AMPERSAND (&amp;)<br>
</b>Set <i>buffer</i> to <i>c</i>, set <i>tokenizer state</i> to the WebVTT escape state, and jump to the step labeled <i>next</i>.<br>
<br>
<b>U+003C LESS-THAN SIGN (&lt;)<br>
</b>If <i>result</i> is the empty string, then set <i>tokenizer state</i> to the WebVTT tag state and jump to the step labeled <i>next</i>.<br>
Otherwise, return a string token whose value is <i>result</i> and abort these steps.<br>
<br>
<b>End-of-file marker<br>
</b>Return a string token whose value is <i>result</i> and abort these steps.<br>
<br>
<b>Anything else<br>
</b>Append <i>c</i> to <i>result</i> and jump to the step labeled <i>next</i>.<br>
<br>
<br>
<br>
<b><i>WebVTT escape state</i><br>
</b>Jump to the entry that matches the value of <i>c</i>:<br>
<b>U+0026 AMPERSAND (&amp;)<br>
</b>Append <i>buffer</i> to <i>result</i>, set <i>buffer</i> to <i>c</i>, and jump to the step labeled <i>next</i>.<br>
<br>
<b>Alphanumeric ASCII characters<br>
</b>Append <i>c</i> to <i>buffer</i> and jump to the step labeled <i>next</i>.<br>
<br>
<b>U+003B SEMICOLON character (;)<br>
</b>First, examine the value of <i>buffer</i>:<br>
If <i>buffer</i> is the string "<span class="s5">&amp;amp</span>", then append a U+0026 AMPERSAND character (&amp;) to <i>result</i>.<br>
If <i>buffer</i> is the string "<span class="s5">&amp;lt</span>", then append a U+003C LESS-THAN SIGN character (&lt;) to <i>result</i>.<br>
If <i>buffer</i> is the string "<span class="s5">&amp;gt</span>", then append a U+003E GREATER-THAN SIGN character (&gt;) to <i>result</i>.<br>
If <i>buffer</i> is the string "<span class="s5">&amp;lrm</span>", then append a U+200E LEFT-TO-RIGHT MARK character to <i>result</i>.<br>
If <i>buffer</i> is the string "<span class="s5">&amp;rlm</span>", then append a U+200F RIGHT-TO-LEFT MARK character to <i>result</i>.<br>
If <i>buffer</i> is the string "<span class="s5">&amp;nbsp</span>", then append a U+00A0 NO-BREAK SPACE character to <i>result</i>.<br>
Otherwise, append <i>buffer</i> followed by a U+003B SEMICOLON character (;) to <i>result</i>.<br>
Then, in any case, set <i>tokenizer state</i> to the WebVTT data state, and jump to the step labeled <i>next</i>.<br>
<br>
<b>U+003C LESS-THAN SIGN (&lt;)<br>
End-of-file marker<br>
</b>Append <i>buffer</i> to <i>result</i>, return a string token whose value is <i>result</i>, and abort these steps.<br>
<br>
<b>Anything else<br>
</b>Append <i>buffer</i> to <i>result</i>, append <i>c</i> to <i>result</i>, set <i>tokenizer state</i> to the WebVTT data state, and jump to the step labeled <i>next</i>.<br>
<br>
<br>
<br>
<b><i>WebVTT tag state</i><br>
</b>Jump to the entry that matches the value of <i>c</i>:<br>
<b>U+0009 CHARACTER TABULATION (tab) character<br>
U+000A LINE FEED (LF) character<br>
U+000C FORM FEED (FF) character<br>
U+0020 SPACE character<br>
</b>Set <i>tokenizer state</i> to the WebVTT start tag annotation state, and jump to the step labeled <i>next</i>.<br>
<br>
<b>U+002E FULL STOP character (.)<br>
</b>Set <i>tokenizer state</i> to the WebVTT start tag class state, and jump to the step labeled <i>next</i>.<br>
<br>
<b>U+002F SOLIDUS character (/)<br>
</b>Set <i>tokenizer state</i> to the WebVTT end tag state, and jump to the step labeled <i>next</i>.<br>
<br>
<b>ASCII digits<br>
</b>Set <i>result</i> to <i>c</i>, set <i>tokenizer state</i> to the WebVTT timestamp tag state, and jump to the step labeled <i>next</i>.<br>
<br>
<b>U+003E GREATER-THAN SIGN character (&gt;)<br>
</b>Advance <i>position</i> to the next character in <i>input</i>, then jump to the next "end-of-file marker" entry below.<br>
<br>
<b>End-of-file marker<br>
</b>Return a start tag whose tag name is the empty string, with no classes and no annotation, and abort these steps.<br>
<br>
<b>Anything else<br>
</b>Set <i>result</i> to <i>c</i>, set <i>tokenizer state</i> to the WebVTT start tag state, and jump to the step labeled <i>next</i>.<br>
<br>
<br>
<br>
<b><i>WebVTT start tag state</i><br>
</b>Jump to the entry that matches the value of <i>c</i>:<br>
<b>U+0009 CHARACTER TABULATION (tab) character<br>
U+000C FORM FEED (FF) character<br>
U+0020 SPACE character<br>
</b>Set <i>tokenizer state</i> to the WebVTT start tag annotation state, and jump to the step labeled <i>next</i>.<br>
<br>
<b>U+000A LINE FEED (LF) character<br>
</b>Set <i>buffer</i> to <i>c</i>, set <i>tokenizer state</i> to the WebVTT start tag annotation state, and jump to the step labeled <i>next</i>.<br>
<br>
<b>U+002E FULL STOP character (.)<br>
</b>Set <i>tokenizer state</i> to the WebVTT start tag class state, and jump to the step labeled <i>next</i>.<br>
<br>
<b>U+003E GREATER-THAN SIGN character (&gt;)<br>
</b>Advance <i>position</i> to the next character in <i>input</i>, then jump to the next "end-of-file marker" entry below.<br>
<br>
<b>End-of-file marker<br>
</b>Return a start tag whose tag name is <i>result</i>, with no classes and no annotation, and abort these steps.<br>
<br>
<b>Anything else<br>
</b>Append <i>c</i> to <i>result</i> and jump to the step labeled <i>next</i>.<br>
<br>
<br>
<br>
<b><i>WebVTT start tag class state</i><br>
</b>Jump to the entry that matches the value of <i>c</i>:<br>
<b>U+0009 CHARACTER TABULATION (tab) character<br>
U+000C FORM FEED (FF) character<br>
U+0020 SPACE character<br>
</b>Append to <i>classes</i> an entry whose value is <i>buffer</i>, set <i>buffer</i> to the empty string, set <i>tokenizer state</i> to the WebVTT start tag annotation state, and jump to the step labeled <i>next</i>.<br>
<br>
<b>U+000A LINE FEED (LF) character<br>
</b>Append to <i>classes</i> an entry whose value is <i>buffer</i>, set <i>buffer</i> to <i>c</i>, set <i>tokenizer state</i> to the WebVTT start tag annotation state, and jump to the step labeled <i>next</i>.<br>
<br>
<b>U+002E FULL STOP character (.)<br>
</b>Append to <i>classes</i> an entry whose value is <i>buffer</i>, set <i>buffer</i> to the empty string, and jump to the step labeled <i>next</i>.<br>
<br>
<b>U+003E GREATER-THAN SIGN character (&gt;)<br>
</b>Advance <i>position</i> to the next character in <i>input</i>, then jump to the next "end-of-file marker" entry below.<br>
<br>
<b>End-of-file marker<br>
</b>Append to <i>classes</i> an entry whose value is <i>buffer</i>, then return a start tag whose tag name is <i>result</i>, with the classes given in <i>classes</i> but no annotation, and abort these steps.<br>
<br>
<b>Anything else<br>
</b>Append <i>c</i> to <i>buffer</i> and jump to the step labeled <i>next</i>.<br>
<br>
<br>
<br>
<b><i>WebVTT start tag annotation state</i><br>
</b>Jump to the entry that matches the value of <i>c</i>:<br>
<b>U+003E GREATER-THAN SIGN character (&gt;)<br>
</b>Advance <i>position</i> to the next character in <i>input</i>, then jump to the next "end-of-file marker" entry below.<br>
<br>
<b>End-of-file marker<br>
</b>Remove any leading or trailing space characters from <i>buffer</i>, and replace any sequence of one or more consecutive space characters in <i>buffer</i> with a single U+0020 SPACE character; then, return a start tag whose tag name is <i>result</i>, with the classes given in <i>classes</i>, and with <i>buffer</i> as the annotation, and abort these steps.<br>
<br>
<b>Anything else<br>
</b>Append <i>c</i> to <i>buffer</i> and jump to the step labeled <i>next</i>.<br>
<br>
<br>
<br>
<b><i>WebVTT end tag state</i><br>
</b>Jump to the entry that matches the value of <i>c</i>:<br>
<b>U+003E GREATER-THAN SIGN character (&gt;)<br>
</b>Advance <i>position</i> to the next character in <i>input</i>, then jump to the next "end-of-file marker" entry below.<br>
<br>
<b>End-of-file marker<br>
</b>Return an end tag whose tag name is <i>result</i> and abort these steps.<br>
<br>
<b>Anything else<br>
</b>Append <i>c</i> to <i>result</i> and jump to the step labeled <i>next</i>.<br>
<br>
<br>
<br>
<b><i>WebVTT timestamp tag state</i><br>
</b>Jump to the entry that matches the value of <i>c</i>:<br>
<b>U+003E GREATER-THAN SIGN character (&gt;)<br>
</b>Advance <i>position</i> to the next character in <i>input</i>, then jump to the next "end-of-file marker" entry below.<br>
<br>
<b>End-of-file marker<br>
</b>Return a timestamp tag whose tag name is <i>result</i> and abort these steps.<br>
<br>
<b>Anything else<br>
</b>Append <i>c</i> to <i>result</i> and jump to the step labeled <i>next</i>.<br>
<br>
<br>
<br>
</li>
  <li class="li8"><i>Next</i>: Advance <i>position</i> to the next character in <i>input</i>.</li>
  <li class="li8">Jump to the step labeled <i>loop</i>.</li>
</ol>
<p class="p14"><b>4.4 </b><span class="s2"><b><i>WebVTT </i></b></span><b><i>cue text DOM construction rules</i></b></p>
<p class="p8">To convert a list of WebVTT Node Objects to a DOM tree for <span class="s5">Document</span> <i>owner</i>, user agents must create a tree of DOM nodes that is isomorphous to the tree of WebVTT Node Objects, with the following mapping of WebVTT Node Objects to DOM nodes:</p>
<table cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="top" class="td1">
        <p class="p23"><b>WebVTT Node Object</b></p>
      </td>
      <td valign="top" class="td2">
        <p class="p23"><b>DOM node</b></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td1">
        <p class="p4">List of WebVTT Node Objects</p>
      </td>
      <td valign="top" class="td2">
        <p class="p12">DocumentFragment<span class="s8"> node</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td1">
        <p class="p4">WebVTT Class Object</p>
      </td>
      <td valign="top" class="td2">
        <p class="p24">HTMLElement<span class="s4"> element node with </span>localName<span class="s4"> "</span>span<span class="s4">".</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td1">
        <p class="p4">WebVTT Italic Object</p>
      </td>
      <td valign="top" class="td2">
        <p class="p4"><span class="s5">HTMLElement</span> element node with <span class="s5">localName</span> "<span class="s5">i</span>".</p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td1">
        <p class="p4">WebVTT Bold Object</p>
      </td>
      <td valign="top" class="td2">
        <p class="p4"><span class="s5">HTMLElement</span> element node with <span class="s5">localName</span> "<span class="s5">b</span>".</p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td1">
        <p class="p4">WebVTT Underline Object</p>
      </td>
      <td valign="top" class="td2">
        <p class="p4"><span class="s5">HTMLElement</span> element node with <span class="s5">localName</span> "<span class="s5">u</span>".</p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td1">
        <p class="p4">WebVTT Ruby Object</p>
      </td>
      <td valign="top" class="td2">
        <p class="p24">HTMLElement<span class="s4"> element node with </span>localName<span class="s4"> "</span>ruby<span class="s4">".</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td1">
        <p class="p4">WebVTT Ruby Text Object</p>
      </td>
      <td valign="top" class="td2">
        <p class="p4"><span class="s5">HTMLElement</span> element node with <span class="s5">localName</span> "<span class="s5">rt</span>".</p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td1">
        <p class="p4">WebVTT Voice Object</p>
      </td>
      <td valign="top" class="td2">
        <p class="p4"><span class="s5">HTMLElement</span> element node with <span class="s5">localName</span> "<span class="s5">span</span>", and a <span class="s5">title</span> attribute set to the WebVTT Voice Object's value.</p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td1">
        <p class="p4">WebVTT Class Object</p>
      </td>
      <td valign="top" class="td2">
        <p class="p4"><span class="s5">HTMLElement</span> element node with <span class="s5">localName</span> "<span class="s5">span</span>", and a <span class="s5">lang</span> attribute set to the WebVTT Language Object's applicable language.</p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td1">
        <p class="p4">WebVTT Text Object</p>
      </td>
      <td valign="top" class="td2">
        <p class="p4"><span class="s5">Text</span> node whose character data is the value of the WebVTT Text Object.</p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td1">
        <p class="p4">WebVTT Timestamp Object</p>
      </td>
      <td valign="top" class="td2">
        <p class="p4"><span class="s13">ProcessingInstruction</span> node whose <span class="s5">target</span> is "<span class="s5">timestamp</span>" and whose <span class="s5">data</span> is a WebVTT timestamp representing the value of the WebVTT Timestamp Object, with all optional components included, with one leading zero if the <i>hours</i> component is less than ten, and with no leading zeros otherwise.</p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p8"><span class="s5">HTMLElement</span> nodes created as part of the mapping described above must have their <span class="s5">namespaceURI</span> set to the HTML namespace, and, if the corresponding WebVTT Internal Node Object has any applicable classes, must have a <span class="s5">class</span> attribute set to the string obtained by concatenating all those classes, each separated from the next by a single U+0020 SPACE character.</p>
<p class="p8">The <span class="s5">ownerDocument</span> attribute of all nodes in the DOM tree must be set to the given document <i>owner</i>.</p>
<p class="p8">All characteristics of the DOM nodes that are not described above or dependent on characteristics defined above must be left at their initial values.</p>
<p class="p3"><b>5. Rendering</b></p>
<p class="p14"><b>5.1 Cues in isolation</b></p>
<p class="p8">The <b><i>rules for interpreting WebVTT cue text</i></b> (e.g. for use as chapter titles) are as follows:</p>
<ol class="ol1">
  <li class="li8">Let <i>nodes</i> be the list of WebVTT Node Objects obtained by applying the WebVTT cue text parsing rules to the <i>cue</i>'s text track cue text.</li>
  <li class="li18">...<span class="Apple-converted-space">&nbsp;</span></li>
</ol>
<p class="p14"><b>5.2 Cues with video</b></p>
<p class="p25"><b>5.2.1 Processing model</b></p>
<p class="p8">The <b><i>rules for updating the display of WebVTT text tracks</i></b> render the text tracks of a media element (specifically, a <span class="s5">video</span> element), or of another playback mechanism, by applying the steps below. All the text tracks that use these rules for a given media element, or other playback mechanism, are rendered together, to avoid overlapping subtitles from multiple tracks.</p>
<p class="p8">The output of the steps below is a set of CSS boxes that covers the rendering area of the media element or other playback mechanism, which user agents are expected to render in a manner suiting the user.</p>
<p class="p8">The rules are as follows:</p>
<ol class="ol1">
  <li class="li8">If the media element is an <span class="s5">audio</span> element, or is another playback mechanism with no rendering area, abort these steps. There is nothing to render.</li>
  <li class="li8">Let <i>video</i> be the media element or other playback mechanism.</li>
  <li class="li8">Let <i>output</i> be an empty list of absolutely positioned CSS block boxes.</li>
  <li class="li8">If the user agent is exposing a user interface for <i>video</i>, add to <i>output</i> one or more completely transparent positioned CSS block boxes that cover the same region as the user interface.</li>
  <li class="li8">If the last time these rules were run, the user agent was not exposing a user interface for <i>video</i>, but now it is, optionally let <i>reset</i> be true. Otherwise, let <i>reset</i> be false.</li>
  <li class="li8">Let <i>tracks</i> be the subset of <i>video</i>'s list of text tracks that have as their rules for updating the text track rendering these rules for updating the display of WebVTT text tracks, and whose text track mode is showing.</li>
  <li class="li8">Let <i>cues</i> be an empty list of text track cues.</li>
  <li class="li8">For each track <i>track</i> in <i>tracks</i>, append to <i>cues</i> all the cues from <i>track</i>'s list of cues that have their text track cue active flag set.</li>
  <li class="li8">If <i>reset</i> is false, then, for each text track cue <i>cue</i> in <i>cues</i>: if <i>cue</i>'s text track cue display state has a set of CSS boxes, then add those boxes to <i>output</i>, and remove <i>cue</i> from <i>cues</i>.</li>
  <li class="li8">For each text track cue <i>cue</i> in <i>cues</i> that has not yet had corresponding CSS boxes added to <i>output</i>, in text track cue order, run the following substeps:</li>
  <ol class="ol1">
    <li class="li8">Let <i>nodes</i> be the list of WebVTT Node Objects obtained by applying the WebVTT cue text parsing rules to the <i>cue</i>'s text track cue text.</li>
    <li class="li8">Apply the Unicode Bidirectional Algorithm's Paragraph Level steps to the concatenation of the values of each WebVTT Text Object in <i>nodes</i>, in a pre-order, depth-first traversal, excluding WebVTT Ruby Text Objects and their descendants, to determine the <i>paragraph embedding level</i> of the first Unicode paragraph of the cue. <span class="s6">[BIDI]</span><br>
<span class="s11">NOTE<br>
</span><span class="s12">Within a cue, paragraph boundaries are only denoted by Type B characters, such as U+000A LINE FEED (LF), U+0085 NEXT LINE (NEL), and U+2029 PARAGRAPH SEPARATOR. (This means each line of the cue is reordered as if it was a separate paragraph.)<br>
</span></li>
    <li class="li8">If the <i>paragraph embedding level</i> determined in the previous step is even (the <i>paragraph direction</i> is left-to-right), let <i>direction</i> be 'ltr', otherwise, let it be 'rtl'.</li>
    <li class="li8">If the text track cue writing direction is horizontal, then let <i>writing-mode</i> be 'horizontal-tb'. Otherwise, if the text track cue writing direction is vertical growing left, then let <i>writing-mode</i> be 'vertical-rl'. Otherwise, the text track cue writing direction is vertical growing right; let <i>writing-mode</i> be 'vertical-lr'.</li>
    <li class="li8">Determine the value of <i>maximum size</i> for <i>cue</i> as per the appropriate rules from the following list:<br>
<b>If the text track cue writing direction is horizontal, the text track cue alignment is start, and <i>direction</i> is 'ltr'<br>
If the text track cue writing direction is horizontal, the text track cue alignment is end, and <i>direction</i> is 'rtl'<br>
If the text track cue writing direction is horizontal, and the text track cue alignment is left<br>
If the text track cue writing direction is vertical growing left, and the text track cue alignment is start or left<br>
If the text track cue writing direction is vertical growing right, and the text track cue alignment is start or left<br>
</b>Let <i>maximum size</i> be the text track cue text position subtracted from 100.<br>
<br>
<b>If the text track cue writing direction is horizontal, the text track cue alignment is end, and <i>direction</i> is 'ltr'<br>
If the text track cue writing direction is horizontal, the text track cue alignment is start, and <i>direction</i> is 'rtl'<br>
If the text track cue writing direction is horizontal, and the text track cue alignment is right<br>
If the text track cue writing direction is vertical growing left, and the text track cue alignment is end or right<br>
If the text track cue writing direction is vertical growing right, and the text track cue alignment is end or right<br>
</b>Let <i>maximum size</i> be the text track cue text position.<br>
<br>
<b>If the text track cue alignment is middle, the text track cue text position is less than or equal to 50<br>
</b>Let <i>maximum size</i> be the text track cue text position multiplied by two.<br>
<br>
<b>If the text track cue alignment is middle, the text track cue text position is greater than 50<br>
</b>Let <i>maximum size</i> be the result of subtracting text track cue text position from 100 and then multiplying the result by two.<br>
<br>
</li>
    <li class="li8">If the text track cue size is less than <i>maximum size</i>, then let <i>size</i> be text track cue size. Otherwise, let <i>size</i> be <i>maximum size</i>.</li>
    <li class="li8">If the text track cue writing direction is horizontal, then let <i>width</i> be '<i>size</i> vw' and <i>height</i> be 'auto'. Otherwise, let <i>width</i> be 'auto' and <i>height</i> be '<i>size</i> vh'. (These are CSS values used by the next section to set CSS properties for the rendering; 'vw' and 'vh' are CSS units.) <span class="s6">[CSSVALUES]</span></li>
    <li class="li8">Determine the value of <i>x-position</i> or <i>y-position</i> for <i>cue</i> as per the appropriate rules from the following list:<br>
<b>If the text track cue writing direction is horizontal, the text track cue alignment is start, and <i>direction</i> is 'ltr'<br>
If the text track cue writing direction is horizontal, the text track cue alignment is left, and <i>direction</i> is 'ltr'<br>
</b>Let <i>x-position</i> be the text track cue text position.<br>
<br>
<b>If the text track cue writing direction is horizontal, the text track cue alignment is end, and <i>direction</i> is 'rtl'<br>
If the text track cue writing direction is horizontal, the text track cue alignment is left, and <i>direction</i> is 'rtl'<br>
</b>Let <i>x-position</i> be the text track cue text position subtracted from 100.<br>
<br>
<b>If the text track cue writing direction is horizontal, the text track cue alignment is end, and <i>direction</i> is 'ltr'<br>
If the text track cue writing direction is horizontal, the text track cue alignment is right, and <i>direction</i> is 'ltr'<br>
</b>Let <i>x-position</i> be the text track cue text position minus <i>size</i>.<br>
<br>
<b>If the text track cue writing direction is horizontal, the text track cue alignment is start, and <i>direction</i> is 'rtl'<br>
If the text track cue writing direction is horizontal, the text track cue alignment is right, and <i>direction</i> is 'rtl'<br>
</b>Let <i>x-position</i> be the text track cue text position subtracted from 100, minus <i>size</i>.<br>
<br>
<b>If the text track cue writing direction is vertical growing left, and the text track cue alignment is start or left<br>
If the text track cue writing direction is vertical growing right, and the text track cue alignment is start or left<br>
</b>Let <i>y-position</i> be the text track cue text position.<br>
<br>
<b>If the text track cue writing direction is vertical growing left, and the text track cue alignment is end or right<br>
If the text track cue writing direction is vertical growing right, and the text track cue alignment is end or right<br>
</b>Let <i>y-position</i> be the text track cue text position minus <i>size</i>.<br>
<br>
<b>If the text track cue writing direction is horizontal, the text track cue alignment is middle, and <i>direction</i> is 'ltr'<br>
</b>Let <i>x-position</i> be the text track cue text position minus half of <i>size</i>.<br>
<br>
<b>If the text track cue writing direction is horizontal, the text track cue alignment is middle, and <i>direction</i> is 'rtl'<br>
</b>Let <i>x-position</i> be the text track cue text position subtracted from 100, minus half of <i>size</i>.<br>
<br>
<b>If the text track cue writing direction is vertical growing left, and the text track cue alignment is middle<br>
If the text track cue writing direction is vertical growing right, and the text track cue alignment is middle<br>
</b>Let <i>y-position</i> be the text track cue text position minus half of <i>size</i>.<br>
<br>
</li>
    <li class="li8">Determine the value of whichever of <i>x-position</i> or <i>y-position</i> is not yet calculated for <i>cue</i> as per the appropriate rules from the following list:<br>
<b>If the text track cue writing direction is horizontal, and the text track cue snap-to-lines flag is set<br>
</b>Let <i>y-position</i> be zero.<br>
<br>
<b>If the text track cue writing direction is horizontal, and the text track cue snap-to-lines flag is not set<br>
</b>Let <i>y-position</i> be the text track cue computed line position.<br>
<br>
<b>If the text track cue writing direction is vertical growing left, and the text track cue snap-to-lines flag is set<br>
If the text track cue writing direction is vertical growing right, and the text track cue snap-to-lines flag is set<br>
</b>Let <i>x-position</i> be zero.<br>
<br>
<b>If the text track cue writing direction is vertical growing left, and the text track cue snap-to-lines flag is not set<br>
If the text track cue writing direction is vertical growing right, and the text track cue snap-to-lines flag is not set<br>
</b>Let <i>x-position</i> be the text track cue computed line position.<br>
<br>
<br>
<span class="s11">NOTE<br>
</span><span class="s12">These are not final positions, they are merely temporary positions used to calculate box dimensions below.<br>
</span></li>
    <li class="li8">If the text track cue snap-to-lines flag is set, then run the appropriate steps from the following list:<br>
<b>If the text track cue writing direction is horizontal</b></li>
    <ul class="ul3">
      <li class="li8">Let <i>edge margin</i> be a user-agent-defined horizontal length, expressed as a percentage of the width of the <i>video</i>'s rendering area, which will be used to define a margin at the left and right edges of the video into which this cue will not be placed. In situations with overscan, this margin should be sufficient to place the cue within the title-safe area. In the absence of overscan, this value should be picked for aesthetics (to avoid text being aligned precisely on the left or right edge of the video, which can be ugly).</li>
      <li class="li8">If <i>x-position</i> is less than <i>edge margin</i> and the sum of <i>x-position</i> and <i>size</i> is more than <i>edge margin</i>, then increase <i>x-position</i> by <i>edge margin</i> and decrease <i>size</i> by the same amount.</li>
      <li class="li8">Let <i>right margin edge</i> be 100 minus <i>edge margin</i>.</li>
      <li class="li8">If <i>x-position</i> is less than <i>right margin edge</i>, and the sum of <i>x-position</i> and <i>size</i> is more than <i>right margin edge</i>, then decrease <i>size</i> by <i>edge margin</i>.</li>
    </ul>
    <li class="li4"><br>
<b>If the text track cue writing direction is vertical growing left<br>
If the text track cue writing direction is vertical growing right</b></li>
    <ul class="ul3">
      <li class="li8">Let <i>edge margin</i> be a user-agent-defined vertical length, expressed as a percentage of the height of the <i>video</i>'s rendering area, which will be used to define a margin at the top and bottom edges of the video into which this cue will not be placed. In situations with overscan, this margin should be sufficient to place the cue within the title-safe area. In the absence of overscan, this value should be picked for aesthetics (to avoid text being aligned precisely on the top or bottom edge of the video, which can be ugly).</li>
      <li class="li8">If <i>y-position</i> is less than <i>edge margin</i> and the sum of <i>y-position</i> and <i>size</i> is more than <i>edge margin</i>, then increase <i>y-position</i> by <i>edge margin</i> and decrease <i>size</i> by the same amount.</li>
      <li class="li8">Let <i>bottom margin edge</i> be 100 minus <i>edge margin</i>.</li>
      <li class="li8">If <i>y-position</i> is less than <i>bottom margin edge</i>, and the sum of <i>y-position</i> and <i>size</i> is more than <i>right margin edge</i>, then decrease <i>size</i> by <i>edge margin</i>.</li>
    </ul>
    <li class="li4"><br>
</li>
    <li class="li8">Let <i>left</i> be '<i>x-position</i> vw' and <i>top</i> be '<i>y-position</i> vh'. (These again are CSS values used by the next section to set CSS properties for the rendering; 'vw' and 'vh' are CSS units.) <span class="s6">[CSSVALUES]</span></li>
    <li class="li8">Apply the terms of the CSS specifications to <i>nodes</i> within the following constraints, thus obtaining a set of CSS boxes positioned relative to an initial containing block: <span class="s6">[CSS]</span></li>
    <ul class="ul3">
      <li class="li8">The <i>document tree</i> is the tree of WebVTT Node Objects rooted at <i>nodes</i>.</li>
      <li class="li8">For the purposes of processing by the CSS specification, WebVTT Internal Node Objects are equivalent to elements with the same contents.</li>
      <li class="li10">For the purposes of processing by the CSS specification, WebVTT Text Objects are equivalent to <span class="s5">Text</span> nodes.</li>
      <li class="li10">No style sheets are associated with <i>nodes</i>. (The nodes are subsequently restyled using style sheets after their boxes are generated, as described below.)</li>
      <li class="li10">The children of the <i>nodes</i> must be wrapped in an anonymous box whose 'display' property has the value 'inline'. This is the <b><i>WebVTT cue background box</i></b>.</li>
      <li class="li10">Runs of children of WebVTT Ruby Objects that are not WebVTT Ruby Text Objects must be wrapped in anonymous boxes whose 'display' property has the value 'ruby-base'. <span class="s6">[CSSRUBY]</span></li>
      <li class="li10">Properties on WebVTT Node Objects have their values set as defined in the next section. (That section uses some of the variables whose values were calculated earlier in this algorithm.)</li>
      <li class="li10">Text runs must be wrapped according to the CSS line-wrapping rules, with the following additional constraints:</li>
      <ul class="ul3">
        <li class="li10">Regardless of the value of the 'white-space' property, lines must be wrapped at the edge of their containing blocks, even if doing so requires splitting a word where there is no line breaking opportunity. (Thus, normally text wraps as needed, but if there is a particularly long word, it does not overflow as it normally would in CSS, it is instead forcibly wrapped at the box's edge.)</li>
        <li class="li10">Regardless of the value of the 'white-space' property, any line breaks inserted by the user agent for the purposes of line wrapping must be placed so as to minimize Δ across each run of consecutive lines between preserved newlines in the source. Δ for a set of lines is defined as the sum over each line of the absolute of the difference between the line's length and the mean line length of the set.</li>
      </ul>
      <li class="li10">The viewport (and initial containing block) is <i>video</i>'s rendering area.</li>
    </ul>
    <li class="li8">Let <i>boxes</i> be the boxes generated as descendants of the initial containing block, along with their positions.</li>
    <li class="li8">If there are no line boxes in <i>boxes</i>, skip the remainder of these substeps for <i>cue</i>. The cue is ignored.</li>
    <li class="li8">Adjust the positions of <i>boxes</i> according to the appropriate steps from the following list:<br>
<b>If <i>cue</i>'s text track cue snap-to-lines flag is set<br>
</b>Many of the steps in this algorithm vary according to the text track cue writing direction. Steps labeled "<b>Horizontal</b>" must be followed only when the text track cue writing direction is horizontal, steps labeled "<b>Vertical</b>" must be followed when the text track cue writing direction is either vertical growing left or vertical growing right, steps labeled "<b>Vertical Growing Left</b>" must be followed only when the text track cue writing direction is vertical growing left, and steps labeled "<b>Vertical Growing Right</b>" must be followed only when the text track cue writing direction is vertical growing right.</li>
    <ul class="ul3">
      <li class="li8"><b>Horizontal</b>: Let <i>margin</i> be a user-agent-defined vertical length which will be used to define a margin at the top and bottom edges of the video into which cues will not be placed. In situations with overscan, this margin should be sufficient to place all cues within the title-safe area. In the absence of overscan, this value should be picked for aesthetics (to avoid text being aligned precisely on the bottom edge of the video, which can be ugly).<br>
<b>Vertical</b>: Let <i>margin</i> be a user-agent-defined horizontal length which will be used to define a margin at the left and right edges of the video into which cues will not be placed. In situations with overscan, this margin should be sufficient to place all cues within the title-safe area. In the absence of overscan, this value should be picked for aesthetics (to avoid text being aligned precisely on the left or right edges of the video, which can be ugly).</li>
      <li class="li8"><b>Horizontal</b>: Let <i>full dimension</i> be the height of <i>video</i>'s rendering area.<br>
<b>Vertical</b>: Let <i>full dimension</i> be the width of <i>video</i>'s rendering area.<br>
These dimensions must not be adjusted for overscan. (The algorithm does that separately.)</li>
      <li class="li8">Let <i>max dimension</i> be <i>full&nbsp;dimension</i>&nbsp;-&nbsp;(2&nbsp;×&nbsp;<i>margin</i>).</li>
      <li class="li8"><b>Horizontal</b>: Let <i>step</i> be the height of the first line box in <i>boxes</i>.<br>
<b>Vertical</b>: Let <i>step</i> be the width of the first line box in <i>boxes</i>.</li>
      <li class="li8">If <i>step</i> is zero, then jump to the step labeled <i>done positioning</i> below.</li>
      <li class="li8">Let <i>line position</i> be the text track cue computed line position.</li>
      <li class="li8"><b>Vertical Growing Left</b>: Add one to <i>line position</i> then negate it.</li>
      <li class="li8">Let <i>position</i> be the result of multiplying <i>step</i> and <i>line position</i>.</li>
      <li class="li8"><b>Vertical Growing Left</b>: Decrease <i>position</i> by the width of the bounding box of the boxes in <i>boxes</i>, then increase <i>position</i> by <i>step</i>.</li>
      <li class="li8">If <i>line position</i> is less than zero then increase <i>position</i> by <i>max dimension</i>, and negate <i>step</i>.<br>
Otherwise, increase <i>position</i> by <i>margin</i>.</li>
      <li class="li8"><b>Horizontal</b>: Move all the boxes in <i>boxes</i> down by the distance given by <i>position</i>.<br>
<b>Vertical</b>: Move all the boxes in <i>boxes</i> right by the distance given by <i>position</i>.</li>
      <li class="li8">Remember the position of all the boxes in <i>boxes</i> as their <i>specified position</i>.</li>
      <li class="li8">Let <i>best position</i> be null. It will hold a position for <i>boxes</i>, much like <i>specified position</i> in the previous step.</li>
      <li class="li8">Let <i>best position score</i> be null.</li>
      <li class="li8">Let <i>switched</i> be false.</li>
      <li class="li8"><b>Horizontal</b>: Let <i>title area</i> be a box that covers all of the <i>video</i>'s rendering area except for a height of <i>margin</i> at the top of the rendering area and a height of <i>margin</i> at the bottom of the rendering area.<br>
<b>Vertical</b>: Let <i>title area</i> be a box that covers all of the <i>video</i>'s rendering area except for a width of <i>margin</i> at the left of the rendering area and a width of <i>margin</i> at the right of the rendering area.</li>
      <li class="li8"><i>Step loop</i>: If none of the boxes in <i>boxes</i> would overlap any of the boxes in <i>output</i>, and all of the boxes in <i>output</i> are entirely within the <i>title area</i> box, then jump to the step labeled <i>done positioning</i> below.</li>
      <li class="li8">Let <i>current position score</i> be the percentage of the area of the bounding box of the boxes in <i>boxes</i> that is outside the <i>title area</i> box.</li>
      <li class="li8">If <i>best position</i> is null (i.e. this is the first run through this loop, <i>switched</i> is still false, the boxes in <i>boxes</i> are at their <i>specified position</i>, and <i>best position score</i> is still null), or if <i>current position score</i> is a lower percentage than that in <i>best position score</i>, then remember the position of all the boxes in <i>boxes</i> as their <i>best position</i>, and set <i>best position score</i> to <i>current position score</i>.</li>
      <li class="li8"><b>Horizontal</b>: If <i>step</i> is negative and the top of the first line box in <i>boxes</i> is now above the top of the <i>title area</i>, or if <i>step</i> is positive and the bottom of the first line box in <i>boxes</i> is now below the bottom of the <i>title area</i>, jump to the step labeled <i>switch direction</i>.<br>
<b>Vertical</b>: If <i>step</i> is negative and the left edge of the first line box in <i>boxes</i> is now to the left of the left edge of the <i>title area</i>, or if <i>step</i> is positive and the right edge of the first line box in <i>boxes</i> is now to the right of the right edge of the <i>title area</i>, jump to the step labeled <i>switch direction</i>.</li>
      <li class="li8"><b>Horizontal</b>: Move all the boxes in <i>boxes</i> down by the distance given by <i>step</i>. (If <i>step</i> is negative, then this will actually result in an upwards movement of the boxes in absolute terms.)<br>
<b>Vertical</b>: Move all the boxes in <i>boxes</i> right by the distance given by <i>step</i>. (If <i>step</i> is negative, then this will actually result in a leftwards movement of the boxes in absolute terms.)</li>
      <li class="li8">Jump back to the step labeled <i>step loop</i>.</li>
      <li class="li8"><i>Switch direction</i>: If <i>switched</i> is true, then move all the boxes in <i>boxes</i> back to their <i>best position</i>, and jump to the step labeled <i>done positioning</i> below.</li>
      <li class="li8">Otherwise, move all the boxes in <i>boxes</i> back to their <i>specified position</i> as determined in the earlier step.</li>
      <li class="li8">Negate <i>step</i>.</li>
      <li class="li8">Set <i>switched</i> to true.</li>
      <li class="li8">Jump back to the step labeled <i>step loop</i>.</li>
    </ul>
    <li class="li4"><br>
<b>If <i>cue</i>'s text track cue snap-to-lines flag is not set</b></li>
    <ul class="ul3">
      <li class="li8">Set up <i>x</i> and <i>y</i> as follows:<br>
<b>If the text track cue writing direction is horizontal, and <i>direction</i> is 'ltr'<br>
</b>Let <i>x</i> be a percentage given by the text track cue text position, and let <i>y</i> be a percentage given by the text track cue computed line position.<br>
<br>
<b>If the text track cue writing direction is horizontal, and <i>direction</i> is 'rtl'<br>
</b>Let <i>x</i> be a percentage given by the text track cue text position subtracted from 100, and let <i>y</i> be a percentage given by the text track cue computed line position.<br>
<br>
<b>If the text track cue writing direction is vertical growing left<br>
</b>Let <i>x</i> be a percentage given by the text track cue computed line position subtracted from 100, and let <i>y</i> be a percentage given by the text track cue text position.<br>
<br>
<b>If the text track cue writing direction is vertical growing right<br>
</b>Let <i>x</i> be a percentage given by the text track cue computed line position, and let <i>y</i> be a percentage given by the text track cue text position.<br>
<br>
</li>
      <li class="li8">Position the boxes in <i>boxes</i> such that the point <i>x</i>% along the width of the bounding box of the boxes in <i>boxes</i> is <i>x</i>% of the way across the width of the <i>video</i>'s rendering area, and the point <i>y</i>% along the height of the bounding box of the boxes in <i>boxes</i> is <i>y</i>% of the way across the height of the <i>video</i>'s rendering area, while maintaining the relative positions of the boxes in <i>boxes</i> to each other.</li>
      <li class="li8">If none of the boxes in <i>boxes</i> would overlap any of the boxes in <i>output</i>, and all the boxes in <i>output</i> are within the <i>video</i>'s rendering area, then jump to the step labeled <i>done positioning</i> below.</li>
      <li class="li8">If there is a position to which the boxes in <i>boxes</i> can be moved while maintaining the relative positions of the boxes in <i>boxes</i> to each other such that none of the boxes in <i>boxes</i> would overlap any of the boxes in <i>output</i>, and all the boxes in <i>output</i> would be within the <i>video</i>'s rendering area, then move the boxes in <i>boxes</i> to the closest such position to their current position, and then jump to the step labeled <i>done positioning</i> below. If there are multiple such positions that are equidistant from their current position, use the highest one amongst them; if there are several at that height, then use the leftmost one amongst them.</li>
      <li class="li8">Otherwise, jump to the step labeled <i>done positioning</i> below. (The boxes will unfortunately overlap.)</li>
    </ul>
    <li class="li4"><br>
</li>
    <li class="li8"><i>Done positioning</i>: If there are any line boxes in the (possibly now repositioned) <i>boxes</i> that do not completely fit inside <i>video</i>'s rendering area, remove those offending line boxes from <i>boxes</i>.</li>
    <li class="li8">Let <i>cue</i>'s text track cue display state have the CSS boxes in <i>boxes</i>.</li>
    <li class="li8">Add the CSS boxes in <i>boxes</i> to <i>output</i>.</li>
  </ol>
  <li class="li8">Return <i>output</i>.</li>
</ol>
<p class="p8">User agents may allow the user to override the above algorithm's positioning of cues, e.g. by dragging them to another location on the <span class="s5">video</span>, or even off the <span class="s5">video</span> entirely.</p>
<p class="p25"><b>5.2.2 Applying CSS properties to </b><span class="s2"><b>WebVTT </b></span><b>Node Objects</b></p>
<p class="p8">When following the rules for updating the display of WebVTT text tracks, user agents must set properties of WebVTT Node Objects at the CSS user agent cascade layer as defined in this section. <span class="s6">[CSS]</span></p>
<p class="p8">On the (root) list of WebVTT Node Objects, the 'position' property must be set to 'absolute', the 'unicode-bidi' property must be set to 'plaintext', the 'direction' property must be set to <i>direction</i>, the 'writing-mode' property must be set to <i>writing-mode</i>, the 'top' property must be set to <i>top</i>, the 'left' property must be set to <i>left</i>, the 'width' property must be set to <i>width</i>, and the 'height' property must be set to <i>height</i>, where <i>direction</i>, <i>writing-mode</i>, <i>top</i>, <i>left</i>, <i>width</i>, and <i>height</i> are the values with those names determined by the rules for updating the display of WebVTT text tracks for the text track cue from whose text the list of WebVTT Node Objects was constructed.</p>
<p class="p8">The 'text-align' property on the (root) list of WebVTT Node Objects must be set to the value in the second cell of the row of the table below whose first cell is the value of the corresponding cue's text track cue alignment:</p>
<table cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="top" class="td3">
        <p class="p23"><b>Text track cue alignment</b></p>
      </td>
      <td valign="top" class="td4">
        <p class="p23"><b>'text-align' value</b></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p4">Start alignment</p>
      </td>
      <td valign="top" class="td4">
        <p class="p4">'start'</p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p4">Middle alignment</p>
      </td>
      <td valign="top" class="td4">
        <p class="p4">'center'</p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p4">End alignment</p>
      </td>
      <td valign="top" class="td4">
        <p class="p4">'end'</p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p4">Left alignment</p>
      </td>
      <td valign="top" class="td4">
        <p class="p4">'left'</p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p4">Right alignment</p>
      </td>
      <td valign="top" class="td4">
        <p class="p4">'right'</p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p8">The 'font' shorthand property on the (root) list of WebVTT Node Objects must be set to '5vh sans-serif'. <span class="s6">[CSSRUBY]</span> <span class="s6">[CSSVALUES]</span></p>
<p class="p8">The 'color' property on the (root) list of WebVTT Node Objects must be set to 'rgba(255,255,255,1)'. <span class="s6">[CSSCOLOR]</span></p>
<p class="p8">The 'background' shorthand property on the WebVTT cue background box must be set to 'rgba(0,0,0,0.8)'. <span class="s6">[CSSCOLOR]</span></p>
<p class="p8">A text outline or stroke may also be set on the (root) list of WebVTT Node Objects, if supported.</p>
<p class="p8">The 'white-space' property on the (root) list of WebVTT Node Objects must be set to 'pre-line'. <span class="s6">[CSS]</span></p>
<p class="p8">The 'font-style' property on WebVTT Italic Objects must be set to 'italic'.</p>
<p class="p8">The 'font-weight' property on WebVTT Bold Objects must be set to 'bold'.</p>
<p class="p8">The 'text-decoration' property on WebVTT Underline Objects must be set to 'underline'.</p>
<p class="p8">The 'display' property on WebVTT Ruby Objects must be set to 'ruby'. <span class="s6">[CSSRUBY]</span></p>
<p class="p8">The 'display' property on WebVTT Ruby Text Objects must be set to 'ruby-text'. <span class="s6">[CSSRUBY]</span></p>
<p class="p8">All other non-inherited properties must be set to their initial values; inherited properties on the root list of WebVTT Node Objects must inherit their values from the media element for which the text track cue is being rendered, if any. If there is no media element (i.e. if the text track is being rendered for another media playback mechanism), then inherited properties on the root list of WebVTT Node Objects must take their initial values.</p>
<p class="p8">If there are style sheets that apply to the media element or other playback mechanism, then they must be interpreted as defined in the next section.</p>
<p class="p25"><b>5.2.3 CSS extensions</b></p>
<p class="p8">When a user agent is rendering one or more text track cues according to the rules for updating the display of WebVTT text tracks, WebVTT Node Objects in the list of WebVTT Node Objects used in the rendering can be matched by certain pseudo-selectors as defined below. These selectors can begin or stop matching individual WebVTT Node Objects while a cue is being rendered, even in between applications of the rules for updating the display of WebVTT text tracks (which are only run when the set of active cues changes). User agents that support the pseudo-element described below must dynamically update renderings accordingly. When either 'white-space' or one of the properties corresponding to the 'font' shorthand (including 'line-height') changes value, then the text track cue's text track cue display state must be emptied and the text track's rules for updating the text track rendering must be immediately rerun.</p>
<p class="p8">Pseudo-elements apply to elements that are matched by selectors. For the purpose of this section, that element is the <i>matched element</i>. The pseudo-elements defined in the following sections affect the styling of parts of text track cues that are being rendered for the <i>matched element</i>.</p>
<p class="p20">NOTE</p>
<p class="p21">If the <i>matched element</i> is not a <span class="s5">video</span> element, the pseudo-elements defined below won't have any effect according to this specification.</p>
<p class="p8">A CSS user agent that implements the text tracks model must implement the '::cue' and '::cue(<i>selector</i>)' pseudo-elements, and the ':past' and ':future' pseudo-classes.</p>
<p class="p26"><b>5.2.3.1 The '::cue' pseudo-element</b></p>
<p class="p8">The '<b><i>::cue</i></b>' pseudo-element (with no argument) matches any list of WebVTT Node Objects constructed for the <i>matched element</i>, with the exception that the properties corresponding to the 'background' shorthand must be applied to the WebVTT cue background box rather than the list of WebVTT Node Objects.</p>
<p class="p8">The following properties apply to the '::cue' pseudo-element with no argument; other properties set on the pseudo-element must be ignored:</p>
<ul class="ul2">
  <li class="li10">'color'</li>
  <li class="li10">'opacity'</li>
  <li class="li10">'visibility'</li>
  <li class="li10">'text-decoration'</li>
  <li class="li10">'text-outline'</li>
  <li class="li10">'text-shadow'</li>
  <li class="li10">the properties corresponding to the 'background' shorthand</li>
  <li class="li10">the properties corresponding to the 'outline' shorthand</li>
  <li class="li10">the properties corresponding to the 'font' shorthand, including 'line-height'</li>
  <li class="li10">'white-space'</li>
</ul>
<p class="p8">The '<b><i>::cue(selector)</i></b>' pseudo-element with an argument must have an argument that consists of a group of selectors. It matches any WebVTT Internal Node Object constructed for the <i>matched element</i> that also matches the given group of selectors, with the nodes being treated as follows:</p>
<ul class="ul2">
  <li class="li8">The <i>document tree</i> against which the selectors are matched is the tree of WebVTT Node Objects rooted at the list of WebVTT Node Objects for the cue.</li>
  <li class="li8">WebVTT Internal Node Objects are elements in the tree.</li>
  <li class="li10">WebVTT Leaf Node Objects cannot be matched.</li>
  <li class="li8">For the purposes of element type selectors, the names of WebVTT Internal Node Objects are as given by the following table, where objects having the concrete class given in a cell in the first column have the name given by the second column of the same row:</li>
  <table cellspacing="0" cellpadding="0" class="t1">
    <tbody>
      <tr>
        <td valign="top" class="td5">
          <li class="li23"><b>Concrete class</b></li>
        </td>
        <td valign="top" class="td4">
          <li class="li23"><b>Name</b></li>
        </td>
      </tr>
      <tr>
        <td valign="top" class="td5">
          <li class="li4">WebVTT Class Objects</li>
        </td>
        <td valign="top" class="td4">
          <li class="li24">c</li>
        </td>
      </tr>
      <tr>
        <td valign="top" class="td5">
          <li class="li4">WebVTT Italic Objects</li>
        </td>
        <td valign="top" class="td4">
          <li class="li24">i</li>
        </td>
      </tr>
      <tr>
        <td valign="top" class="td5">
          <li class="li4">WebVTT Bold Objects</li>
        </td>
        <td valign="top" class="td4">
          <li class="li24">b</li>
        </td>
      </tr>
      <tr>
        <td valign="top" class="td5">
          <li class="li4">WebVTT Underline Objects</li>
        </td>
        <td valign="top" class="td4">
          <li class="li24">u</li>
        </td>
      </tr>
      <tr>
        <td valign="top" class="td5">
          <li class="li4">WebVTT Ruby Objects</li>
        </td>
        <td valign="top" class="td4">
          <li class="li24">ruby</li>
        </td>
      </tr>
      <tr>
        <td valign="top" class="td5">
          <li class="li4">WebVTT Ruby Text Objects</li>
        </td>
        <td valign="top" class="td4">
          <li class="li24">rt</li>
        </td>
      </tr>
      <tr>
        <td valign="top" class="td5">
          <li class="li4">WebVTT Voice Objects</li>
        </td>
        <td valign="top" class="td4">
          <li class="li24">v</li>
        </td>
      </tr>
      <tr>
        <td valign="top" class="td5">
          <li class="li4">WebVTT Language Objects</li>
        </td>
        <td valign="top" class="td4">
          <li class="li24">lang</li>
        </td>
      </tr>
      <tr>
        <td valign="top" class="td5">
          <li class="li4">Other elements (specifically, lists of WebVTT Node Objects)</li>
        </td>
        <td valign="top" class="td4">
          <li class="li4">No explicit name.</li>
        </td>
      </tr>
    </tbody>
  </table>
  <li class="li8">For the purposes of element type and universal selectors, WebVTT Internal Node Objects are considered as being in the namespace expressed as the empty string.</li>
  <li class="li8">For the purposes of attribute selector matching, WebVTT Internal Node Objects have no attributes, except for WebVTT Voice Objects, which have a single attribute named "<span class="s5">voice</span>" whose value is the value of the WebVTT Voice Object, and WebVTT Language Objects, which have a single attribute named "<span class="s5">lang</span>" whose value is the object's applicable language.</li>
  <li class="li8">For the purposes of class selector matching, WebVTT Internal Node Objects have the classes described as the WebVTT Node Object's applicable classes.</li>
  <li class="li8">For the purposes of the <span class="s5">:lang()</span> pseudo-class, WebVTT Internal Node Objects have the language described as the WebVTT Node Object's applicable language.</li>
  <li class="li8">For the purposes of ID selector matching, lists of WebVTT Node Objects have the ID given by the cue's text track cue identifier, if any.</li>
</ul>
<p class="p8">The following properties apply to the '::cue()' pseudo-element with an argument:</p>
<ul class="ul2">
  <li class="li10">'color'</li>
  <li class="li10">'opacity'</li>
  <li class="li10">'visibility'</li>
  <li class="li10">'text-decoration'</li>
  <li class="li10">'text-outline'</li>
  <li class="li10">'text-shadow'</li>
  <li class="li10">the properties corresponding to the 'background' shorthand</li>
  <li class="li10">the properties corresponding to the 'outline' shorthand</li>
  <li class="li10">properties relating to the transition and animation features</li>
</ul>
<p class="p8">In addition, the following properties apply to the '::cue()' pseudo-element with an argument when the selector does not contain the ':past' and ':future' pseudo-classes:</p>
<ul class="ul2">
  <li class="li10">the properties corresponding to the 'font' shorthand, including 'line-height'</li>
  <li class="li10">'white-space'</li>
</ul>
<p class="p8">Properties that do not apply must be ignored.</p>
<p class="p8">As a special exception, the properties corresponding to the 'background' shorthand, when they would have been applied to the list of WebVTT Node Objects, must instead be applied to the WebVTT cue background box.</p>
<p class="p26"><b>5.2.3.2 The ':past' and ':future' pseudo-classes</b></p>
<p class="p8">The ':past' and ':future' pseudo-classes sometimes match WebVTT Node Objects. <span class="s6">[SELECTORS]</span></p>
<p class="p8">The <b><i>':past'</i></b> pseudo-class only matches WebVTT Node Objects that are <i>in the past</i>.</p>
<p class="p8">A WebVTT Node Object <i>c</i> is <b><i>in the past</i></b> if, in a pre-order, depth-first traversal of the text track cue's list of WebVTT Node Objects, there exists a WebVTT Timestamp Object whose value is less than the current playback position of the media element that is the <i>matched element</i>, entirely after the WebVTT Node Object <i>c</i>.</p>
<p class="p8">The <b><i>':future'</i></b> pseudo-class only matches WebVTT Node Objects that are <i>in the future</i>.</p>
<p class="p8">A WebVTT Node Object <i>c</i> is <b><i>in the future</i></b> if, in a pre-order, depth-first traversal of the text track cue's list of WebVTT Node Objects, there exists a WebVTT Timestamp Object whose value is greater than the current playback position of the media element that is the <i>matched element</i>, entirely before the WebVTT Node Object <i>c</i>.</p>
<p class="p27"><span class="s14"><b>6. </b></span><b>WebVTT </b><span class="s14"><b>API</b></span></p>
<p class="p8">The following interface is used to expose WebVTT cues in the DOM API:</p>
<p class="p28">enum <b><i>AutoKeyword</i></b> { "auto" };</p>
<p class="p28">[Constructor(double startTime, double endTime, DOMString text)]</p>
<p class="p28">interface <b><i>WebVTTCue</i></b> : TextTrackCue {</p>
<p class="p28"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>attribute DOMString vertical;</p>
<p class="p28"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>attribute boolean snapToLines;</p>
<p class="p28"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>attribute (long or AutoKeyword) line;</p>
<p class="p28"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>attribute long position;</p>
<p class="p28"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>attribute long size;</p>
<p class="p28"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>attribute DOMString align;</p>
<p class="p28"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>attribute DOMString text;</p>
<p class="p28"><span class="Apple-converted-space">&nbsp; </span>DocumentFragment getCueAsHTML();</p>
<p class="p28">};</p>
<p class="p29"><b><i>cue</i> = new </b><span class="s13"><b>WebVTTCue</b></span><b>( <i>startTime</i>, <i>endTime</i>, <i>text</i> )</b></p>
<p class="p30">Returns a new <span class="s13">TextTrackCue</span> object, for use with the <span class="s5">addCue()</span> method.</p>
<p class="p30">The <i>startTime</i> argument sets the text track cue start time.</p>
<p class="p30">The <i>endTime</i> argument sets the text track cue end time.</p>
<p class="p30">The <i>text</i> argument sets the text track cue text.</p>
<p class="p29"><b><i>cue</i> . vertical [ = <i>value</i> ]</b></p>
<p class="p30">Returns a string representing the text track cue writing direction, as follows:</p>
<p class="p29"><b>If it is horizontal</b></p>
<p class="p30">The empty string.</p>
<p class="p29"><b>If it is vertical growing left</b></p>
<p class="p30">The string "<span class="s5">rl</span>".</p>
<p class="p29"><b>If it is vertical growing right</b></p>
<p class="p30">The string "<span class="s5">lr</span>".</p>
<p class="p30">Can be set.</p>
<p class="p29"><b><i>cue</i> . snapToLines [ = <i>value</i> ]</b></p>
<p class="p30">Returns true if the text track cue snap-to-lines flag is set, false otherwise.</p>
<p class="p30">Can be set.</p>
<p class="p29"><b><i>cue</i> . line [ = <i>value</i> ]</b></p>
<p class="p30">Returns the text track cue line position. In the case of the value being auto, the string "<span class="s5">auto</span>" is returned.</p>
<p class="p30">Can be set.</p>
<p class="p29"><b><i>cue</i> . position [ = <i>value</i> ]</b></p>
<p class="p30">Returns the text track cue text position.</p>
<p class="p30">Can be set.</p>
<p class="p29"><b><i>cue</i> . size [ = <i>value</i> ]</b></p>
<p class="p30">Returns the text track cue size.</p>
<p class="p30">Can be set.</p>
<p class="p29"><b><i>cue</i> . align [ = <i>value</i> ]</b></p>
<p class="p30">Returns a string representing the text track cue alignment, as follows:</p>
<p class="p29"><b>If it is start alignment</b></p>
<p class="p30">The string "<span class="s5">start</span>".</p>
<p class="p29"><b>If it is middle alignment</b></p>
<p class="p30">The string "<span class="s5">middle</span>".</p>
<p class="p29"><b>If it is end alignment</b></p>
<p class="p30">The string "<span class="s5">end</span>".</p>
<p class="p29"><b>If it is left alignment</b></p>
<p class="p30">The string "<span class="s5">left</span>".</p>
<p class="p29"><b>If it is right alignment</b></p>
<p class="p30">The string "<span class="s5">right</span>".</p>
<p class="p30">Can be set.</p>
<p class="p29"><b><i>cue</i> . text [ = <i>value</i> ]</b></p>
<p class="p30">Returns the text track cue text in raw unparsed form.</p>
<p class="p30">Can be set.</p>
<p class="p29"><b><i>fragment</i> = <i>cue</i> . getCueAsHTML()</b></p>
<p class="p30">Returns the text track cue text as a <span class="s13">DocumentFragment</span> of HTML elements and other DOM nodes.</p>
<p class="p8">The <span class="s13"><b><i>WebVTTCue(</i></b></span><span class="s5"><b><i>startTime, endTime, text)</i></b></span> constructor, when invoked, must run the following steps:</p>
<ol class="ol1">
  <li class="li8">Create a new text track cue. Let <i>cue</i> be that text track cue.</li>
  <li class="li8">Let <i>cue</i>'s text track cue start time be the value of the <i>startTime</i> argument, interpreted as a time in seconds.</li>
  <li class="li8">Let <i>cue</i>'s text track cue end time be the value of the <i>endTime</i> argument, interpreted as a time in seconds.</li>
  <li class="li8">Let <i>cue</i>'s text track cue text be the value of the <i>text</i> argument, and let the rules for rendering the cue in isolation be the rules for interpreting WebVTT cue text.</li>
  <li class="li8">Let <i>cue</i>'s text track cue identifier be the empty string.</li>
  <li class="li8">Let <i>cue</i>'s text track cue pause-on-exit flag be false.</li>
  <li class="li8">Let <i>cue</i>'s text track cue writing direction be horizontal.</li>
  <li class="li8">Let <i>cue</i>'s text track cue snap-to-lines flag be true.</li>
  <li class="li8">Let <i>cue</i>'s text track cue line position be auto.</li>
  <li class="li8">Let <i>cue</i>'s text track cue text position be 50.</li>
  <li class="li8">Let <i>cue</i>'s text track cue size be 100.</li>
  <li class="li8">Let <i>cue</i>'s text track cue alignment be middle alignment.</li>
  <li class="li8">Return the <span class="s13">TextTrackCue</span> object representing <i>cue</i>.</li>
</ol>
<p class="p8">The <span class="s5"><b><i>vertical</i></b></span> attribute, on getting, must return the string from the second cell of the row in the table below whose first cell is the text track cue writing direction of the text track cue that the <span class="s13">TextTrackCue</span> object represents:</p>
<table cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="top" class="td6">
        <p class="p23"><b>text track cue writing direction</b></p>
      </td>
      <td valign="top" class="td7">
        <p class="p31"><b>direction</b><span class="s4"><b> value</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td6">
        <p class="p4">Horizontal</p>
      </td>
      <td valign="top" class="td7">
        <p class="p4">"" (the empty string)</p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td6">
        <p class="p4">Vertical growing left</p>
      </td>
      <td valign="top" class="td7">
        <p class="p4">"<span class="s5">rl</span>"</p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td6">
        <p class="p4">Vertical growing right</p>
      </td>
      <td valign="top" class="td7">
        <p class="p4">"<span class="s5">lr</span>"</p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p8">On setting, the text track cue writing direction must be set to the value given in the first cell of the row in the table above whose second cell is a case-sensitive match for the new value, if any. If none of the values match, then the user agent must instead throw a <span class="s13">SyntaxError</span> exception.</p>
<p class="p8">The <span class="s5"><b><i>snapToLines</i></b></span> attribute, on getting, must return true if the text track cue snap-to-lines flag of the text track cue that the <span class="s13">TextTrackCue</span> object represents is set; or false otherwise. On setting, the text track cue snap-to-lines flag must be set if the new value is true, and must be unset otherwise.</p>
<p class="p8">The <span class="s5"><b><i>line</i></b></span> attribute, on getting, must return the text track cue line position of the text track cue that the <span class="s13">TextTrackCue</span> object represents. The special value auto must be represented as the string "<span class="s5">auto</span>". On setting, the text track cue line position must be set to the new value; if the new value is the string "<span class="s5">auto</span>", then it must be interpreted as the special value auto.</p>
<p class="p8">The <span class="s5"><b><i>position</i></b></span> attribute, on getting, must return the text track cue text position of the text track cue that the <span class="s13">TextTrackCue</span> object represents. On setting, if the new value is negative or greater than 100, then an <span class="s13">IndexSizeError</span> exception must be thrown. Otherwise, the text track cue text position must be set to the new value.</p>
<p class="p8">The <span class="s5"><b><i>size</i></b></span> attribute, on getting, must return the text track cue size of the text track cue that the <span class="s13">TextTrackCue</span> object represents. On setting, if the new value is negative or greater than 100, then an <span class="s13">IndexSizeError</span> exception must be thrown. Otherwise, the text track cue size must be set to the new value.</p>
<p class="p8">The <span class="s5"><b><i>align</i></b></span> attribute, on getting, must return the string from the second cell of the row in the table below whose first cell is the text track cue alignment of the text track cue that the <span class="s13">TextTrackCue</span> object represents:</p>
<table cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="top" class="td3">
        <p class="p23"><b>Text track cue alignment</b></p>
      </td>
      <td valign="top" class="td8">
        <p class="p23"><span class="s5"><b>align</b></span><b> value</b></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p4">Start alignment</p>
      </td>
      <td valign="top" class="td8">
        <p class="p24"><span class="s4">"</span>start<span class="s4">"</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p4">Middle alignment</p>
      </td>
      <td valign="top" class="td8">
        <p class="p24"><span class="s4">"</span>middle<span class="s4">"</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p4">End alignment</p>
      </td>
      <td valign="top" class="td8">
        <p class="p24"><span class="s4">"</span>end<span class="s4">"</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p4">Left alignment</p>
      </td>
      <td valign="top" class="td8">
        <p class="p24"><span class="s4">"</span>left<span class="s4">"</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p4">Right alignment</p>
      </td>
      <td valign="top" class="td8">
        <p class="p24"><span class="s4">"</span>right<span class="s4">"</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p8">On setting, the text track cue alignment must be set to the value given in the first cell of the row in the table above whose second cell is a case-sensitive match for the new value, if any. If none of the values match, then the user agent must instead throw a <span class="s13">SyntaxError</span> exception.</p>
<p class="p8">The <span class="s5"><b><i>text</i></b></span> attribute, on getting, must return the raw text track cue text of the text track cue that the <span class="s13">TextTrackCue</span> object represents. On setting, the text track cue text must be set to the new value.</p>
<p class="p8">The <span class="s5"><b><i>getCueAsHTML()</i></b></span> method must convert the text track cue text to a <span class="s13">DocumentFragment</span> for the script's document of the entry script by applying the WebVTT cue text DOM construction rules to the result of applying the WebVTT cue text parsing rules to the text track cue text.</p>
<p class="p3"><b>7. IANA considerations</b></p>
<p class="p32"><span class="s15"><b>7.1 </b></span><b><i>text/vtt</i></b></p>
<p class="p8">This registration is for community review and will be submitted to the IESG for review, approval, and registration with IANA.</p>
<p class="p4"><b>Type name:</b></p>
<p class="p4">text</p>
<p class="p4"><b>Subtype name:</b></p>
<p class="p4">vtt</p>
<p class="p4"><b>Required parameters:</b></p>
<p class="p4">No parameters</p>
<p class="p4"><b>Optional parameters:</b></p>
<p class="p4">No parameters</p>
<p class="p4"><b>Encoding considerations:</b></p>
<p class="p4">8bit (always UTF-8)</p>
<p class="p4"><b>Security considerations:</b></p>
<p class="p8">Text track files themselves pose no immediate risk unless sensitive information is included within the data. Implementations, however, are required to follow specific rules when processing text tracks, to ensure that certain origin-based restrictions are honored. Failure to correctly implement these rules can result in information leakage, cross-site scripting attacks, and the like.</p>
<p class="p4"><b>Interoperability considerations:</b></p>
<p class="p8">Rules for processing both conforming and non-conforming content are defined in this specification.</p>
<p class="p4"><b>Published specification:</b></p>
<p class="p4">This document is the relevant specification.</p>
<p class="p4"><b>Applications that use this media type:</b></p>
<p class="p4">Web browsers and other video players.</p>
<p class="p4"><b>Additional information:</b></p>
<p class="p4"><b>Magic number(s):</b></p>
<p class="p8">WebVTT files all begin with one of the following byte sequences (where "EOF" means the end of the file):</p>
<ul class="ul2">
  <li class="li10">EF BB BF 57 45 42 56 54 54 0A</li>
  <li class="li10">EF BB BF 57 45 42 56 54 54 0D</li>
  <li class="li10">EF BB BF 57 45 42 56 54 54 20</li>
  <li class="li10">EF BB BF 57 45 42 56 54 54 09</li>
  <li class="li10">EF BB BF 57 45 42 56 54 54 EOF</li>
  <li class="li10">57 45 42 56 54 54 0A</li>
  <li class="li10">57 45 42 56 54 54 0D</li>
  <li class="li10">57 45 42 56 54 54 20</li>
  <li class="li10">57 45 42 56 54 54 09</li>
  <li class="li10">57 45 42 56 54 54 EOF</li>
</ul>
<p class="p20">NOTE</p>
<p class="p21">(An optional UTF-8 BOM, the ASCII string "<span class="s5">WEBVTT</span>", and finally a space, tab, line break, or the end of the file.)</p>
<p class="p4"><b>File extension(s):</b></p>
<p class="p24"><span class="s4">"</span>vtt<span class="s4">"</span></p>
<p class="p4"><b>Macintosh file type code(s):</b></p>
<p class="p4">No specific Macintosh file type codes are recommended for this type.</p>
<p class="p4"><b>Person &amp; email address to contact for further information:</b></p>
<p class="p4">Silvia Pfeiffer &lt;<a href="mailto:silviapfeiffer1@gmail.com"><span class="s1">silviapfeiffer1@gmail.com</span></a>&gt;</p>
<p class="p4"><b>Intended usage:</b></p>
<p class="p4">Common</p>
<p class="p4"><b>Restrictions on usage:</b></p>
<p class="p4">No restrictions apply.</p>
<p class="p4"><b>Authors:</b></p>
<p class="p4">Silvia Pfeiffer &lt;<a href="mailto:silviapfeiffer1@gmail.com"><span class="s1">silviapfeiffer1@gmail.com</span></a>&gt;, Ian Hickson &lt;<a href="mailto:ian@hixie.ch"><span class="s1">ian@hixie.ch</span></a>&gt;</p>
<p class="p4"><b>Change controller:</b></p>
<p class="p4">W3C</p>
<p class="p8">Fragment identifiers have no meaning with <span class="s5">text/vtt</span> resources.</p>
<p class="p3"><b>8. References</b></p>
<p class="p8">All references are normative unless marked "Non-normative".</p>
<p class="p4"><b>[BCP47]</b></p>
<p class="p4"><span class="s1"><a href="//www.ietf.org/rfc/bcp/bcp47.txt"><i>Tags for Identifying Languages; Matching of Language Tags</i></a></span>, A. Phillips, M. Davis. IETF.</p>
<p class="p4"><b>[BIDI]</b></p>
<p class="p4"><span class="s1"><a href="//www.unicode.org/reports/tr9/"><i>UAX #9: Unicode Bidirectional Algorithm</i></a></span>, M. Davis. Unicode Consortium.</p>
<p class="p4"><b>[CSS]</b></p>
<p class="p4"><span class="s1"><a href="//www.w3.org/TR/CSS2/"><i>Cascading Style Sheets Level 2 Revision 1</i></a></span>, B. Bos, T. Çelik, I. Hickson, H. Lie. W3C.</p>
<p class="p4"><b>[CSSCOLOR]</b></p>
<p class="p4"><span class="s1"><a href="//dev.w3.org/csswg/css3-color/"><i>CSS Color Module Level 3</i></a></span>, T. Çelik, C. Lilley, L. Baron. W3C.</p>
<p class="p4"><b>[CSSRUBY]</b></p>
<p class="p4"><span class="s1"><a href="//dev.w3.org/csswg/css3-ruby/"><i>CSS3 Ruby Module</i></a></span>, R. Ishida. W3C.</p>
<p class="p4"><b>[CSSVALUES]</b></p>
<p class="p4"><span class="s1"><a href="//dev.w3.org/csswg/css3-values/"><i>CSS3 Values and Units</i></a></span>, H. Lie, T. Atkins, E. Etemad. W3C.</p>
<p class="p4"><b>[HTML]</b></p>
<p class="p4"><span class="s1"><a href="//www.whatwg.org/specs/web-apps/current-work/"><i>HTML</i></a></span>, I. Hickson. WHATWG.</p>
<p class="p4"><b>[HTML5]</b></p>
<p class="p4"><span class="s1"><a href="//www.w3.org/html/wg/drafts/html/master/single-page.html"><i>HTML 5.1</i></a></span>, R. Berjon, T. Leithead, E. Doyle Navara, E. O'Connor, S. Pfeiffer. W3C.</p>
<p class="p4"><b>[RFC3629]</b></p>
<p class="p4"><span class="s1"><a href="//tools.ietf.org/html/rfc3629"><i>UTF-8, a transformation format of ISO 10646</i></a></span>, F. Yergeau. IETF.</p>
<p class="p4"><b>[SELECTORS]</b></p>
<p class="p4"><span class="s1"><a href="//dev.w3.org/csswg/selectors4/"><i>Selectors</i></a></span>, E. Etemad, T. Çelik, D. Glazman, I. Hickson, P. Linss, J. Williams. W3C.</p>
<p class="p3"><b>9. Acknowledgements</b></p>
<p class="p8">Thanks to the SubRip community, including in particular Zuggy and ai4spam, for their work on the SubRip software program whose SRT file format was used as the basis for the WebVTT text track file format.</p>
<p class="p8">Thanks to the many contributors to the HTML standard, where WebVTT was originally specified. <span class="s6">[HTML]</span>, <span class="s6">[HTML5]</span></p>
    
    
	<iframe width="550" height="475" frameborder="0" src="
http://survey.clicktools.com/app/survey/go.jsp?iv=3poon3e7e9spn&q1=
[articleURL]" style="margin-left:25%; padding-bottom:20px;"></iframe>
<br><br>
<div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>
</html>
