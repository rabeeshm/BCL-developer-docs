<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Begin Drupal Taxonomy Data -->
    <meta name="products" content="Video Cloud, Brightcove Player">
    <meta name="role" content="Device SDK Developer">
    <meta name="task" content="Develop with the Native SDKs">
    <meta name="topic" content="Troubleshooting/Error Handling">
    <meta name="sdk" content="iOS,tvOS,Android">
    <meta name="keywords" content="device,SDK,FAQ">
    <!-- End Drupal Taxonomy Data -->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <meta name="robots" content="noindex">
  	<!-- change title to match the h1 heading -->
  	<title>Implementing Server-Side Ads with the Native Player SDKs</title>

    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
    <link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
    <link rel="stylesheet" href="/en/styles/foundation-fixes.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>

</head>

<body>
	<!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
	<!-- search -->
	<div id="searchModal" class="reveal-modal" data-reveal></div>
	<!-- content -->
	<div class="row">
		<div class="sidebar large-2 columns show-for-large-up">
			<div id="sidenav" class="side-nav"></div>
		</div>
		<div id="main" class="large-10 small-12 columns">
			<h1>Implementing Server-Side Ads with the Native Player SDKs</h1>
      <aside class="bcls-aside bcls-aside--warning">This is a temporary STAGING document for review only. For the official Brightcove documentation site, go to <a href="https://support.brightcove.com/">support.brightcove.com</a></aside>
      <p>In this topic, you will learn how to play Server-Side ads with the Brightcove Native Player SDKs, from videos ingested for Dynamic Delivery.</p>


	    <!-- BEGIN DRUPAL CONTENT -->


  <article class="bcls-article">
  <section class="bcls-section">
  <h2 id="Overview">Overview</h2>

  <p>Server-Side Ad Insertion (SSAI) allows you to embed ads into your videos so that they can't be blocked by ad blockers in the browser. Dynamic Delivery is the next generation ingest and delivery system which reduces your storage footprint and dynamically packages media. Learn more about using <a href="/node/18476">Dynamic Delivery</a> for your videos.</p>

  <p>SSAI works with both DRM and non-DRM content.</p>

  <aside class="bcls-aside bcls-aside--information">Notes:
  <ul>
  	<li>To use SSAI, your Video Cloud account needs to be configured for <a href="/node/18476">Dynamic Delivery</a> and enabled for SSAI. Contact your account manager to start using this feature.</li>
  	<li>SSAI works with Video-on-Demand (VOD) and supports Live playback.</li>
  	<li>The Native SDKs use the OUX plugin as a proxy for VOD SSAI.</li>
  	<li>For a list of limitations, see the <a href="/node/18623#Limitations">SSAI Overview</a> document.</li>
  </ul>
  </aside>

  <figure class="bcls-figure"><img class="bcls-image--no-border" alt="Server-side ad" src="//learning-services-media.brightcove.com/doc-assets/device-sdks/guides/ssai/ssai-sdk.png" />
  <figcaption class="bcls-caption--image">Server-side ad</figcaption>
  </figure>

  <p>To play server-side ads with your video content stored in Video Cloud, follow these steps:</p>

  <ol class="bcls-tasklist">
  	<li><a href="#Create_an_ad_configuration">Create an ad configuration</a></li>
  	<li>
  	<p>Build your app:</p>

  	<ul>
  		<li><a href="#Android_implementation">Android implementation</a></li>
  		<li><a href="#iOS_implementation">iOS implementation</a></li>
  		<li><a href="#tvOS_implementation">tvOS implementation</a></li>
  	</ul>
  	</li>
  	<li><a href="#Play_a_video_with_ads">Play a video with ads</a></li>
  	<!-- <li><a href="#Append_query_parameters">Append query parameters</a></li> -->
  </ol>
  </section>

  <section class="bcls-section">
  <h2 id="Create_an_ad_configuration">Create an ad configuration</h2>

  <p>The ad configuration defines various aspects of SSAI playback, including a URL to your Video Multiple Ad Playlist (VMAP) file, beacons, and other configurations. To create an ad configuration, follow these steps:</p>

  <ol class="bcls-tasklist__restart">
  	<li>
  	<p>In Video Cloud Studio, expand the <strong>ADMIN</strong> menu and select <strong>Server-Side Ad Settings</strong>.</p>

  	<figure class="bcls-figure"><img class="bcls-image--no-border" alt="Ad configuration admin" src="//learning-services-media.brightcove.com/doc-assets/player-development/plugins/ssai/ad-config-admin.png" />
  	<figcaption class="bcls-caption--image">Ad configuration admin</figcaption>
  	</figure>
  	</li>
  	<li>
  	<p>Add information for you ad configuration and select <strong>Save</strong>.</p>

  	<figure class="bcls-figure"><img class="bcls-image--no-border" alt="Ad settings" src="//learning-services-media.brightcove.com/doc-assets/player-development/plugins/ssai/ad-settings.png" />
  	<figcaption class="bcls-caption--image">Ad settings</figcaption>
  	</figure>
  	</li>
  </ol>

  <p>For details, see the <a href="/node/18748">Configuring Server-Side Ad Settings</a> document.</p>

  <p>To create an ad configuration using the SSAI API, see the <a href="/node/17942">Video Cloud SSAI Ad Config API</a> document.</p>
  </section>

  <section class="bcls-section">
  <h2 id="Android_implementation">Android implementation</h2>

  <p>Follow these steps within your app to get your ad configuration and play your video:</p>
  <aside class="bcls-aside bcls-aside--tip">The OnceUX plugin has been deprecated, and there is a new SSAI plugin that you can use. For details, see <a href="/node/18759">The SSAI Plugin for the Native SDK for Android</a></aside>

  <ol class="bcls-tasklist__restart">
  	<li>Include the Once UX plugin in your app, as shown in the <a href="https://github.com/BrightcoveOS/android-player-samples/tree/master/brightcove-exoplayer/BasicOnceUxSampleApp">Basic Once UX Player</a> sample. This will be the starting point for your app. Notice that the plugin uses a companion ad container.</li>
  	<li>In Android Studio, open your <strong>MainActivity.java</strong> file.</li>
  	<li>Comment out or delete the following code:
  	<pre class="line-numbers">
<code class="notranslate language-java">private String onceUxAdDataUrl = "http://once.unicornmedia.com/now/ads/vmap/od/auto/c501c3ee-7f1c-4020-aa6d-0b1ef0bbd4a9/202ef8bb-0d9d-4f6f-bd18-f45aa3010fe6/8a146f45-9fac-462e-a111-de60ec96198b/content.once";
      ...
      plugin.processVideo(onceUxAdDataUrl);</code></pre>
  	</li>
  	<li>Define constants for your account id, policy key, video id, and your ad configuration id.
  	<pre class="line-numbers">
<code class="notranslate language-java">private String accountId = "<span class="bcls-input">your account id</span>";
      private String policyKey = "<span class="bcls-input">your policy key</span>";
      private String videoId = "<span class="bcls-input">your video id</span>";
      private String adConfigId = "<span class="bcls-input">your ad configuration id</span>";</code></pre>

  	<aside class="bcls-aside bcls-aside--information">Learn how to get or generate a policy key in the <a href="/node/18125">Policy Keys</a> document.</aside>
  	</li>
  	<li>In the <code class="notranslate">onCreate</code> method, set the query parameter value to your ad configuration id.
  	<pre class="line-numbers">
<code class="notranslate language-java">Map&lt;String, String&gt; parameters = new HashMap&lt;&gt;();
      parameters.put("ad_config_id", adConfigId);
      </code></pre>
  	</li>
  	<li>Create an instance of the catalog service, which provides asynchronous methods for retrieving data from the Playback API.
  	<pre class="line-numbers">
<code class="notranslate language-java">Catalog catalog = new Catalog(brightcoveVideoView.getEventEmitter(), accountId, policyKey);
</code></pre>
  	</li>
  	<li>Call the catalog service to retrieve your video along with your ad configuration from the Playback API. Start video playback with your specified ads.
  	<pre class="line-numbers">
<code class="notranslate language-java">catalog.findVideoByID(videoId, null, parameters, new VideoListener() {
  @Override
  public void onVideo(Video video) {
    try {
      // The OnceUX plugin will look for a VMAP URL in the video object properties.
      // If valid, it will play the video.
      plugin.processVideo(video);
    } catch (NoSourceFoundException e) {
      // If NoSourceFoundException is thrown it means a suitable VMAP URL was not found.
      // You can try to play it on a regular view,
      brightcoveVideoView.add(video);
    }
  }
});</code></pre>
  	</li>
  </ol>

  <h3 id="Android_MainActivity_file" class="bcls-expander-head">Android MainActivity file</h3>

  <div class="bcls-expander-content">
  <p>Your <strong>MainActivity.java</strong> file should look similar to this:</p>

  <pre class="line-numbers">
<code class="notranslate language-java">package com.brightcove.player.samples.onceux.basic;

import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.view.ViewGroup;

import com.brightcove.onceux.OnceUxComponent;
import com.brightcove.onceux.event.OnceUxEventType;
import com.brightcove.player.controller.NoSourceFoundException;
import com.brightcove.player.edge.Catalog;
import com.brightcove.player.edge.VideoListener;
import com.brightcove.player.event.Event;
import com.brightcove.player.event.EventEmitter;
import com.brightcove.player.event.EventListener;
import com.brightcove.player.model.Video;
import com.brightcove.player.view.BrightcoveExoPlayerVideoView;
import com.brightcove.player.view.BrightcovePlayer;

import java.util.HashMap;
import java.util.Map;

/**
 * This app illustrates how to use the Once UX plugin to ensure that:
 *
 * - player controls are hidden during ad playback,
 *
 * - tracking beacons are fired from the client side,
 *
 * - videos are clickable during ad playback and visit the appropriate website,
 *
 * - the companion banner is shown on page switched appropriately as new ads are played
 */
public class MainActivity extends BrightcovePlayer {

    // Private class constants

    private final String TAG = this.getClass().getSimpleName();

    private String accountId = "<span class="bcls-input">your account Id</span>";
    private String policyKey = "<span class="bcls-input">your policy key</span>";
    private String videoId = "<span class="bcls-input">your video Id</span>";
    private String adConfigId = "<span class="bcls-input">your ad configuration Id</span>";

    // Private instance variables

    private OnceUxComponent plugin;
    public OnceUxComponent getOnceUxPlugin() {
        return plugin;
    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        // When extending the BrightcovePlayer, we must assign brightcoveVideoView before
        // entering the superclass.  This allows for some stock video player lifecycle
        // management.
        setContentView(R.layout.onceux_activity_main);
        brightcoveVideoView = (BrightcoveExoPlayerVideoView) findViewById(R.id.brightcove_video_view);
        brightcoveVideoView.getAnalytics().setAccount("1752604059001");
        super.onCreate(savedInstanceState);

        // Setup the event handlers for the OnceUX plugin, set the companion ad container,
        // register the VMAP data URL inside the plugin and start the video.  The plugin will
        // detect that the video has been started and pause it until the ad data is ready or an
        // error condition is detected.  On either event the plugin will continue playing the
        // video.
        registerEventHandlers();
        plugin = new OnceUxComponent(this, brightcoveVideoView);
        View view = findViewById(R.id.ad_frame);
        if (view != null &amp;&amp; view instanceof ViewGroup) {
            plugin.addCompanionContainer((ViewGroup) view);
        }

        Map&lt;String, String&gt; parameters = new HashMap&lt;&gt;();
        parameters.put("ad_config_id", adConfigId);

        Catalog catalog = new Catalog(brightcoveVideoView.getEventEmitter(), accountId, policyKey);

        catalog.findVideoByID(videoId, null, parameters, new VideoListener() {
            @Override
            public void onVideo(Video video) {
                try {
                    // The OnceUX plugin will look for a VMAP URL in the video object properties.
                    // If valid, it will play the video.
                    plugin.processVideo(video);
                } catch (NoSourceFoundException e) {
                    // If NoSourceFoundException is thrown it means a suitable VMAP URL was not found.
                    // You can try to play it on a regular view,
                    brightcoveVideoView.add(video);
                }
            }
        });
   }

    // Private instance methods

    /**
     * Procedural abstraction used to setup event handlers for the OnceUX plugin.
     */
    private void registerEventHandlers() {
        // Handle the case where the ad data URL has not been supplied to the plugin.
        EventEmitter eventEmitter = brightcoveVideoView.getEventEmitter();
        eventEmitter.on(OnceUxEventType.NO_AD_DATA_URL, new EventListener() {
            @Override
            public void processEvent(Event event) {
                // Log the event and display a warning message (later)
                Log.e(TAG, event.getType());
                // TODO: throw up a stock Android warning widget.
            }
        });
    }
}</code></pre>
  </div>
  &nbsp;

  <aside class="bcls-aside bcls-aside--tip">
  <p>Events associated with Server-side ad insertion include the following:</p>

  <ul>
  	<li><a href="https://docs.brightcove.com/android-sdk/javadoc/index.html?com/brightcove/onceux/event/package-summary.html">Lifecycle events that are specific to Once UX</a></li>
  	<li><a href="https://docs.brightcove.com/android-sdk/javadoc/com/brightcove/player/event/EventType.html">Lifecycle events associated with ads</a></li>
  </ul>
  </aside>
  </section>

  <section class="bcls-section">
  <h2 id="iOS_implementation">iOS implementation</h2>

  <p>Follow these steps within your app to get your ad configuration and play your video:</p>

  <ol class="bcls-tasklist__restart">
  	<li>In Xcode, open your <strong>ViewController.m</strong> file.</li>
    <li>
      Import the SSAI plugin for iOS.
      <pre><code class="language-swift">import BrightcoveSSAI</code></pre>
    </li>
  	<li>Define constants for your account id, policy key, video id, and your ad configuration id.
  	<pre class="line-numbers">
<code class="language-swift">
struct Constants {
  static let AccountID = &quot;<span class="bcls-input">your account id</span>&quot;
  static let PlaybackServicePolicyKey = &quot;<span class="bcls-input">your policy key</span>&quot;
  static let VideoId = &quot;<span class="bcls-input">your video id</span>&quot;
  static let AdConfigId = &quot;<span class="bcls-input">your ad configuration id</span>&quot;
}</code></pre>

  	<aside class="bcls-aside bcls-aside--information">Learn how to get or generate a policy key in the <a href="/node/18125">Policy Keys</a> document.</aside>
  	</li>
    <li>
      Define the view along with the companion view for ads.
      <pre class="line-numbers"><code class="language-swift">class ViewController: UIViewController {
    @IBOutlet weak var videoContainerView: UIView!
    @IBOutlet weak var companionSlotContainerView: UIView!</code></pre>
    </li>
  	<li>Define the <code class="notranslate">BCOVPlaybackService</code> class, which provides asynchronous methods for retrieving data from the Playback API.
      <pre class="line-numbers"><code class="language-swift">private lazy var playbackService: BCOVPlaybackService = {
    let factory = BCOVPlaybackServiceRequestFactory(accountId: Constants.AccountID, policyKey: Constants.PlaybackServicePolicyKey, baseURLStr: &quot;https://edge.api.brightcove.com/playback/v1&quot;)
    return BCOVPlaybackService(requestFactory: factory)
}()</code></pre>
  	</li>
  	<li>Set the query parameter value to your ad configuration id.
      <pre><code class="language-swift">let queryParameters = [kBCOVPlaybackServiceParamaterKeyAdConfigId: Constants.AdConfigId]</code></pre>
  	</li>
  	<li>Call the <code>playbackService</code> to retrieve your video along with your ad configuration from the Playback API. Start video playback with your specified ads.
  <pre class="line-numbers"><code class="language-swift">playbackService.findVideo(withVideoID: Constants.VideoId, parameters: queryParameters) { [weak self] (video: BCOVVideo?, jsonResponse: [AnyHashable: Any]?, error: Error?) -&gt; Void in

    guard let _video = video else {
        print(&quot;ViewController Debug - Error retrieving video: \(error?.localizedDescription ?? &quot;unknown error&quot;)&quot;)
        return
    }

    self?.playbackController?.setVideos([_video] as NSFastEnumeration)
}</code></pre>
  	</li>
  </ol>

  <p>For the complete code sample, see the following:</p>

  <ul>
  	<li><a href="https://github.com/BrightcoveOS/ios-player-samples/tree/master/SSAI/BasicSSAIPlayer">Basic SSAI Player using the Native SDK for iOS (Objective-C and Swift)</a></li>
  </ul>
  &nbsp;

  <aside class="bcls-aside bcls-aside--tip">
  <p>Events associated with Server-side ad insertion include the following:</p>

  <ul>
  	<li><a href="https://github.com/brightcove/brightcove-player-sdk-ios-ssai/blob/master/ios/dynamic/BrightcoveSSAI.framework/Headers/BCOVSSAIConstants.h">Lifecycle events that are specific to SSAI</a></li>
  	<li><a href="https://github.com/brightcove/brightcove-player-sdk-ios/blob/master/ios/dynamic/BrightcovePlayerSDK.framework/Headers/BCOVAdvertising.h">Lifecycle events associated with ads</a></li>
  </ul>
  </aside>
  </section>

  <section class="bcls-section">
  <h2 id="tvOS_implementation">tvOS implementation</h2>

  <p>The code to implement SSAI with the Native SDK for tvOS is similar to the code for iSO above.</p>

  <p>For a complete code sample, see the following:</p>

  <ul>
  	<li><a href="https://github.com/BrightcoveOS/ios-player-samples/tree/master/SSAI/BasicSSAItvOSPlayer">Basic SSAI Player using the Native SDK for tvOS (Objective-C and Swift)</a></li>
  </ul>
  &nbsp;


  <aside class="bcls-aside bcls-aside--tip">
  <p>Events associated with Server-side ad insertion include the following:</p>

  <ul>
  	<li><a href="https://github.com/brightcove/brightcove-player-sdk-ios-ssai/blob/master/ios/dynamic/BrightcoveSSAI.framework/Headers/BCOVSSAIConstants.h">Lifecycle events that are specific to SSAI</a></li>
  	<li><a href="https://github.com/brightcove/brightcove-player-sdk-ios/blob/master/ios/dynamic/BrightcovePlayerSDK.framework/Headers/BCOVAdvertising.h">Lifecycle events associated with ads</a></li>
  </ul>
  </aside>
  </section>

  <section class="bcls-section">
  <h2 id="Play_a_video_with_ads">Playing a video with ads</h2>

  <p>Any video that you retrieve from Video Cloud that has been ingested with Dynamic Delivery, will include the ads specified in the VMAP file in your ad configuration.</p>
  </section>

  <section class="bcls-section">
  <h2 id="Additional_notes">Additional notes</h2>

  <p>There are a few technical notes to be aware of when using SSAI with the Native SDKs.</p>

  <h3>Brightcove Native SDK for iOS/tvOS</h3>

  <ul>
  	<li><strong>Post-rolls:</strong> The OnceUX plugin translates the <code>timeOffset</code> value of <code>end</code> on the final ad break (post-roll) to a <code>CMTime</code> value of <code>+INFINITY</code>, for speed and efficiency. This translation is done AFTER the VMAP document is received (which occurs after the Playback API response is received) and BEFORE playback begins.</li>
  </ul>
  </section>
  </article>


  <!-- END DRUPAL CONTENT -->
  </div>
  </div>
  <!-- bcl scripts -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
  <script src="/en/scripts/docs-nav-data.min.js"></script>
  <script src="/en/scripts/bcls-doc-site-v3.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
  <script>
  $(document).foundation();
  </script>
  <!-- Any scripts specific to page samples should go here -->
  </body>

  </html>
