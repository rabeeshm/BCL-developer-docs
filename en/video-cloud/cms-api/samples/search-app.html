sna
<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <!-- change title to match the h1 heading -->
    <title>Batch update Using CMS API</title>
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

    <link rel="stylesheet" type="text/css" href="//docs.brightcove.com/en/styles/bcls-doc-site.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/atelier-forest.light.min.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

    <!-- date picker -->
    <link rel="stylesheet" type="text/css" href="//docs.brightcove.com/en/scripts/rome/rome.min.css">
    <style>
        input {
            max-width: 50%;
            /*font-size: .8rem;*/
        }
        select {
            max-width: 30%;
            font-size: .9rem;
        }
        input.date,
        select.date {
            max-width: 90%;
        }
        fieldset table {
            min-width: 100%;
        }
        fieldset {
            border: 1px #366 solid;
            border-radius: 5px;
        }
        textarea {
            width: 90%;
            height: 4rem;
            background-color: #f5f5f5;
        }
        textarea#videoData {
            width: 90%;
            background-color: #f5f5f5;
            height: 24rem;
            font-size: .9rem;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
</head>

<body>
    <!-- header navbar -->
    <div id="navWrapper" class="fixed"></div>
    <!-- breadcrumbs -->
    <nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
    <!-- search -->
    <div id="searchModal" class="reveal-modal" data-reveal></div>
    <!-- content -->
    <div class="row">
        <div class="sidebar large-2 columns show-for-large-up">
            <div id="sidenav" class="side-nav"></div>
        </div>
        <div id="main" class="large-10 small-12 columns">
            <header id="bcls_header" class="bcls-header">
                <h1>Search Videos via the CMS API</h1>
                <p>This is a sample search application using the CMS API. To get access tokens and make the API calls, it uses a proxy built by Brightcove Learning services. The proxy runs at:</p>
                <ul>
                    <li><a href="https://solutions.brightcove.com/bcls/bcls-proxy/bcls-proxy.php">https://solutions.brightcove.com/bcls/bcls-proxy/bcls-proxy.php</a></li>
                </ul>
                <p>You may also use this proxy for testing from
                    <strong>localhost</strong>, but not for production - the proxy will only accept requests from Brightcove domains or localhost. See <a href="//docs.brightcove.com/en/video-cloud/oauth-api/getting-started/quick-start.html">Oauth Quick Start</a> for a guide to building a simple proxy of your own.</p>
                <h3>Other dependencies</h3>
                <ul>
                    <li><a href="//knockoutjs.com/index.html">Knockout.js</a> (2-way data-binding)</li>
                    <li><a href="//github.com/bevacqua/rome">rome.js</a> (date picker)</li>
                </ul>
            </div>
            <div class="section" id="getCredentials">
                <h2>Get credentials</h2>
                <p>To use the CMS API you will need proper credentials. Later in this quick start, you will use the credentials in a form when submitting requests to the API.</p>
                <ol>
                    <li>To obtain proper credentials use your choice of the
                        <strong>Get Client Credentials</strong> documents listed below. Whichever option you choose, you will need to ask for the correct operation permissions. In this quick start you will need
                        <strong>video</strong> operations. The following can be used with curl or Postman to get the proper permissions:</li>
                </ol>
                <p>
                    <code data-gist-id="7661acb7095f0c8b0e34" data-gist-hide-footer="true" data-gist-line="1-3"></code>
                </p>
                <ul>
                    <li><a href="http://docs.brightcove.com/en/video-cloud/oauth-api/guides/get-client-credentials.html">OAuth: Get Client Credentials Using CURL</a>
                    </li>
                    <li><a href="http://docs.brightcove.com/en/video-cloud/oauth-api/guides/get-client-credentials-postman.html">OAuth: Get Client Credentials Using Postman</a>
                    </li>
                </ul>
            </div>
            <div class="section" id="accountInputs">
                <h2>Account Inputs</h2>
                <fieldset class="bcls-fieldset">
                    <legend>Inputs</legend>
                    <p>
                        Account ID:
                        <input id="account_id" type="text" value="" data-bind="value: account_id">
                    </p>
                    <p>
                        Client ID:
                        <input id="client_id" type="text" value="" data-bind="value: client_id">
                    </p>
                    <p>
                        Client Secret:
                        <input id="client_secret" type="text" value="" data-bind="value: client_secret">
                    </p>
                    <p>
                        Proxy URL:
                        <input id="proxyURL" type="text" data-bind="value: proxyURL">
                    </p>

                </fieldset>
            </div>
            <div class="section" id="searchInputs">
                <h2>Search Inputs</h2>
                <fieldset id="searchInputs" data-bind="enable: haveAccountInputs">
                    <legend>Search Inputs</legend>
                    <p>
                        <input type="checkbox" id="exactMatch" data-bind="checked: exactMatch"> Require exact match on search terms</p>
                    <p>
                        <input type="checkbox" id="requiredTerms" data-bind="checked: requiredTerms"> Only return videos that have <strong>all</strong> the search terms</p>
                    <p>
                        <input type="checkbox" id="excludeTerms" data-bind="checked: excludeTerms"> Only return videos that do
                        <strong>not</strong> have the search terms</p>
                    <p>
                        <input type="checkbox" id="searchComplete" data-bind="checked: searchComplete">
                        <strong>Only</strong> return videos that have been completely processed</p>
                    <p>Limit search to this field:
                        <select id="searchField" data-bind="disable: haveCustomField(), options: searchField, value: selectedSearchField, optionsCaption: 'Any'"></select>
                    </p>
                    <p>Limit search to this custom field:
                        <input type="text" id="customField" data-bind="value: customField, disable: haveSearchField">
                    </p>
                    <div data-bind="visible: !haveSearchState() && !havePlayable()">
                        Search terms:
                        <input id="searchTerms" type="text" data-bind="value: searchTerms">
                    </div>
                    <div data-bind="visible: haveSearchState">
                        State:
                        <select id="searchStates" data-bind="options: searchState, value: selectedSearchState"></select>
                    </div>
                    <div data-bind="visible: havePlayable">
                        State:
                        <select id="searchStates" data-bind="options: searchPlayable, value: selectedSearchState"></select>
                    </div>
                    <table class="bcls-table">
                        <caption>Limit search by dates:</caption>
                        <tr>
                            <td>Date type</td>
                            <td>From date</td>
                            <td>To date</td>
                        </tr>
                        <tr>
                            <td>
                                <select class="date" id="dateRangeType" data-bind="options: dateRangeType, value: selectedDateRangeType, optionsCaption: 'Do not limit by date'"></select>
                            </td>
                            <td>
                                <input id="fromDate" class="date" data-bind="enable: haveDateType">
                            </td>
                            <td>
                                <input id="toDate" class="date" data-bind="enable: haveDateType">
                            </td>
                        </tr>
                    </table>
                    <p>Items found:
                        <span data-bind="text: itemCount"></span>
                        <br /> Offset (number of items to skip):
                        <select id="offset" data-bind="options: offsets, value: selectedOffset"></select>
                    </p>
                    <p>
                        Number of items to return:
                        <select id="limit" data-bind="options: limit, value: selectedLimit"></select>
                    </p>
                    <p>
                        Sort results by:
                        <select id="sort" data-bind="options: sortOptions, value: selectedSortOption"></select>
                    </p>
                    <p>
                        <button class="bcls-button" id="submitRequest" data-bind="click: setupURL, enable: haveSearchTermsOrDateRange">Submit Request</button>
                    </p>
                </fieldset>
            </div>


            <div class="section" id="outputLog">
                <h2>Results</h2>
                <fieldset class="bcls-fieldset">
                    <legend>Outputs</legend>
                    <p>Note that if you request multiple result sets using the offset, new items will be appended to the existing ones.</p>
                    <p>
                        API request:
                        <textarea id="apiURL"></textarea>
                    </p>
                    <pre>
                        <code id="response"></code>
                    </pre>
                </fieldset>
            </div>
            <div class="section" id="sampleCode">
                <h2>Code for the sample</h2>
                <h3>HTML code:</h3>
                <p>
                    <script src="https://gist.github.com/134bc2a5d4b38d7731e4.js"></script>
                </p>
                <h3>JavaScript code:</h3>
                <p>
                    <script src="https://gist.github.com/3da31598634c2701f770.js"></script>
                </p>
            </div>
        </div>
    </div>
    <!-- bcl scripts -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/2.2/gist-embed.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.3/handlebars.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
    <!-- knockout -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/knockout/3.2.0/knockout-debug.js"></script>
    <!-- date picker -->
    <script src="//docs.brightcove.com/en/scripts/rome/rome.min.js"></script>
    <script src="//docs.brightcove.com/en/scripts/docs-nav-data.min.js"></script>
    <script src="//docs.brightcove.com/en/scripts/bcls-doc-site-v1.js"></script>

    <script>
        $(document).foundation();
    </script>
    <script id="pageScript">
        // knockout view model
        function cmsSearchModel() {
                var self = this,
                    APIresponse = document.getElementById("response");
                // non-editable data
                // date pickers
                rome(fromDate);
                rome(toDate);
                self.apiURL = document.getElementById("apiURL");
                self.searchField = ["name", "text", "tags", "reference_id", "custom_fields", "state", "playable"];
                self.searchState = ["ACTIVE", "INACTIVE", "PENDING"];
                self.searchPlayable = ["true", "false"];
                self.limit = [10, 25, 50, 100];
                self.dateRangeType = ["updated_at", "created_at", "published_at", "schedule.starts_at", "schedule.ends_at"];
                self.sortOptions = ["name", "reference_id", "created_at", "published_at", "updated_at", "schedule_starts_at", "schedule_ends_at", "state", "plays_total", "plays_trailing_week"]
                self.proxyURL = ko.observable("https://solutions.brightcove.com/bcls/bcls-proxy/bcls-proxy.php");

                // editable data
                self.client_id = ko.observable("");
                self.client_secret = ko.observable("");
                self.account_id = ko.observable("");
                self.exactMatch = ko.observable(false);
                self.requiredTerms = ko.observable(false);
                self.excludeTerms = ko.observable(false);
                self.selectedSearchState = ko.observable();
                self.selectedSearchField = ko.observable();
                self.selectedDateRangeType = ko.observable();
                self.searchComplete = ko.observable(true);
                self.customField = ko.observable("");
                self.searchTerms = ko.observable("");
                self.selectedLimit = ko.observable(10);
                self.itemCount = ko.observable("");
                self.offsets = ko.observableArray([0]);
                self.selectedOffset = ko.observable();
                self.selectedSortOption = ko.observable();
                // computed data
                self.haveAccountInputs = ko.computed(function() {
                    if (self.account_id() === "" || self.client_id() === "" || self.client_secret() === "") {
                        return false;
                    } else {
                        return true;
                    }
                });
                self.haveSearchState = ko.computed(function() {
                    if (self.selectedSearchField() === "state") {
                        return true;
                    } else {
                        return false;
                    }
                });
                self.havePlayable = ko.computed(function() {
                    if (self.selectedSearchField() === "playable") {
                        return true;
                    } else {
                        return false;
                    }
                });
                self.haveItemCount = ko.computed(function() {
                    if (self.itemCount() === "") {
                        return false;
                    } else {
                        return true;
                    }
                });
                self.haveSearchField = ko.computed(function() {
                    if (self.selectedSearchField() === undefined) {
                        return false;
                    } else {
                        return true;
                    }
                });
                self.haveCustomField = ko.computed(function() {
                    if (self.customField() === "") {
                        return false;
                    } else {
                        return true;
                    }
                });
                self.haveDateType = ko.computed(function() {
                    if (self.selectedDateRangeType() === undefined) {
                        return false;
                    } else {
                        return true;
                    }
                });
                self.haveSearchTerms = ko.computed(function() {
                    if (self.searchTerms() === "") {
                        return false;
                    } else {
                        return true;
                    }
                });
                self.haveSearchTermsOrDateRange = ko.computed(function() {
                    if (self.haveSearchTerms() || self.haveDateType() || self.haveSearchState() || self.havePlayable()) {
                        return true;
                    } else {
                        return false;
                    }
                });

                // operations
                // function to write the request to the page
                self.logResponse = function(data) {
                    response.innerHTML += data + ",<br />"
                };
                // function to set up the request
                self.setupURL = (function() {
                    var str = "https://cms.api.brightcove.com/v1/accounts/" + self.account_id() + "/counts/videos?q=",
                        fromDateValue = rome(fromDate).getDate(),
                        toDateValue = rome(toDate).getDate();
                    if (self.haveSearchField()) {
                        if (self.haveSearchState()) {
                            str += self.selectedSearchField() + ":" + self.selectedSearchState();
                        } else if (self.haveSearchTerms()) {
                            var termsArray = self.searchTerms().split(" "),
                                i, iMax, item;
                            imax = termsArray.length;
                            if (self.exactMatch()) {
                                for (i = 0; i < iMax; i++) {
                                    termsArray[i] = '\"' + termsArray[i] + '\"';
                                }
                            }
                            for (i = 0; i < iMax; i++) {
                                item = termsArray[i];
                                item = self.selectedSeachField() + ":" + item;
                                if (self.excludeTerms()) {
                                    item = "%2D" + item;
                                } else if (self.requiredTerms()) {
                                    item = "%2B" + item;
                                }
                            }
                            str += termsArray.join("+");
                        }
                    } else if (self.haveCustomField()) {
                        if (self.haveSearchTerms()) {
                            var termsArray = self.searchTerms().split(" "),
                                i, iMax, item;
                            iMax = termsArray.length;
                            if (self.exactMatch()) {
                                for (i = 0; i < iMax; i++) {
                                    termsArray[i] = '\"' + termsArray[i] + '\"';
                                }
                            }
                            for (i = 0; i < iMax; i++) {
                                termsArray[i] = self.customField() + ":" + termsArray[i];
                                if (self.excludeTerms()) {
                                    item = "%2D" + item;
                                } else if (self.requiredTerms()) {
                                    item = "%2B" + item;
                                }
                            }
                            str += termsArray.join("+");
                        }
                    } else if (self.haveSearchTerms()) {
                        // don't have field type
                        if (self.exactMatch()) {
                            if (self.excludeTerms()) {
                                str += '%2D"' + self.searchTerms() + '"';
                            } else if (self.requiredTerms()) {
                                str += '%2B"' + self.searchTerms() + '"';
                            } else {
                                str += '"' + self.searchTerms() + '"';
                            }
                        } else if (self.excludeTerms()) {
                            for (i = 0; i < iMax; i++) {
                                termsArray[i] = '%2D' + termsArray[i];
                                str += termsArray.join(" ");
                            }
                        } else if (self.requiredTerms()) {
                            for (i = 0; i < iMax; i++) {
                                termsArray[i] = '%2B' + termsArray[i];
                                str += termsArray.join(" ");
                            }
                        } else {
                            str += self.searchTerms();
                        }
                    }
                    if (self.haveDateType()) {
                        // add a plus if there are also search terms
                        if (self.haveSearchTerms) {
                            str += "+";
                        }
                        if (fromDateValue !== null) {
                            str += self.selectedDateRangeType() + ":";
                            str += fromDateValue.toISOString();
                        }
                        str += "..";
                        if (toDateValue !== null) {
                            str += toDateValue.toISOString();
                        }
                    }
                    str += "&limit=" + self.selectedLimit();
                    str += "&offset=" + self.selectedOffset();
                    str += "&sort=" + self.selectedSortOption();
                    url = str;
                    self.apiURL.value = url;
                    self.submitRequest("counts", function(count) {
                        var totalSets = Math.ceil(count / self.selectedLimit()),
                            i;
                        self.itemCount(count);
                        for (i = 1; i < totalSets; i++) {
                            self.offsets.push(i * self.selectedLimit());
                        }
                        url = url.replace("/counts/videos", "/videos");
                        self.apiURL.value = url;
                        self.submitRequest("items", function(response) {
                            self.logResponse(response);
                        });
                    });
                });
                self.submitRequest = function(type, callback) {
                    var httpRequest = new XMLHttpRequest(),
                        requestData,
                        // handler for response from the proxy
                        getResponse = function() {
                            try {
                                if (httpRequest.readyState === 4) {
                                    if (httpRequest.status === 200) {
                                        switch (type) {
                                            case "counts":
                                                var count = JSON.parse(httpRequest.responseText).count;
                                                callback(count);
                                                break;
                                            case "items":
                                                callback(httpRequest.responseText);
                                                break;
                                            default:
                                                self.logResponse("Unexpected response: " + httpRequest.responseText);
                                                break;
                                        }
                                    } else {
                                        alert("There was a problem with the request. Request returned " + httpRequest.status);
                                    }
                                }
                            } catch (e) {
                                alert('Caught Exception: ' + e);
                            }
                        };
                    // check for required account info
                    if (!self.haveAccountInputs) {
                        alert("You must provide an account id, client id, and client secret");
                        return;
                    }
                    // set up request data
                    requestData = "client_id=" + self.client_id() + "&client_secret=" + self.client_secret() + "&url=" + encodeURIComponent(self.apiURL.value) + "&requestType=GET";
                    // set response handler
                    httpRequest.onreadystatechange = getResponse;
                    // open the request
                    httpRequest.open("POST", self.proxyURL());
                    // set headers
                    httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    // open and send request
                    httpRequest.send(requestData);
                }
            }
            // apply knockout bindings
        ko.applyBindings(new cmsSearchModel());
    </script>
<iframe id="CSAT" src="//learning-services-media.brightcove.com/doc-assets/general/surveylink.html" style="margin-left:40%; padding-bottom:20px;width:300px;border:none"></iframe>

<br><br>
<div class="bcls-footer"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>

</html>
