<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <!-- change title to match the h1 heading -->
    <title id="bclPageTitle">Get Started with the Smart Player API</title>
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

    <link rel="stylesheet" type="text/css" href="/en/styles/bcls-doc-site.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2728311-29', 'auto');
  ga('send', 'pageview');

</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
  </head>

  <body>
  <!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
  <!-- search -->
  <div id="searchModal" class="reveal-modal" data-reveal></div>
  <!-- content -->
    <div class="row">
        <div class="sidebar large-2 columns show-for-large-up">
            <div id="sidenav" class="side-nav"></div>
        </div>
        <div id="main" class="large-10 small-12 columns">
        <div id="top" class="section">
            <h1 id="bclPageHeading">Get Started with the Smart Player API</h1>
          <p class="BCL-objective">This topic walks you through the required steps to prepare your players for using the Smart Player API. The Smart Player API allows you to create custom dynamic solutions in JavaScript that work with both Flash and HTML players.</p>
          <!--break-->
          <h3>What you will need</h3>
          <p>This document assumes you understand how to work with JavaScript in general. The <a href="/en/video-cloud/smart-player-api/references/index.html">Smart Player API Reference</a> describes the available methods and events for each player component and provides examples for use. To create and test your sample solutions by stepping through the processes of preparing your player for Smart Player API coding, you need the following:</p>
          <ul>
              <li>The <a href="/en/video-cloud/smart-player-api/references/index.html">Smart Player API Reference</a></li>
              <li>A text/code editor</li>
              <li>A browser</li>
              <li>A <a href="//www.brightcove.com/en/online-video-platform">Video Cloud</a> account</li>
              <li>Sample videos</li>
          </ul>
        </div>
        <div id="enable-player" class="section">
          <h2><a name="enable-player"></a>Enable the player</h2>
          <p>To enable the Video Cloud player to communicate with the HTML page hosting the JavaScript, do the following:</p>
          <ol>
              <li>Open the Video&nbsp;Cloud Studio Publishing module and select a player</li>
              <li>Click <strong>Settings</strong></li>
              <li>On the <strong>Global </strong>tab of the player settings editor, under <strong>Web Settings</strong>, select <strong>Enable ActionScript/JavaScript APIs </strong>to enable the player for JavaScripting<br />
                <div><img src="//img.brightcove.com/spapidocs-enable-player.png" width="322" height="86" /></div></li>
              <li>Click the <strong>Save Changes</strong> button.</li>
          </ol>
          <div class="text-warning">
            <h4>Note</h4>
            <p>You must explicitly check this setting for every player you intend to code using the Smart Player API.</p>
          </div>
        </div>
        <div class="section" id="get-code">
          <h2><a name="get-code"></a>Get the player code</h2>
          <p>Next, get the JavaScript publishing code for the player. This is done in different ways, depending on whether you are <a href="//support.brightcove.com/en/video-cloud/docs/publishing-brightcove-player#getcode">publishing a playlist player</a> or <a href="//support.brightcove.com/en/video-cloud/docs/quick-video-publishing">publishing a single video player</a>. In either case, be sure you use the <strong>JavaScript</strong> code (called the <strong>Website</strong> code in the Quick Publish tool for single video players.</p>
          <p>The code you paste into your HTML will look like this (some comments have been removed here):</p>
<pre><code>
  &lt;!-- Start of Brightcove Player --&gt;
  &lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot; src=&quot;http://admin.brightcove.com/js/BrightcoveExperiences.js&quot;&gt;&lt;/script&gt;
  &lt;object id=&quot;myExperience921449663001&quot; class=&quot;BrightcoveExperience&quot;&gt;
    &lt;param name=&quot;bgcolor&quot; value=&quot;#FFFFFF&quot; /&gt;
    &lt;param name=&quot;width&quot; value=&quot;480&quot; /&gt;
    &lt;param name=&quot;height&quot; value=&quot;270&quot; /&gt;
    &lt;param name=&quot;playerID&quot; value=&quot;2079935931001&quot; /&gt;
    &lt;param name=&quot;playerKey&quot; value=&quot;AQ~~,AAAA1oy1bvE~,ALl2ezBj3WE0z3yX6Xw29sdCvkH5GCJv&quot; /&gt;
    &lt;param name=&quot;isVid&quot; value=&quot;true&quot; /&gt;
    &lt;param name=&quot;isUI&quot; value=&quot;true&quot; /&gt;
    &lt;param name=&quot;dynamicStreaming&quot; value=&quot;true&quot; /&gt;
    &lt;param name=&quot;@videoPlayer&quot; value=&quot;921449663001&quot; /&gt;
  &lt;/object&gt;
  &lt;script type=&quot;text/javascript&quot;&gt;brightcove.createExperiences();&lt;/script&gt;
  &lt;!-- End of Brightcove Player --&gt;
</code></pre>
        </div>
        <div class="section" id="add-params">
          <h2><a name="add-params"></a>Params for the API</h2>
          <p>You need to modify the player <code>object</code> code by adding these additional <code>param</code> tags:</p>
<pre><code>
  &lt;!-- smart player api params --&gt;
  &lt;param name=&quot;includeAPI&quot; value=&quot;true&quot; /&gt;
  &lt;param name=&quot;templateLoadHandler&quot; value=&quot;BCLS.onTemplateLoad&quot; /&gt;
  &lt;param name=&quot;templateReadyHandler&quot; value=&quot;BCLS.onTemplateReady&quot; /&gt;
</code></pre>
          <p>The first param includes the API library (note that you do not need a <code>&lt;script&gt;</code> tag for it). The next two params provide and entry point to the API by specifying the handler functions for the initial events that are broadcast when the player is loaded and set up.</p>
          <p>The values for the <code>templateLoadHandler</code> and <code>templateReadyHandler</code> params are the names of functions that you will define in your JavaScript code, as explained in the next section.</p>
          <p class="text-warning">Note: you may see sample code that only specifies the <code>templateLoadHandler</code>, and then adds an event listener for templateReady event in the templateLoad handler. That technique <strong>will fail</strong> in many cases, because the templateReady event will have already fired by the time the listener is added. Always specify the <code>templateReadyHandler</code> in the player publishing code, as shown above.</p>
        </div>
        <div class="section" id="initialEvents">
          <h2><a name="initialEvents"></a>Initial events</h2>
          <p>Now you are ready to start scripting. The first thing you will want need to do is create the handlers for the templateLoad and templateReady events that you specified in the player publishing code.</p>
          <div class="text-warning">
          <p>Important: understand the difference between the <strong>template loaded</strong> and <strong>template ready</strong> events:</p>
          <ul>
              <li><code>templateLoad</code>: all the data for player and API have been received by the browser, and you can now get references to the overall player (the BrightcoveExperience) &mdash; the player has not been fully set up, though, and if you try to invoke any methods on it at this point, you are setting up a racing condition</li>
              <li><code>templateReady</code>: the player has now been fully instantiated and is ready to interact with via the API &mdash; you should only call methods of the API modules <strong>after</strong> the template ready event has fired</li>
          </ul>
          <p>To avoid calling methods too early, you can skip the <code>templateLoad</code> event and just handle the <code>templateReady</code> event. The player ID will have to be retrieved in a slightly different manner though. Rather than using the parameter passed to the function directly (experienceID below), you must access it via the event object passed to the <code>templateReady</code> handler. The player id is located in the <code>target</code> object in the event object and used in the <code>templateLoaded</code> handler as follows:</p>
          <pre><code>var onTemplateReady = function(evt){
  player = brightcove.api.getExperience(evt.target.experience.id);
}</code></pre>.
          <p>Of course, you could use the less elegant solution of copying the player ID from the publishing code and paste it into your <code>getExperience()</code> method.</p>
          </div>
          <div class="alert text-info">
            <p>Note: in this and many of our samples, we are using the <em>Module pattern</em>, explained in Stoyan Stefanov's <a href="//oreilly.com/catalog/9780596806750"><em>JavaScript Patterns</em></a> and in many places on the Web, to organize our code. This is not required &mdash; you can structure your JavaScript code in any way that you like. The module pattern is useful in several ways, however:</p>
            <ul>
              <li>Code that is structured in a regular way is easier to maintain and reuse</li>
              <li>The pattern limits the variables you create in the Global namespace to one, reducing the chances of variable name collisions with other JavaScript libraries and utilities that may be included</li>
              <li>The pattern makes it easy to expose functions and data to page when you need to, while hiding private functions and data</li>
            </ul>
            <p>Briefly, the Module pattern works by wrapping all your code into a single global object (here we are using BCLS for Brightcove Learning Service). This object is set equal to a self-executing function. In JavaScript, you can make a function self-executing simply by wrapping it in parentheses. Inside the function, you have access to all global variables, and you just code as you normally would, with this exception: any function or data that needs to be available outside of your code is made a property of a <code>return</code> object, like this:</p>
<pre><code>
 return {
   /**** template loaded event handler ****/
   onTemplateLoad : function (experienceID) {
     player = brightcove.api.getExperience(experienceID);
     APIModules = brightcove.api.modules.APIModules;
   }
}
</code></pre>
            <p>Any data or function returned is available as a property of the global object, for example: <code>BCLS.onTemplateLoad</code>.</p>
            <p>It is also a convention of the Module pattern that you initialize <em>all</em> variables at the top of the code, so that you always know where they are.</p>
          </div>
        </div>
        <div class="section" id="templateLoad">
          <h2><a name="templateLoad"></a>templateLoad event</h2>
          <p>In the <code>templateLoad</code> handler, we recommend that you do <em>nothing</em> except get a reference to the overall player (<code>brightcove.api.BrightcoveExperience</code>) and other classes in the API. For example, you might want to get references to the <code>APIModules</code> class and some of the event classes, to simplify the rest of your coding:</p>
<pre><code>
/**** Brightcove Learning Services Module ****/
var BCLS = (function() {
  // variable
  var eProgress = document.getElementById("progress"),
      player,
      APIModules,
      adEvent,
      captionsEvent,
      contentEvent,
      cuePointEvent,
      mediaEvent,
      videoPlayer,
      eProgressBar = document.getElementById("progressBar"),
      eVideoName = document.getElementById("videoName");
  // public functions and data
  return {
    /**** template loaded event handler ****/
    onTemplateLoad : function (experienceID) {
      // get a reference to the player and API Modules and Events
      player = brightcove.api.getExperience(experienceID);
      APIModules = brightcove.api.modules.APIModules;
      adEvent = brightcove.api.events.AdEvent;
      captionsEvent = brightcove.api.events.CaptionsEvent;
      contentEvent = brightcove.api.events.ContentEvent;
      cuePointEvent = brightcove.api.events.CuePointEvent;
      mediaEvent = brightcove.api.events.MediaEvent;
    }
  }
</code></pre>
          <p>Note: the player ID is passed to handler automatically, and in turn you pass with the <code>getExperience()</code> call to get a reference to the player.</p>
          <div class="text-warning">
            <p>It is a good idea to log some kind message to the console at the beginning of event handlers to make sure you are getting there. Logging something on template load is especially useful, because if the message is not there, you probably forgot to enable the player APIs in the player settings.</p>
            <p>You can use a simple <code>console.log("template loaded");</code> to do this, but we prefer to use a logging function that wraps <code>console.log</code> like this:</p>
<pre><code>
  /*************************
  logging
  *************************/
  bclslog = function (message) {
      if (window["console"] && console["log"]) {
        var d = new Date();
        console.log(d + ": ");
        console.log(message);
      };
  };
</code></pre>
            <p>So with this function included, you logging statements look like <code>BCLSmain.bclslog("template loaded");</code>. The reason to do this is that some late versions of IE support <code>console.log</code> only when Developer Tools are turned on in the browser &mdash; otherwise the function is not found, and your code is broken. So this is a good safeguard in case you forget to remove the logging statements for production (or prefer to leave them in).</p>
          </div>
          <div class="section" id="templateReady">
            <h2><a name="templateReady"></a>templateReady event</h2>
            <p>Once the <code>templateReady</code> event fires, you can invoke any API method. The first thing you will probably want to do is get references to one or more of the API modules, using the <code>getModule()</code> method of the <code>brightcove.api.BrightcoveExperience</code> class. The general syntax for doing this (assuming the reference to <code>brightcove.api.BrightcoveExperience</code> that we got in the <code>templateLoad</code> handler) is:</p>
<pre><code>
  variableName = player.getModule(brightcove.api.modules.APIModules.MODULE_NAME);
</code></pre>
            <p>That is a lot of typing, which is why we created the shorter reference to the APIModules: <code>APIModules = brightcove.api.modules.APIModules;</code>. The public constant names for the modules are:</p>
            <ul>
              <li>ADVERTISING</li>
              <li>EXPERIENCE</li>
              <li>CAPTIONS</li>
              <li>CONTENT</li>
              <li>CUE_POINTS</li>
              <li>VIDEO_PLAYER</li>
            </ul>
            <p>So, using the reference noted above, you can get a reference to <code>VIDEO_PLAYER</code> module like this:</p>
<pre><code>
  /**** template ready event handler ****/
  onTemplateReady = function (evt) {
    videoPlayer = player.getModule(APIModules.VIDEO_PLAYER);
  }
</code></pre>
            <p>Note: in the Module pattern, this function must also be included in the <code>return</code> object, so that the player has access to it as <code>BCLS.onTemplateReady</code>.</p>
          </div>
          <div class="section" id="methods">
            <h2><a name="methods"></a>Invoking methods</h2>
            <p>Once you have a reference to a module, you can invoke its methods using the syntax <code>moduleName.method()</code>.</p>
            <div class="text-warning">
              <p><strong>Important:</strong> all Smart Player API methods are <em>asynchronous</em> (unless you are creating a <a href="//support.brightcove.com/en/video-cloud/docs/adding-functionality-smart-players-using-plug-ins">player plugin</a>). This means that:</p>
              <ol>
                <li>You cannot assume that a method has executed just because you called &mdash; watch out for racing conditions!</li>
                <li>If the method returns data, you must provide a callback function to receive and process the data</li>
              </ol>
            </div>
            <p>With any method that returns data, you must provide a callback. You can do this either by passing an anonymous function in the method call, or by passing the name of the callback function. The following examples do the same thing:</p>
<pre><code>
  // passing an anonymous function as the callback
  videoPlayer.getCurrentVideo( function(videoDTO) {
    document.getElementById("videoName").innerHTML = "Currently watching: &lt;strong&gt;" + videoDTO.displayName + "&lt;strong&gt;";
  } );

  // passing the name of the callback function that is returned as a property of BCLS
  videoPlayer.getCurrentVideo( BCLS.onGetVideo );
  // callback
  onGetVideo = function (videoDTO) {
    document.getElementById("videoName").innerHTML = "Currently watching: &lt;strong&gt;" + videoDTO.displayName + "&lt;strong&gt;";
  };
</code></pre>
            <p>The choice is a matter of preference. We tend to use anonymous callbacks if they are simple and short, named callbacks if they are long and complex.</p>
            <p>In the example below, we call the <code>getCurrentVideo()</code> method of the <code>VIDEO_PLAYER</code> module to retrieve the video DTO (Date Transfer Object) for the video currently loaded in the player. In the callback, we write the videoName into an HTML element with the id <code>videoName</code>:</p>
<pre><code>
/**** template ready event handler ****/
onTemplateReady : function (evt) {
  // get references to modules
  videoPlayer = player.getModule(APIModules.VIDEO_PLAYER);
  // get the video data for the current video
  videoPlayer.getCurrentVideo( function(videoDTO) {
    eVideoName.innerHTML = "Currently watching: &lt;strong&gt;" + videoDTO.displayName + "&lt;/strong&gt;";
  }
}
</code></pre>
            <div class="text-warning">
              <p>Here is a simple example of how you get into race conditions. If I rewrite the code above like this there is a very good chance that <strong>it will fail</strong>:</p>
<pre><code>
  /**** template ready event handler ****/
  onTemplateReady = function (evt) {
    videoPlayer = player.getModule(APIModules.VIDEO_PLAYER);
    videoPlayer.getCurrentVideo( function(videoDTO) {
      videoDTO = videoDTO;
    } );
    document.getElementById("videoName").innerHTML = "Currently watching: &lt;strong&gt;" + videoDTO.displayName + "&lt;/strong&gt;";
  };
</code></pre>
              <p>Just remember this rule: if an action must occur after an asynchronous call has completed, then you need to perform or call that action within the callback.</p>
            </div>
          </div>
          <div class="section" id="eventListeners">
            <h2><a name="eventListeners"></a>Event Listeners</h2>
            <p>We have already handled the <code>templateLoaded</code> and <code>templateReady</code> events, and saw that once the latter event has fired, you can do anything you want to with the API. However, in many cases you will want to listen for other events &mdash; media events, cue point events, ad events, etc. &mdash; to perform actions when they occur.</p>
            <h3>Adding event listeners</h3>
            <p>The general syntax for setting up an event listener is:</p>
<pre><code>
  module.addEventListener(eventName, handlerFunctionName);
</code></pre>
            <p>For example:</p>
<pre><code>
  videoPlayer.addEventListener(brightcove.api.events.MediaEvent.COMPLETE, onMediaComplete);

  or, using the reference to the Media event class above:

  videoPlayer.addEventListener(mediaEvent.COMPLETE, onMediaComplete);
</code></pre>
            <div class="text-warning">
              <p>Note: if you fail to provide the handler function for event (or mistype the name), JavaScript processing will stop without an error or warning.</p>
              <p>If your code is failing without errors, and you are getting to the <code>templateLoad</code> handler, one of the first things to look for is a typo in an <code>addEventListener</code> statement or a missing event handler.</p>
            </div>
              <p>Here's an example of setting a listener for the media PROGRESS event (using the reference to the <code>mediaEvent</code> class from the <code>templateLoad</code> handler. In the handler for progress events, we'll create a very simple display of the amount of the video that has played by adding a non-breaking space to a <code>span</code> tag (with a background color) each time the event fires:</p>
<pre><code>
<!-- in the html -->
&lt;div id="progress"&gt;&lt;span id="progressBar"&gt;&lt;/span&gt;&lt;/div&gt;

// in the JavaScript
onTemplateLoad : function (experienceID) {
  // get a reference to the player and API Modules and Events
  player = brightcove.api.getExperience(experienceID);
  APIModules = brightcove.api.modules.APIModules;
  mediaEvent = brightcove.api.events.MediaEvent;
  videoPlayer = player.getModule(APIModules.VIDEO_PLAYER);
  videoPlayer.addEventListener(mediaEvent.PROGRESS, onProgress);
}

/**** media progree event handler ****/
return {
  onProgress : function (evt) {
    eProgressBar.innerHTML += "&nbsp;";
  }
}
</code></pre>
              <p>Note: in the Module pattern, this function must also be included in the <code>return</code> object, so that the player has access to it as <code>BCLS.onProgress</code></p>
              <div class="text-info">
                <p>Note: after the <code>addEventListener</code> call, we save a reference to the span tag (the &quot;progressBar&quot;) to avoid repeating DOM calls for every progress event.</p>
              </div>
              <p>There are objects associated with the different events that get passed automatically to the handler function (in the code above, the <code>evt</code> parameter. We will see below how you can use the object data, but generally it is a good idea to log the event object to the console when you first set up the listener to examine its properties.</p>
              <h3>Removing event listeners</h3>
              <p>You can remove event listeners after you have added them. In some cases, removing an event listener that you no longer need is just good memory management. In other cases, removing the listener at the right time may be functionally necessary. The <code>removeEventListener</code> method takes the same arguments as <code>addEventListener</code>:</p>
<pre><code>
  module.removeEventListener(eventName, handlerFunctionName);
</code></pre>
              <p>In the modified version of the progress event handler below, we use the <code>position</code> and <code>duration</code> properties of the event object to check to see if there is less than a tenth of a second remaining in the playback. If so, we remove the event listener and add a &quot;Video complete&quot; message after the progress bar:</p>
<pre><code>
/**** progress event handler ****/
onProgress : function (evt) {
  if ((evt.duration - evt.position) > .1) {
    eProgressBar.innerHTML += "&nbsp;";
  } else {
    videoPlayer.removeEventListener(mediaEvent.PROGRESS, onProgress);
    eProgress.innerHTML += " Video complete";
  }
}
</code></pre>
          </div>
          <div class="section" id="conclusion">
            <h2><a name="conclusion"></a>Conclusion</h2>
            <p>You now have all the basic tools for working with the Smart Player API. You can view the working player and code discussed in this topic at <a href="/en/video-cloud/smart-player-api/samples/basic-setup.html">http:/en/smart-player-api/samples/basic-setup.html</a>. You will find additional samples there as well.</p>
          </div>
        </div>
      </div>
    </div>
    <!-- bcl scripts -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.3/handlebars.min.js"></script>

    <script src="/en/scripts/docs-nav-data.min.js"></script>
    <script src="/en/scripts/bcls-doc-site.js"></script>
    <script>
        $(document).foundation();
    </script>
    <script id="pageScript" type="text/javascript">
      /******** Any scripts specific to page samples should go here *********/
    </script>
  <div style="text-align:center">
    <iframe id="CSAT" src="//learning-services-media.brightcove.com/doc-assets/general/surveylink.html" style=" padding-bottom:20px;border:none"></iframe>
</div>
<div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>
</html>
