<!DOCTYPE html>
<html lang="en">

    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
      <title id="bclPageTitle">Smart Player API Sample: Creating a Downloadable Link</title>
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" type="text/css">
      <script src="//use.edgefonts.net/source-code-pro.js"></script>
      <link rel="stylesheet" href="//files.brightcove.com/proxima-nova/font-faces.css" type="text/css">
      <link rel="stylesheet" href="/en/styles/bcls-doc-site.css" type="text/css"/>
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/zenburn.css" />
      <link rel="stylesheet" href="/en/styles/anytime.5.0.0-1401232312.min.css" type="text/css"/>
      <link rel="stylesheet" href="/en/video-cloud/smart-player-api/samples/css/api-samples.css" type="text/css">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2728311-29', 'auto');
  ga('send', 'pageview');

</script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
    </head>

    <body>
  <!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
  <!-- search -->
  <div id="searchModal" class="reveal-modal" data-reveal></div>
  <!-- content -->
    <div class="row">
        <div class="sidebar large-2 columns show-for-large-up">
            <div id="sidenav" class="side-nav"></div>
        </div>
        <div id="main" class="large-10 small-12 columns">
        <div id="top" class="section">
            <h1>Creating a Downloadable Link</h1>
            <!-- content starts here -->

            <!-- Start of content -->

            <p class="BCL-objective">This example uses the Smart Player API and the Media API to create a link to download the currently playing video.</p>
            <div class="text-warning">
                <p>This solution, requires the following:</p>
                <ul>
                    <li>A URL Access Read Token for the Media API</li>
                    <li>The account delivery method must be progressive download or have Universal Delivery Service enabled</li>
                </ul>
            </div>
        </div><!-- div id="top" -->

        <!-- every div class section must have an id -->
        <!--break-->
        <div id="resources" class="section">
        <!-- h2 contents will be in page navigation label - 21 characters (including spaces) maximum -->
          <h2><a name="resources"></a>API resources used</h2>
          <h3>Smart Player API</h3>
          <p>This sample uses the following API resources</p>
          <h4>Modules and methods</h4>
            <ul>
                <li>VIDEO_PLAYER</li>
                <ul>
                  <li>getCurrentVideo()</li>
                </ul>
            </ul>
          <h4>Events</h4>
          <ul>
            <li>onTemplateLoad</li>
            <li>onTemplateReady</li>
          </ul>
          <h3>Media API</h3>
          <p>This sample uses the following API resources</p>
          <h4>Modules and methods</h4>
            <ul>
                <li>BCMAPI</li>
                <ul>
                  <li>find_video_by_id()</li>
                </ul>
            </ul> 
          <h4>Events</h4>
          <ul>
            <li>mediaEvent: BEGIN</li>
          </ul>
          <p class="text-warning">Note: the read methods of the Smart Player API are availble to Express 3, Professional, and Enterprise accounts.</p>
          
        </div><!-- div id="resources" -->

        <div id="player" class="section">
            <!-- h2 contents will be in page navigation label - 21 characters (including spaces) maximum -->
            <h2><a name="player"></a>The player</h2>
            <p>A standard Chromeless Video Player with Tabbed Playlists is used for this sample. The tabbed navigation does not display since there is only one playlist.</p>
            <p class="text-warning">Note: the buttons below are for development purposes only &mdash; do not use in production.</p>

            <!-- buttons to switch between HTML and Flash Players -->
            <div id="modeSwitch">
                <span class="button" id="switchToHTML5" style="margin-bottom: 20px;margin-right: 10px;">Switch to HTML5 Player</span>
                <span class="button" id="switchToFlash" style="margin-bottom: 20px;">Switch to Flash Player</span>
           </div><!-- div id="modeSwitch" -->
                
            <!-- Start of Brightcove Player -->

            <div style="display:none">

            </div>

            <!--
            By use of this code snippet, I agree to the Brightcove Publisher T and C 
            found at https://accounts.brightcove.com/en/terms-and-conditions/. 
            -->

            <script language="JavaScript" type="text/javascript" src="http://admin.brightcove.com/js/BrightcoveExperiences.js"></script>

            <object id="myExperience" class="BrightcoveExperience">
              <param name="bgcolor" value="#FFFFFF" />
              <param name="width" value="960" />
              <param name="height" value="445" />
              <param name="playerID" value="4120338079001" />
              <param name="playerKey" value="AQ~~,AAABmA9XpXk~,-Kp7jNgisrdUptobknHXwZg_vxBmY7lb" />
              <param name="isVid" value="true" />
              <param name="isUI" value="true" />
              <param name="dynamicStreaming" value="true" />
              <!-- smart player api params -->
              <param name="includeAPI" value="true" />
              <param name="templateLoadHandler" value="onPlayerLoaded" />
              <param name="templateReadyHandler" value="onPlayerReady" />

            </object>

            <!-- 
            This script tag will cause the Brightcove Players defined above it to be created as soon
            as the line is read by the browser. If you wish to have the player instantiated only after
            the rest of the HTML is processed and the page load is complete, remove the line.
            -->
            <script type="text/javascript">brightcove.createExperiences();</script>

            <!-- End of Brightcove Player -->
            
            <p>Start playing a video to see the download link:</p>
            <div id="downloadLink" style="border:solid">&nbsp;</div>

         </div><!-- div id="player" -->

         <div id="logic" class="section" >
            <h2><a name="logic"></a>How it is done</h2>
            <p>The sample uses the Smart Player API and the Media API.</p>
            <h3>The Smart Player API part</h3>
            <p>When the player is ready, do the following:</p>
             <ul>
                 <li>Get a reference to the <code>VIDEO_PLAYER</code> module.</li>
                 <li>Call the <code>getCurrentVideo()</code> function to get the currently playing video object.</li>
                 <li>Add a listener for the <code>BEGIN</code> media event.</li>
             </ul> 
            <code data-gist-id="6186667" data-gist-line="62-73" data-gist-hide-footer="true"></code> 
             
            <h3>The Media API part</h3>
            <p>With the currently playing video id, set the following parameters and call the Media API:</p>
             <ul>
                 <li>The <code>token</code> must be a Read token with URL access.</li>
                 <li>Set the <code>callback</code> function to handle the data returned from the Media API call.</li>
                 <li>Set the <code>command</code> to use the <code>find_video_by_id</code> Media API method. </li>
                 <li>Set the <code>video_id</code> to search the Media API for the currently playing video.</li>
                 <li>Use the <code>video_fields</code> parameter to return only the <code>FLVURL</code> object.</li>
                 
             </ul> 
            <code data-gist-id="6186667" data-gist-line="75-98" data-gist-hide-footer="true"></code>
            
            <h3>The rest</h3>
            <p>The rest of the code is just JavaScript to create a link using the data from returned from the Media API call and inject it into the HTML page.</p>
             <code data-gist-id="6186667" data-gist-line="100-105" data-gist-hide-footer="true"></code>
            
          </div><!-- div id="logic" -->

          <div id="code" class="section">
            <h2><a name=""></a>The code</h2>
            <p>See the full code sample <a href="https://gist.github.com/bcls/6186667">here</a>.</p>
            <h3>Modifications to the player publishing code</h3>
              <p>Add the following in the player code to use the Smart Player API:</p>
            <code data-gist-id="6186667" data-gist-line="33-36" data-gist-hide-footer="true"></code>
            <h3>HTML used for this sample:</h3>
              <p>Add the following to for the download button:</p>
                <code data-gist-id="6186667" data-gist-line="50" data-gist-hide-footer="true"></code>
            <h3>Script for MAPI Plugin:</h3>
              <p>Add the following script to use the Media API:</p>
                <code data-gist-id="6186667" data-gist-line="51-52" data-gist-hide-footer="true"></code>
            <h3>JavaScript used for this sample:</h3>
              <p>Here is the complete JavaScript code needed:</p>
                <code data-gist-id="6186667" data-gist-line="53-106" data-gist-hide-footer="true"></code>
          </div><!-- div id="code" -->   

      </div><!-- div id="main" -->
    </div><!-- <div class="row"> -->

    <!-- bcl scripts -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/2.2/gist-embed.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.3/handlebars.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>

    <script src="/en/scripts/docs-nav-data.min.js"></script>
    <script src="/en/scripts/bcls-doc-site.js"></script>
    <script src="/en/scripts/flashHTMLswitch-nojQ.js"></script>
    <script>
        $(document).foundation();
    </script>
    <!--******** Any scripts specific to page samples should go here *********-->
    <!-- add MAPI wrapper from http://opensource.brightcove.com/ -->
	<script type="text/javascript" src="http://files.brightcove.com/bc-mapi.js"></script>
        
    <script id="pageScript" type="text/javascript">

	  <!-- custom script for downloadable link -->
		var player,
			videoPlayer,
			APIModules,
			mediaEvent,
			listeningForChangeEvent = false;

		function onPlayerLoaded(id) {
			player = brightcove.api.getExperience(id);
			APIModules = brightcove.api.modules.APIModules;
			mediaEvent = brightcove.api.events.MediaEvent;
		}

		function onPlayerReady(event) {
			videoPlayer = player.getModule(APIModules.VIDEO_PLAYER);
			videoPlayer.getCurrentVideo(function (videoDTO) {
				videoPlayer.addEventListener(mediaEvent.BEGIN, onMediaBegin);
			})
		}

		function onMediaBegin(event) {
			getDownloadLink(event.media.id);
		}

		function getDownloadLink(id) {
			// Use media API to get URL to video
			//
			// object for search parameters
			var searchParams = new Object();
			// set Media API token - MUST BE URL ACCESS READ token!!
			BCMAPI.token = "XGuquNMCweRY0D3tt_VUotzuyIASMAzhUS4F8ZIWa_e0cYlKpA4WtQ..";
			// set callback for Media API call
			BCMAPI.callback = "onSearchResult";
			// set command
			BCMAPI.command = "find_video_by_id";
			// set search params
			searchParams.video_id = id;
			// need this if the delivery for the account is streaming, and Universal Delivery Service must be enabled!
			searchParams.media_delivery = "HTTP";
			// just get the field we need for better performance
			searchParams.video_fields = "FLVURL";
			// execute the search
			BCMAPI.find(BCMAPI.command, searchParams);
		}

		function onSearchResult(jsondata) {
			// create the link and write it into the HTML
			var str = "";
			str += "<a href='" + jsondata.FLVURL + "'>Download the Video</a>";
			document.getElementById("downloadLink").innerHTML = str;
		}
	  <!-- end of custom script for downloadable link -->
    </script>

      
    
	<iframe id="CSAT" src="http://survey.clicktools.com/app/survey/go.jsp?iv=3poon3e7e9spn&q1=[articleURL]" style="margin-left:25%; padding-bottom:20px;width:550px;height:475px;border:none"></iframe>
<script>
    
    var cSat = document.getElementById('CSAT'),
        cSatSrc = cSat.getAttribute('src'),
        pageurl = window.location.href;
    cSat.setAttribute('src', cSatSrc.replace('[articleURL]', pageurl));
    
</script>
<br><br>
<div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>
</html>