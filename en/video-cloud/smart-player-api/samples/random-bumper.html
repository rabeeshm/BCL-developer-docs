<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
  <title id="bclPageTitle">Smart Player API Sample: Display Random Bumper</title>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" type="text/css">
  <script src="//use.edgefonts.net/source-code-pro.js"></script>
  <link rel="stylesheet" href="//files.brightcove.com/proxima-nova/font-faces.css" type="text/css">
  <link rel="stylesheet" href="/en/styles/bcls-doc-site.css" type="text/css"/>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/zenburn.css" />
  <link rel="stylesheet" href="/en/styles/anytime.5.0.0-1401232312.min.css" type="text/css"/>
  <link rel="stylesheet" href="/en/video-cloud/smart-player-api/samples/css/api-samples.css" type="text/css">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2728311-29', 'auto');
  ga('send', 'pageview');

</script>

  <style id="pageStyles">
  .BrightcoveExperience {
   margin-top: 10px;
 }
 .player-block {
   position: relative;
 }
 </style>
  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
</head>

<body>
  <!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
  <!-- search -->
  <div id="searchModal" class="reveal-modal" data-reveal></div>
  <!-- content -->
    <div class="row">
        <div class="sidebar large-2 columns show-for-large-up">
            <div id="sidenav" class="side-nav"></div>
        </div>
        <div id="main" class="large-10 small-12 columns">
      <div id="top" class="section">
        <h1>Display Random Bumper</h1>
        <!-- content starts here -->

        <!-- Start of content -->

        <p class="BCL-objective">This example uses the Smart Player API to retrieve a playlist of videos, and a playlist of bumpers. The bumpers are then displayed randomly before the videos, which are sequentially played from their playlist.</p>
      </div><!-- div id="top" -->

      <!-- every div class section must have an id -->
      <!--break-->
      <div id="resources" class="section">
        <!-- h2 contents will be in page navigation label - 21 characters (including spaces) maximum -->
        <h2><a name="resources"></a>API resources used</h2>
        <h3>Smart Player API</h3>
        <p>This sample uses the following API resources</p>
        <h4>Modules and methods</h4>
        <ul>
          <li>
            <ul>
              <li>VIDEO_PLAYER
                <ul>
                  <li>loadVideoByID()</li>
                  <li>addEventListner()</li>
                </ul>
              </li>
              <li>CONTENT
                <ul>
                  <li>getPlaylistByID()</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
        <h4>Events</h4>
        <ul>
          <li>onTemplateLoad</li>
          <li>onTemplateReady</li>
          <li>brightcove.api.events.MediaEvent.COMPLETE</li>
        </ul>
        <p class="text-warning">Note: the read methods of the Smart Player API are available to Express 3, Professional, and Enterprise accounts.</p>
      </div><!-- div id="resources" -->

      <div id="player" class="section">
        <h2><a name="player"></a>Functioning example</h2>
        <!-- Start of Brightcove Player -->

        <div style="display:none">

        </div>

        <!--
        By use of this code snippet, I agree to the Brightcove Publisher T and C 
        found at https://accounts.brightcove.com/en/terms-and-conditions/. 
        -->

        <script language="JavaScript" type="text/javascript" src="//sadmin.brightcove.com/js/BrightcoveExperiences.js"></script>

        <object id="myExperience" class="BrightcoveExperience">
          <param name="bgcolor" value="#FFFFFF" />
          <param name="width" value="480" />
          <param name="height" value="270" />
          <param name="playerID" value="2777517096001" />
          <param name="playerKey" value="AQ~~,AAABmA9XpXk~,-Kp7jNgisrdOEKhkvvjNiKQev78EzkwS" />
          <param name="isVid" value="true" />
          <param name="isUI" value="true" />
          <param name="dynamicStreaming" value="true" />

          <!-- smart player api params -->
          <param name="includeAPI" value="true" />
          <param name="templateLoadHandler" value="onTemplateLoad" />
          <param name="templateReadyHandler" value="onTemplateReady" />


        </object>

          <!-- 
          This script tag will cause the Brightcove Players defined above it to be created as soon
          as the line is read by the browser. If you wish to have the player instantiated only after
          the rest of the HTML is processed and the page load is complete, remove the line.
        -->
        <script src="//docs.brightcove.com/en/scripts/https-fix.js"></script><script type="text/javascript">brightcove.createExperiences();</script>

        <!-- End of Brightcove Player -->

      </div><!-- div id="player" -->

      <div id="logic" class="section" >
        <h2><a name="logic"></a>How it is done</h2>
        <p class="BCL-aside">In this example bumpers are not used in the strictest Brightcove sense, as the bumpers are not the files associated with a video in Video Cloud Studio, but just a playlist of videos you wish to use as bumpers.</p>
        <p>The sample uses the Smart Player API to retrieve playlist for both the videos to play and the bumpers to use. A bumper is randomly selected and played. When the <code>COMPLETE</code> event is dispatched for the bumper, the first video is played. When the <code>COMPLETE</code> event is dispatched for the video, another bumper is randomly selected and played. The same process continues until the end of the video playlist is reached.</p>
        <p>In this example the bumpers are four second videos that spell out hello and how are you in English, German and Spanish</p>
        <img src="./assets/random-bumper-bumper-example.png">
        <h3>The Smart Player API part</h3>
        <p>In the <code>onTemplateReady</code> handler, the content module is used to retrieve the two playlists. In addition, the <code>COMPLETE</code> event listener is setup.</p>
        <code data-gist-id="7304024" data-gist-hide-footer="true" data-gist-line="64-71"></code>
        <p>In the callback functions for the playlist retrievals, the videos DTO (data transfer object), which is stored in array, is assigned to respective variables. Also, the <code>videoCount</code> property of the bumpers playlist is assigned to a variable as it is required for proper random number generation. The locally defined <code>plaVideo()</code> method is called at the end of the bumpers callback to start initial playing of the bumper.</p>
        <code data-gist-id="7304024" data-gist-hide-footer="true" data-gist-line="73-83"></code>
        <h3>The rest</h3>
        <p>In the <code>playVideo()</code> method, the random number is generated based on the number of bumpers using a couple of JavaScript <code>Math</code> methods, <code>floor</code> and <code>random</code>.</p>
        <code data-gist-id="7304024" data-gist-hide-footer="true" data-gist-line="87"></code>
        <p>A boolean variable, <code>playBumper</code>, which is initialized to <code>true</code>, controls the <code>if</code> statement as to whether a bumper or video is played. Note also a counter, named <code>videoIndexToPlay</code>, is incremented to sequentially play the videos.</p>
        <code data-gist-id="7304024" data-gist-hide-footer="true" data-gist-line="89-98"></code>
      </div><!-- div id="logic" -->

      <div id="code" class="section">
        <h2><a name="code"></a>The code</h2>
        <p>See the full code <a href="https://gist.github.com/bcls/7304024">here</a>.</p>
      </div><!-- div id="code" -->

    </div><!-- div id="main" -->
  </div><!-- <div class="row"> -->

  <!-- bcl scripts -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/2.2/gist-embed.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.3/handlebars.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
  <script src="/en/scripts/docs-nav-data.min.js"></script>
  <script src="/en/scripts/bcls-doc-site.js"></script>
  <script src="/en/scripts/flashHTMLswitch.js"></script>
    <script>
        $(document).foundation();
    </script>

  <!--******** Any scripts specific to page samples should go here *********-->
  <script src="/en/scripts/secondsToTime.js"></script>
  <script id="pageScript" type="text/javascript">

    <!-- custom scripts for this player and functionality -->

    var player,
    APIModules,
    videoPlayer,
    videosAra,
    bumperVideosAra,
    bumperVideosAraLength,
    videoIndexToPlay=0,
    playBumper=true;

    var onTemplateLoad = function(experienceID){
     player = brightcove.api.getExperience(experienceID);
     APIModules = brightcove.api.modules.APIModules;
   };

   var onTemplateReady = function(evt){
     var contentModule;
     videoPlayer = player.getModule(APIModules.VIDEO_PLAYER);
     contentModule = player.getModule(APIModules.CONTENT);
     contentModule.getPlaylistByID("1754200320001", onGetPlaylist);
     contentModule.getPlaylistByID("2777614845001", onGetBumperPlaylist);
     videoPlayer.addEventListener(brightcove.api.events.MediaEvent.COMPLETE, playVideo);
   };

   var onGetPlaylist = function(playlistDTO){
    console.log(playlistDTO);
    videosAra = playlistDTO.videos;
  };

  var onGetBumperPlaylist = function(playlistDTO){
    console.log(playlistDTO);
    bumperVideosAra = playlistDTO.videos;
    bumperVideosAraLength = playlistDTO.videoCount;
    playVideo();
  };

  var playVideo = function(evt){
    var toPlayID;
    var bumperRandomNumber = Math.floor(Math.random()*bumperVideosAraLength);
    console.log(bumperRandomNumber);
    if (playBumper){
      playBumper = false;
      toPlayID = bumperVideosAra[bumperRandomNumber].id;
      videoPlayer.loadVideoByID(toPlayID);
    } else {
      playBumper = true;
      toPlayID = videosAra[videoIndexToPlay].id;
      videoPlayer.loadVideoByID(toPlayID);
      videoIndexToPlay++;
    }
  };

  <!-- end custom scripts for this player and functionality -->

</script>

    
    
	<div style="text-align:center">
    <iframe id="CSAT" src="//learning-services-media.brightcove.com/doc-assets/general/surveylink.html" style=" padding-bottom:20px;border:none"></iframe>
</div>
<div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>
</html>