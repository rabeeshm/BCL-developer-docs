<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <!-- change title to match the h1 heading -->
    <title id="bclPageTitle">Bumper for Flash or HTML Player</title>
    <link href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" rel="stylesheet" type="text/css" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

    <link rel="stylesheet" type="text/css" href="/en/styles/bcls-doc-site.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

    <link href="/en/video-cloud/smart-player-api/samples/css/api-samples.css" rel="stylesheet" type="text/css">
    <style id="pageStyles">
      .BrightcoveExperience {
        margin-top: 20px;
      }
    </style>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2728311-29', 'auto');
  ga('send', 'pageview');

</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
  </head>
  <body>
  <!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
  <!-- search -->
  <div id="searchModal" class="reveal-modal" data-reveal></div>
  <!-- content -->
    <div class="row">
        <div class="sidebar large-2 columns show-for-large-up">
            <div id="sidenav" class="side-nav"></div>
        </div>
        <div id="main" class="large-10 small-12 columns">

        <div id="top" class="section">
            <h1>Bumper for Flash or HTML Player</h1>
          <p>This sample plays what looks like a preroll bumper clip. It is not a true bumper, because they are always played preroll. Instead, the "bumpers" here are just other video clips from the media library. This allows the "bumper" to work in both Flash and HTML players (provided the "bumper" video has HLS or at least MP4 renditions). The "bumper" is chosen randomly from an array of 2 video ids stored in the long description field of the main video.</p>
        </div>
        <!-- every div class section must have an id -->
        <div class="section" id="resources">
          <h2><a name="resources"></a>API resources used</h2>
          <p>This sample uses the following API resources</p>
          <h4>Modules and methods</h4>
          <ul>
            <li>VIDEO_PLAYER
              <ul>
                <li>getCurrentVideo()</li>
                <li>play()</li>
                <li>pause()</li>
                <li>addEventListener()</li>
                <li>removeEventListener()</li>
              </ul>
            </li>
          </ul>
          <h4>Events</h4>
          <ul>
            <li>templateLoad</li>
            <li>templateReady</li>
            <li>Media: PROGRESS</li>
            <li>Media: PLAY</li>
          </ul>
        </div>
        <div class="section" id="player">
          <!-- h2 contents will be in page navigation label - 28 characters (including spaces) maximum -->
          <h2><a name="player"></a>The Player</h2>
          <p>A standard Chromeless Video Player is used for this sample.</p>
<!--           <p class="text-warning">Note: In HTML mode, different browsers yield inconsistent functionality.</p>
 -->          <!-- buttons to switch between HTML and Flash Players -->
          <div id="modeSwitch">
            <span class="button" id="switchToHTML5" style="margin-bottom: 20px;margin-right: 10px;">Switch to HTML5 Player</span>
            <span class="button" id="switchToFlash" style="margin-bottom: 20px;">Switch to Flash Player</span>
          </div>
          <hr/>
          <div class="player-block">
            <!-- Start of Brightcove Player -->
            <script language="JavaScript" type="text/javascript" src="//sadmin.brightcove.com/js/BrightcoveExperiences.js"></script>
            <object id="myExperience921449663001" class="BrightcoveExperience">
              <param name="bgcolor" value="#FFFFFF" />
              <param name="width" value="480" />
              <param name="height" value="270" />
              <param name="playerID" value="2079935931001" />
              <param name="playerKey" value="AQ~~,AAAA1oy1bvE~,ALl2ezBj3WE0z3yX6Xw29sdCvkH5GCJv" />
              <param name="isVid" value="true" />
              <param name="isUI" value="true" />
              <param name="dynamicStreaming" value="true" />
              <param name="@videoPlayer" value="928199562001" />

              <param name="includeAPI" value="true" />
              <param name="templateLoadHandler" value="BCLS.onTemplateLoad" />
              <param name="templateReadyHandler" value="BCLS.onTemplateReady" />
            </object>
            <script src="//docs.brightcove.com/en/scripts/https-fix.js"></script><script type="text/javascript">brightcove.createExperiences();</script>
            <!-- End of Brightcove Player -->
          </div>
        </div>
        <div class="section" id="logic">
          <h2><a name="logic"></a>How it is done</h2>
          <p>To play a single "bumper" is straightforward. You need a reference to the VIDEO_PLAYER module and to set up a listener for media PLAY events. In the play event handler, as soon as you hear an event, pause the main video, remove the event listener, and use <code>loadVideoByID()</code> to play the bumper. You need to use <code>removeEventListener()</code> to remove the PLAY event listener, or you will loop endlessly through the bumper!</p>
          <p>You also need to set another event listener so that you hear the end of the bumper and know when to reload the main video. You could use the media <code>COMPLETE</code> event, but there is a potential problem. By default, Video Cloud players end playback with an menu screen that shows related videos. The player is still there, but in reduced size. By the time the COMPLETE event fires, the menu will be showing, and so the next video you load will play in the smaller-sized screen. To avoid this, use PROGRESS again &mdash; with a different handler &mdash; and stop the bumper about a two tenths of a second before the end.</p>
          <p>After the bumper, you need to reload the main video. Remember to remove the PROGRESS listener for the bumper when it finishes.</p>
          <p>The above generally describes the logic of this sample. The code is slightly more complex, because we decided to allow the possibility of playing different bumpers. the bumper information is stored in a JSON array in the <code>longDescription</code> field:</p>
<pre><code>
[1844554046001, 1844554045001]
</code></pre>
          <p>We then just generate a random number and convert it to an integer between 1 and 10 to decide which of the bumpers to play.</p>
        </div>
        <div class="section" id="code">
          <h2><a name="code"></a>The code</h2>
          <h3>Modifications to the player publishing code</h3>
<pre><code>
  &lt;!-- smart player api params --&gt;
  &lt;param name="includeAPI" value="true" /&gt;
  &lt;param name="templateLoadHandler" value="BCLS.onTemplateLoad" /&gt;
  &lt;param name="templateReadyHandler" value="BCLS.onTemplateReady" /&gt;
</code></pre>
          <h3>CSS used for this sample:</h3>
<pre><code id="css_code"></code></pre>
          <h3>JavaScript used for this sample:</h3>
<pre><code id="js_code"></code></pre>
        </div>
      </div>
    </div>
    <!-- bcl scripts -->
    <script src="/en/scripts/prefix.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.3/handlebars.min.js"></script>

    <script src="/en/scripts/docs-nav-data.min.js"></script>
    <script src="/en/scripts/bcls-doc-site.js"></script>
    <script src="/en/scripts/flashHTMLswitch-nojQ.js"></script>
    <script>
        $(document).foundation();
    </script>
    <script id="pageScript" type="text/javascript">
      /******** Any scripts specific to page samples should go here *********/
      /**** Brightcove Learning namespace ****/
      var BCLS = (function() {
        // vars
        var player,
            APIModules,
            mediaEvent,
            videoPlayer,
            bumpers,
            mainVideo,
            bumperType = "midroll",
            // functions
            onTemplateLoad,
            onTemplateReady,
            onMainProgress,
            onBumperProgress;
        // public functions
        return {
          /**** template loaded event handler ****/
          onTemplateLoad : function (experienceID) {
            // get a reference to the player and API Modules and Events
            player = brightcove.api.getExperience(experienceID);
            APIModules = brightcove.api.modules.APIModules;
            mediaEvent = brightcove.api.events.MediaEvent;
          },
          /**** template ready event handler ****/
          onTemplateReady : function (evt) {
            // get references to modules
            videoPlayer = player.getModule(APIModules.VIDEO_PLAYER);
            // add progress event listener
            videoPlayer.addEventListener(mediaEvent.PLAY, BCLS.onMainPlay);
            // get current video for bumper info
            videoPlayer.getCurrentVideo( function (videoDTO) {
              // bumper info stored in longDescription as JSON
              bumpers = JSON.parse(videoDTO.longDescription);
              // save the main video ID
              mainVideo = videoDTO.id;
            });
          },
          /**** main video PROGRESS handler ****/
          onMainPlay : function (evt) {
            var randomNumber = Math.random() * 10, // random number between 1 and 10
                idx;
            // as soon as we get progress, pause the player
            videoPlayer.pause();
                // remove this listener so we don't loop on the bumper
                videoPlayer.removeEventListener(mediaEvent.PLAY, BCLS.onMainPlay);
                // pause the video
                videoPlayer.pause(true);
                // add PROGRESS listener for bumper
                videoPlayer.addEventListener(mediaEvent.PROGRESS, BCLS.onBumperProgress);
                // load the bumper
                idx = (Math.ceil(randomNumber * 10) < 6) ? 0 : 1;
            console.log(idx);
                videoPlayer.loadVideoByID(bumpers[idx]);
          },
         /**** handler for bumper PROGRESS ****/
         onBumperProgress : function (evt) {
            if ((evt.duration - evt.position) < .2) {
              // stop the bumper
              videoPlayer.pause(true);
              // remove this event listener
              videoPlayer.removeEventListener(mediaEvent.PROGRESS, BCLS.onBumperProgress);
              // resume the main video
              videoPlayer.loadVideoByID(mainVideo);
            };
          }
        }
      }());
   </script>
    <script>
      $(document).ready(function(){
        $("#js_code").html(BCLSpreFix($("#pageScript").html()));
        $("#css_code").html(BCLSpreFix($("#pageStyles").html()));
      });
    </script>
      
    
	<div style="text-align:center">
    <iframe id="CSAT" src="//learning-services-media.brightcove.com/doc-assets/general/surveylink.html" style=" padding-bottom:20px;border:none"></iframe>
</div>
<div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>
</html>
