<!DOCTYPE html>
<html lang="en">

    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
      <title id="bclPageTitle">Smart Player API Sample: Set Dynamic Ad Policy</title>
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" type="text/css">
      <script src="//use.edgefonts.net/source-code-pro.js"></script>
      <link rel="stylesheet" href="//files.brightcove.com/proxima-nova/font-faces.css" type="text/css">
      <link rel="stylesheet" href="/en/styles/bcls-doc-site.css" type="text/css"/>
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/zenburn.css" />
      <link rel="stylesheet" href="/en/styles/anytime.5.0.0-1401232312.min.css" type="text/css"/>
      <link rel="stylesheet" href="/en/video-cloud/smart-player-api/samples/css/api-samples.css" type="text/css">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2728311-29', 'auto');
  ga('send', 'pageview');

</script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
    </head>

    <body>
  <!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
  <!-- search -->
  <div id="searchModal" class="reveal-modal" data-reveal></div>
  <!-- content -->
    <div class="row">
        <div class="sidebar large-2 columns show-for-large-up">
            <div id="sidenav" class="side-nav"></div>
        </div>
        <div id="main" class="large-10 small-12 columns">
        <div id="top" class="section">
          <h1>Set Dynamic Ad Policy</h1>
          <!-- content starts here -->

          <!-- Start of content -->

          <p class="BCL-objective">This example uses the Advertising Module's <code>getAdPolicy()</code> and <code>setAdPolicy()</code> functions to alter the player's ad policy programmatically.</p>
		  <p>The ad policy contains properties which control many of the advertising aspects of the player such as when, how and which ads to play. While the ad policy can be configured initially in the Advertising Module of Video Cloud Studio, this is a static approach that does not allow for dynamic ad policy changes based on events that may occur during page load or playback.</p>
		  <p>The ability to set the ad policy through an API gives publishers a much greater level of control as they can update the players internal ad properties dynamically based on their own logic. While this feature previously existed for the Flash player, it is new in the HTML player and has been added to the Smart Player API for ease of use and consistency.</p>
          
           <p>For more information about the Ad Module, refer to the <a href="//docs.brightcove.com/en/video-cloud/smart-player-api/references/symbols/brightcove.api.modules.AdModule.html">Smart Player API Reference</a> document.</p>
        </div><!-- div id="top" -->

        <!-- every div class section must have an id -->
        <!--break-->
        <div id="resources" class="section">
        <!-- h2 contents will be in page navigation label - 21 characters (including spaces) maximum -->
          <h2><a name="resources"></a>API resources used</h2>
          <h3>Smart Player API</h3>
          <p>This sample uses the following API resources</p>
          <h4>Modules and methods</h4>

            <ul>
              <li>ADVERTISING
                <ul>
                  <li>getAdPolicy()</li>
                  <li>setAdPolicy()</li>
                </ul>
              </li>
            </ul>
           
          <h4>Events</h4>
          <ul>
            <li>onTemplateLoad</li>
            <li>onTemplateReady</li>
            <li>AdEvent</li>
              <ul>
                  <li>START</li>
                  <li>COMPLETE</li>
              </ul>
          </ul>
          <p class="text-warning">Note: the read methods of the Smart Player API and access to the Advertising module are available to Express 3, Professional, and Enterprise accounts.</p>
          
        </div><!-- div id="resources" -->

        <div id="player" class="section">
            <!-- h2 contents will be in page navigation label - 21 characters (including spaces) maximum -->
            <h2><a name="player"></a>The player</h2>
            <p>A standard Single Video Player is used for this sample.</p>
            <p class="text-warning">Note: the buttons below are for development purposes only &mdash; do not use in production.</p>

            <!-- buttons to switch between HTML and Flash Players -->
            <div id="modeSwitch">
                <span class="button" id="switchToHTML5" style="margin-bottom: 20px;margin-right: 10px;">Switch to HTML5 Player</span>
                <span class="button" id="switchToFlash" style="margin-bottom: 20px;">Switch to Flash Player</span>
           </div><!-- div id="modeSwitch" -->
            
            <!-- Start of Brightcove Player -->

            <div style="display:none">

            </div>

            <!--
            By use of this code snippet, I agree to the Brightcove Publisher T and C 
            found at https://accounts.brightcove.com/en/terms-and-conditions/. 
            -->

            <script language="JavaScript" type="text/javascript" src="//sadmin.brightcove.com/js/BrightcoveExperiences.js"></script>

            <object id="myExperience1754276205001" class="BrightcoveExperience">
              <param name="bgcolor" value="#FFFFFF" />
              <param name="width" value="500" />
              <param name="height" value="470" />
              <param name="playerID" value="3370746950001" />
              <param name="playerKey" value="AQ~~,AAABmA9XpXk~,-Kp7jNgisrc_2w_IwFW_Rxeb-M1sQEEm" />
              <param name="isVid" value="true" />
              <param name="isUI" value="true" />
              <param name="dynamicStreaming" value="true" />
              <param name="@videoPlayer" value="1754276205001" />

              <!-- smart player api params -->
              <param name="includeAPI" value="true" />
              <param name="templateLoadHandler" value="onTemplateLoad" />
              <param name="templateReadyHandler" value="onTemplateReady" />
            </object>

            <!-- 
            This script tag will cause the Brightcove Players defined above it to be created as soon
            as the line is read by the browser. If you wish to have the player instantiated only after
            the rest of the HTML is processed and the page load is complete, remove the line.
            -->
            <script src="//docs.brightcove.com/en/scripts/https-fix.js"></script><script type="text/javascript">brightcove.createExperiences();</script>

            <!-- End of Brightcove Player -->    
            
         </div><!-- div id="player" -->
			
		 <div id="difference" class="section">
            <h2><a name="difference"></a>HTML vs Flash</h2>
             <p>The only difference when it comes to using the <code>setAdPolicy()</code> function is that onLoad ads are not supported in the HTML player. Because of this, even if enabled, the HTML player will not play onLoad ads. For the sake of consistency we allow the publisher to set the <code>playAdOnLoad</code> and <code>onLoadAdKeys</code> properties in the HTML player. However, it will not actually affect any type of ad play back and will display a debug log to ensure the publisher is aware</p>   
          </div><!-- div id="difference" -->
		 
		 <div id="properties" class="section">
            <h2><a name="properties"></a>Properties</h2>
            <p>The following is a list of internal advertising properties that are configurable through the use of <code>setAdPolicy()</code> function:</p>
		   <table class="bcl-table">
				<tbody>
					<tr>
						<th>Property</th>
						<th>Type</th>
						<th>Description</th>
					</tr>
					<tr>
						<td><code>adServerURL</code></td>
						<td>String</td>
						<td>Address to use for fetching the ad or VAST xml</td>
					</tr>
					<tr>
						<td><code>playAdOnLoad</code></td>
						<td>Boolean</td>
						<td>Enables/disables onLoad ads</td>
					</tr>
					<tr>
						<td><code>prerollAds</code></td>
						<td>Boolean</td>
						<td>Enables/disables preroll ads</td>
					</tr>
					<tr>
						<td><code>midrollAds</code></td>
						<td>Boolean</td>
						<td>Enables/disables midroll ads</td>
					</tr>
					<tr>
						<td><code>postrollAds</code></td>
						<td>Boolean</td>
						<td>Enables/disables postroll ads</td>
					</tr>
					<tr>
						<td><code>playerAdKeys</code></td>
						<td>String</td>
						<td>Key/value pairs for all ad selections.</td>
					</tr>
					<tr>
						<td><code>onLoadAdKeys</code></td>
						<td>String</td>
						<td>Key/value pairs for onLoad ad selections</td>
					</tr>
					<tr>
						<td><code>prerollAdKeys</code></td>
						<td>String</td>
						<td>Key/value pairs for preroll ad selections</td>
					</tr>
					<tr>
						<td><code>midrollAdKeys</code></td>
						<td>String</td>
						<td>Key/value pairs for midroll ad selections</td>
					</tr>
					<tr>
						<td><code>postrollAdKeys</code></td>
						<td>String</td>
						<td>Key/value pairs for postroll ad selections</td>
					</tr>
					<tr>
						<td><code>adPlayCap</code></td>
						<td>Number</td>
						<td>Number of ads to play at each insertion point</td>
					</tr>
				</tbody>
			</table>
			<p>If you attempt to update a property that does not appear on this list, that specific property will be ignored and debug logs will be generated. Any other valid properties will still be updated correctly.</p>  
          </div><!-- div id="properties" -->

         <div id="logic" class="section" >
			<h2><a name="logic"></a>How it is done</h2>
            <p>The sample uses the Smart Player API.</p>
            <h3>Player Setup in Video Cloud</h3>
            <p>Log into your account in  Video Cloud and do the following steps:</p>
            <ul>
                <li>For your player, make sure that you have checked the web setting to enable ActionScript/JavaScript APIs.</li>
                <li>In the Advertising Module and turn <strong>Ads On</strong> for your player.</li>
                <div><img src="/en/video-cloud/smart-player-api/samples/assets/set-ad-policy1.png"/></div>
                <li>In the Advertising Module, open the edit settings for your player. There are some limitations with using the <strong>Default</strong> value for the <strong>Ad Source</strong>. It is recommended that you change this setting to <strong>DFP IMA 3</strong>. Refer to the <a href="#limitations">Limitations</a> section for details.</li>
                <div><img src="/en/video-cloud/smart-player-api/samples/assets/set-ad-policy2.png"/></div>
            </ul>
            <h3>The Smart Player API part</h3>
             <p>When the player is loaded, get a reference to our player and the <code>APIModules</code> object.</p>   
             <p><code data-gist-id="9759079" data-gist-line="81-86" data-gist-hide-footer="true"></code><p>
             
             <p>When the player is ready, get a reference to the <code>ADVERTISING</code> module and call its <code>getAdPolicy()</code> method. Here, you can optionally set event listeners for the ad <code>START</code> and <code>COMPLETE</code> events.</p>
            <p><code data-gist-id="9759079" data-gist-line="88-100" data-gist-hide-footer="true"></code></p>
             
            <p>In the <code>getAdPolicyHandler()</code> function, dynamically set properties for the ad policy. Some of these properties include the following:</p>
             <ul>
                 <li>The <code>prerollAds</code> property is used to specify whether the player will allow pre-roll ads.</li>
                 <li>The <code>adServerURL</code> property points to the ad <a href="//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=%2F15018773%2Feverything2&ciu_szs=300x250%2C468x60%2C728x90&impl=s&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=dummy&correlator=[timestamp]&cmsid=133&vid=10XWSh7W4so&ad_rule=1">XML file</a>, which defines pre-roll, mid-roll and/or post-roll ads. This example uses the DoubleClick for Publisthers (DFP) server to deliver the ads. You'll see URLs from this server in the ad XML file. For more information about using the DFP server, view the <a href="//support.brightcove.com/en/video-cloud/docs/using-doubleclick-publishers-dfp-deliver-ads-html5">Using DoubleClick for Publishers (DFP) to Deliver Ads with HTML5</a> document.</li>
                 <li>The <code>adPlayCap</code> property limits the number of ads shown per interval.</li>
             </ul>
            <p><code data-gist-id="9759079" data-gist-line="63-69" data-gist-hide-footer="true"></code></p>            
          </div><!-- div id="logic" -->

          <div id="code" class="section">
            <h2><a name=""></a>The code</h2>
            <p>See the full code sample <a href="https://gist.github.com/bcls/9759079">here</a>.</p>
            <h3>Modifications to the player publishing code</h3>
            <code data-gist-id="9759079" data-gist-line="36-39" data-gist-hide-footer="true"></code>

            <h3>JavaScript used for this sample:</h3>
		    <code data-gist-id="9759079" data-gist-line="53-102" data-gist-hide-footer="true"></code>
          </div><!-- div id="code" -->
          
          <div id="limitations" class="section">
            <h2><a name="limitations"></a>Limitations</h2>
            <p>The following issues appear when using the "Default" or "DFP IMA 2" Ad Source from the drop down in the Advertising Module. It is highly recommended to upgrade to "DFP IMA 3" to avoid these issues with the Smart Player API.</p>
			<ul>
				<li>If pre-rolls are disabled in the ad policy in the Advertising Dashboard Module and then enabled through a Javascript embed on the page, the ad will play as the main video and the main content will not show. Note that this is only for those two specified Ad Sources and does not occur for ad plugins.</li>
				<li>If pre-rolls are enabled in the ad policy in the Advertising Dashboard Module and then disabled through a Javascript embed on the page, the ad will play followed by the main content. Disabling pre-rolls in the case will not work. Note that this is only for those two specified Ad Sources and does not occur for ad plugins.</li>
			</ul>
			  
          </div><!-- div id="define" -->
			
		  <div class="section" id="BCLreferences">
            <h2>Related Topics</h2>
            <ul>
              <li> <a href="//support.brightcove.com/en/video-cloud/docs/dynamic-ad-policies-using-setadpolicy-api">Dynamic Ad Policies using the setAdPolicy API (for Flash players only)</a></li>
			  <li> <a href="//support.brightcove.com/en/video-cloud/docs/creating-ad-plug-html-players">Creating an Ad Plug-In for HTML players</a></li>
			  <li> <a href="//support.brightcove.com/en/video-cloud/docs/delivering-advertising-html5">Delivering Advertising for HTML5</a></li>
              <li> <a href="//support.brightcove.com/en/video-cloud/docs/using-doubleclick-publishers-dfp-deliver-ads-html5">Using DoubleClick for Publishers (DFP) to Deliver Ads with HTML5</a></li>
              <li> <a href="//support.brightcove.com/en/video-cloud/docs/using-brightcove-advertising-module">Using the Video Cloud Advertising Module</a></li>
            </ul>
          </div>

      </div><!-- div id="main" -->
    </div><!-- <div class="row"> -->

    <!-- bcl scripts -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/2.2/gist-embed.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.3/handlebars.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>

    <script src="/en/scripts/docs-nav-data.min.js"></script>
    <script src="/en/scripts/bcls-doc-site.js"></script>
    <script src="/en/scripts/flashHTMLswitch-nojQ.js"></script>
    <script>
        $(document).foundation();
    </script>

    <!--******** Any scripts specific to page samples should go here *********-->
<!--    <script src="/en/scripts/secondsToTime.js"></script>-->
    <!-- custom script for this page -->
    <script id="pageScript" type="text/javascript">

        var player,
			APIModules,
			adModule;
        
        var onAdPolicySetupComplete = function() {
             console.log("The ad policy was set up!");    
        }
        
        var getAdPolicyHandler = function(adPolicy) {
            adPolicy.prerollAds = true; // when false, played all ads at end (post-roll)
            adPolicy.adServerURL = "http://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=%2F15018773%2Feverything2&ciu_szs=300x250%2C468x60%2C728x90&impl=s&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=dummy&correlator=[timestamp]&cmsid=133&vid=10XWSh7W4so&ad_rule=1"; // plays pre-roll, mid-roll and post-roll ads
            adPolicy.adPlayCap = 2; // this seems to be overridden by the xml files

            adModule.setAdPolicy(adPolicy, onAdPolicySetupComplete); 
        }
        
        var onAdStart = function(evt) {
			 console.log("onAdStart");
            /* perform whatever ad actions that you want - I am not sure what these would be? */ 
		}
		 
		var onAdComplete = function(evt) {
            console.log("onAdComplete");
			/* perform whatever ad actions that you want - I am not sure what these would be? */
		}
		
		var onTemplateLoad = function(experienceID){
			console.log("EVENT: onTemplateLoad");
            player = brightcove.api.getExperience(experienceID);
			APIModules = brightcove.api.modules.APIModules;
		};
	 
		var onTemplateReady = function(evt) {
			console.log("EVENT: onTemplateReady");
            // get a reference to the player and API Modules 
            adModule = player.getModule(APIModules.ADVERTISING);
            
            // fetch the current ad policy for the player
            adModule.getAdPolicy(getAdPolicyHandler);

            // set a callback function when the ad starts
			adModule.addEventListener(brightcove.api.events.AdEvent.START, onAdStart);
			// set a callback function when the ad is complete
			adModule.addEventListener(brightcove.api.events.AdEvent.COMPLETE, onAdComplete);
            
		}
    </script>

      
    
	<div style="text-align:center">
    <iframe id="CSAT" src="//learning-services-media.brightcove.com/doc-assets/general/surveylink.html" style=" padding-bottom:20px;border:none"></iframe>
</div>
<div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>
</html>