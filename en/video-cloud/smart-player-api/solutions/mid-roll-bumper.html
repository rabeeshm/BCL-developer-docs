<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <!-- change title to match the h1 heading -->
    <title id="bclPageTitle">Smart Player API Sample: Midroll Bumper</title>
    <link href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" rel="stylesheet" type="text/css" />
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

    <link rel="stylesheet" type="text/css" href="/en/styles/bcls-doc-site.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

    <link href="/en/video-cloud/smart-player-api/samples/css/api-samples.css" rel="stylesheet" type="text/css">
    <style id="pageStyles">
      .BrightcoveExperience {
        margin-top: 20px;
      }
    </style>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2728311-29', 'auto');
  ga('send', 'pageview');

</script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
  </head>
  <body>
  <!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
  <!-- search -->
  <div id="searchModal" class="reveal-modal" data-reveal></div>
  <!-- content -->
    <div class="row">
        <div class="sidebar large-2 columns show-for-large-up">
            <div id="sidenav" class="side-nav"></div>
        </div>
        <div id="main" class="large-10 small-12 columns">

        <div id="top" class="section">
            <p style="background-color:#CC0000;color:#F5F5F5;font-weight:bold;margin-top:80px;padding:4px;">WARNING: The Smart Player had been deprecated and should not be used for new projects. Click <a style="color:#33ffff;" href="https://support.brightcove.com/en/service-changes">here</a> for more information.</p>
<h1>Midroll Bumper</h1>
          <p>This sample plays what looks like a midroll (or postroll) bumper clip. It is not a true bumper, because they are always played preroll. Instead, the "bumpers" here are just other video clips from the media library. Using the buttons above the player, you can choose to play the midroll or postroll bumper, or both.</p>
        </div>
        <!-- every div class section must have an id -->
        <div class="section" id="resources">
          <h2><a name="resources"></a>API resources used</h2>
          <p>This sample uses the following API resources</p>
          <h4>Modules and methods</h4>
          <ul>
            <li>VIDEO_PLAYER
              <ul>
                <li>getCurrentVideo()</li>
                <li>play()</li>
                <li>pause()</li>
                <li>seek()</li>
                <li>addEventListener()</li>
                <li>removeEventListener()</li>
              </ul>
            </li>
          </ul>
          <h4>Events</h4>
          <ul>
            <li>templateLoad</li>
            <li>templateReady</li>
            <li>Media: PROGRESS</li>
          </ul>
        </div>
        <div class="section" id="player">
          <!-- h2 contents will be in page navigation label - 28 characters (including spaces) maximum -->
          <h2><a name="player"></a>The Player</h2>
          <p>A standard Chromeless Video Player is used for this sample.</p>
          <p class="text-warning">Note: In HTML mode, different browsers yield inconsistent functionality.</p>
          <!-- buttons to switch between HTML and Flash Players -->
          <!--<div id="modeSwitch">
            <span class="button" id="switchToHTML5" style="margin-bottom: 20px;margin-right: 10px;">Switch to HTML5 Player</span>
            <span class="button" id="switchToFlash" style="margin-bottom: 20px;">Switch to Flash Player</span>
          </div>-->
          <hr/>
          <div id="bumperControls">
            <span id="midroll" class="button">Play Midroll</span>
            <span id="postroll" class="button">Play Postroll</span>
            <span id="both" class="button">Play Both</span>
          </div>
          <div class="player-block">
            <!-- Start of Brightcove Player -->
            <script language="JavaScript" type="text/javascript" src="//sadmin.brightcove.com/js/BrightcoveExperiences.js"></script>
            <object id="myExperience921449663001" class="BrightcoveExperience">
              <param name="bgcolor" value="#FFFFFF" />
              <param name="width" value="480" />
              <param name="height" value="270" />
              <param name="playerID" value="2079935931001" />
              <param name="playerKey" value="AQ~~,AAAA1oy1bvE~,ALl2ezBj3WE0z3yX6Xw29sdCvkH5GCJv" />
              <param name="isVid" value="true" />
              <param name="isUI" value="true" />
              <param name="dynamicStreaming" value="true" />
              <param name="@videoPlayer" value="928199562001" />
              
              <param name="includeAPI" value="true" />
              <param name="templateLoadHandler" value="BCLS.onTemplateLoad" />
              <param name="templateReadyHandler" value="BCLS.onTemplateReady" />
            </object>
            <script src="//docs.brightcove.com/en/scripts/https-fix.js"></script><script type="text/javascript">brightcove.createExperiences();</script>
            <!-- End of Brightcove Player -->
          </div>
        </div>
        <div class="section" id="logic">
          <h2><a name="logic"></a>How it is done</h2>
          <p>To play a single mid- or postroll bumper is straightforward. You need a reference to the VIDEO_PLAYER module and to set up a listener for media PROGRESS events &mdash; or you could use a cue point for more precise timing keyed to the main video contents. In the progress event handler, you would wait for the appointed time. Remember that you cannot predict the timing of the events precisely, so you need a comparison check. The PROGRESS event objects include position and duration properties in seconds, which you can use to calculate the mid, quarter, or other points. And you need the ID of the bumber video &mdash; for convenience, store in a video metadata field, so that you can retrieve it using the <code>getCurrentVideo()</code> method.</p>
          <p>When the PROGRESS position is greater than the time to play the bumper, pause the main video, save the position as a restart point, and use <code>loadVideoByID()</code> to play the bumper. One important thing: you need to use <code>removeEventListener()</code> to remove the PROGRESS event listener, or you will loop endlessly through the bumper!</p>
          <p>You also need to set another event listener so that you hear the end of the bumper and know when to reload the main video. You could use the media <code>COMPLETE</code> event, but there is a potential problem. By default, Video Cloud players end playback with an menu screen that shows related videos. The player is still there, but in reduced size. By the time the COMPLETE event fires, the menu will be showing, and so the next video you load will play in the smaller-sized screen. To avoid this, use PROGRESS again &mdash; with a different handler &mdash; and stop the bumper about a half-second before the end. This applies to starting a postroll bumper also.</p>
          <p>After the bumper, you need to reload the main video, and use <code>seek()</code> to get back to the restart position. Remember that <code>seek()</code> will fail silently unless the video is playing. There are different ways to determine this (see the <a href="/en/video-cloud/smart-player-api/solutions/chaptered-video.html">chaptered video sample</a> for an alterate way), but one of the most reliable is to set another PROGRESS event listener for the main video and place the seeking logic in it. Remember to remove the PROGRESS listener for the bumper when it finishes, and you must also remove the new PROGRESS listener for the main video as soon as you get an event, so that the seek won't be repeated on every event.</p>
          <p>The above generally describes the logic of this sample. The code is slightly more complex, because we decided to allow the possibility of playing a midroll or postroll bumper, or both. the bumper information is stored in a JSON string in the <code>longDescript</code> field:</p>
<pre><code>
{
  "postroll" : 1844554046001,
  "midroll" : 1844554045001
}
</code></pre>
          <p>A bumperType variable is also set to keep track of what kind of bumper should be played, and some conditional logic in the main PROGRESS handler determines at what point to play the bumper and which one to play.</p>
        </div>
        <div class="section" id="code">
          <h2><a name="code"></a>The code</h2>
          <h3>Modifications to the player publishing code</h3>
<pre><code>
  &lt;!-- smart player api params --&gt;
  &lt;param name="includeAPI" value="true" /&gt;
  &lt;param name="templateLoadHandler" value="BCLS.onTemplateLoad" /&gt;
  &lt;param name="templateReadyHandler" value="BCLS.onTemplateReady" /&gt;
</code></pre>
          <h3>CSS used for this sample:</h3>
<pre><code id="css_code"></code></pre>
          <h3>JavaScript used for this sample:</h3>
<pre><code id="js_code"></code></pre>
        </div>
      </div>
    </div>
    <!-- bcl scripts -->
    <script src="/en/scripts/prefix.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.3/handlebars.min.js"></script>
    
    <script src="/en/scripts/docs-nav-data.min.js"></script>
    <script src="/en/scripts/bcls-doc-site.js"></script>
    <script src="/en/scripts/flashHTMLswitch-nojQ.js"></script>
    <script>
        $(document).foundation();
    </script>
    <script id="pageScript" type="text/javascript">
      /******** Any scripts specific to page samples should go here *********/
      /**** Brightcove Learning namespace ****/
      var BCLS = (function() {
        // vars
        var player,
            APIModules,
            mediaEvent,
            videoPlayer,
            bumpers,
            mainVideo,
            bumperType = "midroll",
            restartPosition,
            $controlButtons = $("#bumperControls").children();
        // private functions
        // public functions
        return {
          /**** template loaded event handler ****/
          onTemplateLoad : function (experienceID) {
            // get a reference to the player and API Modules and Events
            player = brightcove.api.getExperience(experienceID);
            APIModules = brightcove.api.modules.APIModules;
            mediaEvent = brightcove.api.events.MediaEvent;
          },
          /**** template ready event handler ****/
          onTemplateReady : function (evt) {
            // get references to modules
            videoPlayer = player.getModule(APIModules.VIDEO_PLAYER);
          // get current video for bumper info
          videoPlayer.getCurrentVideo( function (videoDTO) {
              // bumper info stored in longDescription as JSON
              bumpers = JSON.parse(videoDTO.longDescription);
              // save the main video ID
              mainVideo = videoDTO.id;
              // add PROGRESS listener for main video
              videoPlayer.addEventListener(mediaEvent.PROGRESS, BCLS.onMainProgress);
            });
            // set click handlers for bumper control buttons
            $controlButtons.on("click", function(evt) {
              bumperType = $(this).attr("id");
            });
          },
          /**** main video PROGRESS handler ****/
          onMainProgress : function (evt) {
            // depends on bumperType
            if (bumperType == "midroll" || bumperType == "both") {
              if ((evt.position / evt.duration) > .5) {
                // remove this listener so we don't loop on the bumper
                videoPlayer.removeEventListener(mediaEvent.PROGRESS, BCLS.onMainProgress);
                // save the position
                restartPosition = evt.position;
                // pause the video
                videoPlayer.pause(true);
                // if bumperType is midroll only, set to none
                if (bumperType == "midroll") {
                  bumperType = "none";
                }
                // add PROGRESS listener for bumper
                videoPlayer.addEventListener(mediaEvent.PROGRESS, BCLS.onBumperProgress);
                // load the bumper
                videoPlayer.loadVideoByID(bumpers.midroll);
              }
            }
            else if (bumperType == "postroll") {
              if ((evt.duration - evt.position) < .5) {
                // pause the main video
                videoPlayer.pause(true);
                // set bumperType to none
                bumperType = "none";
                // remove the listener
                videoPlayer.removeEventListener(mediaEvent.PROGRESS, BCLS.onMainProgress);
                // just play the postroll and we are done
                videoPlayer.loadVideoByID(bumpers.postroll);
              }
            }
          },
         /**** handler for bumper PROGRESS ****/
         onBumperProgress : function (evt) {
            if ((evt.duration - evt.position) < .2) {
              // stop the bumper
              videoPlayer.pause(true);
              // remove this event listener
              videoPlayer.removeEventListener(mediaEvent.PROGRESS, BCLS.onBumperProgress);
              // add listener for BEGIN that will seek back to the restart point
              videoPlayer.addEventListener(mediaEvent.PROGRESS, BCLS.seekToRestartPoint);
              // if bumperType is both, set to postroll and reset PROGRESS listener
              if (bumperType == "both") {
                bumperType = "postroll";
              };
              // resume the main video
              videoPlayer.loadVideoByID(mainVideo);
            };
          },
          /**** function to seek to video restart point ****/
          seekToRestartPoint : function(evt) {
            // remove this listener
            videoPlayer.removeEventListener(mediaEvent.PROGRESS, BCLS.seekToRestartPoint);
            // if postroll scheduled, add mainProgress listener
            if (bumperType == "postroll") {
              videoPlayer.addEventListener(mediaEvent.PROGRESS, BCLS.onMainProgress);
            }
            // seek to restart point
            videoPlayer.seek(restartPosition);
          }
        }
      }());
   </script>
    <script>
      $(document).ready(function(){
        $("#js_code").html(BCLSpreFix($("#pageScript").html()));
        $("#css_code").html(BCLSpreFix($("#pageStyles").html()));
      });
    </script>
      
    
	<div style="text-align:center">
    <iframe id="CSAT" src="//learning-services-media.brightcove.com/doc-assets/general/surveylink.html" style=" padding-bottom:20px;border:none"></iframe>
</div>
<div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>
</html>
