<!DOCTYPE html>
<html lang="en">

<head>

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
	<!-- change title to match the h1 heading -->
	<title>Brightcove Player Sample: Cue Points Display CTA</title>
	<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
	<script src="//use.edgefonts.net/source-code-pro.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/atelier-forest.light.min.css" />
    <link rel="stylesheet" type="text/css" href="/en/styles/bcls-doc-site.css" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2728311-29', 'auto');
  ga('send', 'pageview');

</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
  <link href="//players.brightcove.net/videojs-overlay/lib/videojs-overlay.css" rel='stylesheet'>
  <style>
    .video-js {
      height: 344px;
      width: 610px;
    }
    .hide-overlay .vjs-overlay {
      display: none;
    }
  </style>
</head>

<body>
	<!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
	<!-- search -->
	<div id="searchModal" class="reveal-modal" data-reveal></div>
	<!-- content -->
	<!-- content -->
	<div class="row">
		<div class="sidebar large-2 columns show-for-large-up">
			<div id="sidenav" class="side-nav"></div>
		</div>
		<div id="main" class="large-10 small-12 columns">
			<div id="top" class="section">
				<h1>Brightcove Player Sample: Cue Points Display CTA</h1>
				<!-- Place document intro sentence(s) here -->
				<p>In this sample, cue points are used to trigger calls to action (CTA) to be displayed. The cue points are configured in Studio with the cue point <strong>Metadata</strong> property holding a semicolon delimited list of strings that contain information for the CTA. For this sample, the duration of the CTA, text for the CTA and the link for the CTA are stored in the metadata field of the cue point, as shown here:</p>
        <div><img src="../samples/assets/cue-point-cta/create-cue-point-studio.png" alt="create cue point Studio"></div>
			</div>

			<div id="developmentsequence" class="section">
        <h2 id="expanderHead">Development sequence</h2>
        <div id="expanderContent" style="display:none">
          <p>Here is the recommended development sequence:</p>
          <ol>
            <li>Use the in-page embed player implementation to test the functionality of your player, plugin and CSS (if CSS is needed)</li>
            <li>Put the plugin's JavaScript and CSS into separate files for local testing</li>
            <li>Deploy the plugin code and CSS to your server once you have worked out any errors</li>
            <li>Use the new Video Cloud Studio to add the plugin and CSS to your player</li>
            <li>Replace the in-page embed player implementation if you determine that the iframe implementation is a better fit (detailed in next section)</li>
          </ol>
          <p>For details about these steps, review the <a href="//docs.brightcove.com/en/video-cloud/brightcove-player/guides/plugin-dev-quick-start.html">Quick Start to Plugin Development</a> guide.</p>
          <h3>iframe or in-page embed</h3>
          <p>When developing enhancements for the Brightcove player you will need to decide if the code is a best fit for the iframe or in-page embed implementation. The best practice recommendation is to build a plugin for use with an iframe implementation. The advantages of using the iframe player are:</p>
          <ul>
            <li>No collisions with existing JavaScript and/or CSS</li>
            <li>Automatically responsive</li>
            <li>The iframe eases use in social media apps (or whenever the video will need to "travel" into other apps)</li>
          </ul>
          <p>Although integrating the in-page embed player can be more complex, there are times when you will plan your code around that implementation. To generalize, this approach is best when the containing page needs to communicate to the player. Specifically, here are some examples:</p>
          <ul>
            <li>Code in the containing page needs to listen for and act on player events</li>
            <li>The player uses styles from the containing page</li>
            <li>The iframe will cause application logic to fail, like a redirect from the containing page</li>
          </ul>
          <p>Even if your final implementation does not use the iframe player, you can still use the in-page embed player with a plugin that contains your JavaScript and CSS. This encapsulates your logic so that you can easily use it in multiple players.</p>
			  </div><!-- id="expanderContent" -->
      </div>

      <div id="selectimplementation" class="section">
				<h2>Select implementation</h2>
				<p>In this sample, both the in-page embed and iframe player implementations will work, so both are shown.</p>
			</div>

			<div id="resources" class="section">
				<h2>API resources used</h2>
				<p>The following sections detail resources used from various APIs.</p>
				<h3>Brightcove Player API</h3>
        <ul>
          <li><code>addClass()</code> method</li>
          <li><code>mediainfo</code> property</li>
          <li><code>muted()</code> method</li>
          <li><code>on()</code> method</li>
          <li><code>play()</code> method</li>
          <li><code>removeClass()</code> method</li>
          <li><code>textTracks()</code> method</li>
				</ul>
				<h3>Plugins</h3>
        <ul>
				  <li>Overlay</li>
				</ul>
        <p>The code also uses JavaScript's <code>setTimeout()</code> and <code>removeTimeout()</code> methods. These methods call a function after a specified delay and then remove the timeout.</p>
			</div>

			<div id="player" class="section">
        <h3>The player</h3>
				<p>The player below shows two different CTAs displayed based on cue points. The first CTA is displayed at 3 seconds, for a duratin of 5 seconds. The second CTA is displayed at 13 seconds for a duration of 3 seconds.</p>
        <video id="myPlayerID"
          data-video-id="4784521906001"
          data-account="1752604059001"
          data-player="NkPHaVb2l"
          data-embed="default"
          class="video-js"
          controls></video>
			</div>

			<div id="code" class="section">
				<h2>How it works</h2>
				<p>The following sections explain the player, JavaScript and CSS code used in the example. The key to the code is manipulation the cue points. Two cue points are added to the video used, and are available the the player's <code>mediainfo</code> property. The screenshot below shows the cue points array as displayed in a browser's Console.</p>
        <div><img src="../samples/assets/cue-point-cta/cue-point-ara-console.png" alt="create cue point Studio"></div>
        <h3>Create the player</h3>
        <div class="video-cloud-only">
          <p>To create a player and assign a video to it, follow these steps:</p>
            <ol>
              <li>Using Video Cloud Studio, in the <strong>Players</strong> module, create a new player or use an existing one.</li>
              <li>In the <strong>Media</strong> module, select a video and publish it with this player.</li>
              <li>Create cue points using the <strong>metatdata</strong> property to store the CTA information, as shown in the introductory paragraph of this document.</li>
              <li>Copy the In-Page embed code and paste it into a new HTML file.</li>
            </ol>
        </div>
				<h3>The player code</h3>
          <p>Your player code, with an <code>id</code> added, should look similar to the following:</p>
          <p><code data-gist-id="4e511c0cf99360c1b2f1" data-gist-hide-footer="true" data-gist-line="20-26" data-gist-highlight-line="20"></code></p>
        <h3>The HTML code</h3>
        <p>No HTML code needs to be added to the page.</p>
        <h3>The stylesheet</h3>
				<p>Add the following styles to your page code:</p>
        <ul>
          <li>Lines 8-11: Size the player.</li>
          <li>Lines 12-14: Create a class to hide the overlay.</li>
          <li>Line 16: Add the Overlay Plugin's CSS file. Note that this could also be added to the player by using Studio's <strong>PLUGINS</strong> section.</li>
        </ul>
        <p><code data-gist-id="4e511c0cf99360c1b2f1" data-gist-hide-footer="true" data-gist-line="7-17,"></code></p>
				<h3>The JavaScript code</h3>
				<p>Add the following JavaScript to your page code:</p>
        <ul>
          <li>Line 28: Add the players JavaScript configuration file.</li>
          <li>Line 29: Add the Overlay Plugin's JavaScript file. Note that this could also be added to the player by using Studio's <strong>PLUGINS</strong> section.</li>
          <li>Lines 31-33: Create variables needed across all JavaScript functions.</li>
          <li>Lines 34-36: Wait for player ready, then create variables local to the anonymous function.</li>
          <li>Line 37: Assign the player object to the variable created for that purpoose.</li>
          <li>Lines 38-45: Call the Overlay plugin's method, configure an overlay, start it on <code>play</code>, then hide using the <code>hide-overlay</code> class.</li>
          <li>Lines 47-54: Using the cue point information from the <code>mediainfo</code> property, set up listeners for the cue points. When an <code>oncuechange</code> event is dispatched, note that the <code>displayCTA()</code> method is called.</li>
          <li>Lines 55-56: Play and mute the video on <code>loadstart</code>.</li>
          <li>Lines 59, 70: Define the function called to display a CTA.</li>
          <li>Line 60: Split the cue point <code>metadata</code> property, which is a semicolon delimited list, into an array of items.</li>
          <li>Lines 61-65: Define variables for the different pieces of data extracted from the metadata, and then dynamically build an HTML anchor tag.</li>
          <li>Line 66: Set the timeout value for use in the <code>setTimeout()</code> method. Since that method uses milliseconds, multiply by 1000 to get property value.</li>
          <li>Line 67: Use the <code>setTimeout()</code> method to designate thte function to be called on timeout, and also how long before timeout occurs. Those values are passed as arguments.</li>
          <li>Line 68: Inject the dynamically built anchor tag into the overlay.</li>
          <li>Line 69: Unhide the overlay by removing the <code>hide-overlay</code> class.</li>
          <li>Lines 72, 75: Define the function called when the timeout is reached.</li>
          <li>Line 73: Clear the timeout, otherwise JavaScript will continue to watch this even though no longer needed.</li>
          <li>Line 74: Hide the overlay.</li>
          <li>Lines 77-88: Define the helper function that extracts proper data from the cue points.</li>
        </ul>
        <p><code data-gist-id="4e511c0cf99360c1b2f1" data-gist-hide-footer="true" data-gist-line="28-90"></code></p>
        <p class="BCL-aside">Note: For complete details on cue point management and manipulate see the <a href="http://docs.brightcove.com/en/video-cloud/brightcove-player/guides/cue-points-guide.html">Using Cue Points</a> document.</p>
        <p>The full page code appears as follows:</p>
        <p><code data-gist-id="4e511c0cf99360c1b2f1" data-gist-hide-footer="true" data-gist-line="1-93"></code></p>
			</div>

			<div id="plugin" class="section">
				<h2>Use a plugin</h2>
				<p>It is a best practice to use a plugin so that you can easily add the JavaScript code's functionality to multiple players.</p>
				<h3>Create the JavaScript file</h3>
				<p>Move the plugin's JavaScript code into a file and place it in an Internet accessible URL.</p>
				<ul>
				    <li>Lines 100, 160: Use the standard syntax to begin and end a Brightcove Player plugin.</li>
				    <li>Line 100: The first argument of the function call is the name of the function defined in the plugin code, in this case <code>cuePointCTA</code>.</li>
				    <li>Line 160: The trailing semicolon is required.</li>
            <li>Note the the use of <code>ready()</code> is no longer needed, otherwise the JavaScript is the same.</li>
				</ul>
        <p><code data-gist-id="4e511c0cf99360c1b2f1" data-gist-hide-footer="true" data-gist-line="100-160"></code></p>
				<h3>Create the CSS file</h3>
				<p>If you are using CSS, move styles into a file and place it in an Internet accessible URL.</p>
				<h3>Deploy plugin and CSS</h3>
        <p>To deploy the cuePointCTA Plugin using the Players module, follow these steps:</p>
        <ol>
          <li>In Studio, open the <strong>Players</strong> module and locate the player.</li>
          <li>Click the link for the player to open the player properties.</li>
          <li>Locate the <strong>Plugins</strong> section and click <strong>Edit</strong>.</li>
          <li>For the first <strong>JavaScript URL</strong>, enter the URL which specifies the location of the Overlay Plugin's JavaScript.
          <pre><code>//players.brightcove.net/videojs-overlay/1/videojs-overlay.min.js</code></pre>
          </li>
          <li>For the second <strong>JavaScript URL</strong>, enter the URL which specifies the location of where you saved your plugin's JavaScript.</li>
          <li>For the first <strong>CSS URL</strong>, enter the URL which specifies the location of the Overlay Plugin's CSS.
          <pre><code>//players.brightcove.net/videojs-overlay/1/videojs-overlay.css</code></pre>
          </li>
          <li>For the second <strong>CSS URL</strong>, enter the URL which specifies the location of where you saved your plugin's CSS.</li>
          <li>For the <strong>Name</strong>, enter <strong>cuePointCTA</strong>.</li>
          <li>Enter the plugin options, which in this case are none, so just enter <strong>{}</strong>.</li>
          <li>Click <strong>Save</strong> and then <strong>Publish</strong> the player.</li>
          <li>Go to the <strong>MEDIA</strong> module and publish a video using the newly altered player.</li>
        </ol>
			</div>

      <div id="useiframe" class="section">
        <h2>Use iframe</h2>
        <p>It is a best practice to use the iframe player implementation. Since you can create this functionality as a plugin, replace the in-page embed implementation with the iframe implementation.</p>
      </div>

			<div class="section" id="BCLreferences">
				<h2>Related Topics</h2>
				<ul>
					<li> <a href="http://docs.brightcove.com/en/video-cloud/brightcove-player/guides/cue-points-guide.html">Using Cue Points</a></li>
					<li> <a href="http://docs.brightcove.com/en/video-cloud/brightcove-player/guides/plugin-dev-quick-start.html">Quick Start to Plugin Development</a></li>
					<li> <a href="http://docs.brightcove.com/en/video-cloud/brightcove-player/guides/plugin-guide.html">Player Plugin Overview</a></li>
				</ul>
			</div>
		</div>
	</div>
	<!-- bcl scripts -->
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/2.2/gist-embed.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.3/handlebars.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
	<script src="/en/scripts/log.js"></script>
	<script src="/en/scripts/docs-nav-data.min.js"></script>
	<script src="/en/scripts/bcls-doc-site-v1.js"></script>
	<script src="/en/scripts/bc-mapi.js"></script>
  <script src="/en/scripts/expander.js"></script>
  <script src="//players.brightcove.net/1752604059001/NkPHaVb2l_default/index.min.js"></script>
  <script src="//players.brightcove.net/videojs-overlay/lib/videojs-overlay.js"></script>
	<script>
		$(document).foundation();
	</script>
	<script type="text/javascript">
		/******** Any scripts specific to page samples should go here *********/
    var myPlayer,
      timeoutID,
      removeCTATime;

    videojs("myPlayerID").ready(function(){
      var cuePointAra=[],
        allCuePointData;
      myPlayer = this;
      myPlayer.overlay({
        overlays: [{
          content: '<h3>this is the overlay</h3>',
          align: 'top',
          start: 'play'
        }]
      });
      myPlayer.addClass("hide-overlay");
      myPlayer.on('loadstart', function(evt) {
        cuePointAra = myPlayer.mediainfo.cue_points;
        var tt = myPlayer.textTracks()[0];
        tt.oncuechange = function() {
          if(tt.activeCues[0] !== undefined){
            allCuePointData = getSubArray(cuePointAra,'time',tt.activeCues[0].startTime);
            displayCTA(allCuePointData[0]);
          }
        }
        myPlayer.muted(true);
      });

      function displayCTA(cpData){
        var dataAra = cpData.metadata.split(';'),
          durationCTA =  dataAra[0],
          textCTA = dataAra[1],
          urlCTA = dataAra[2],
          hrefCTA = '<a href="' + urlCTA + '"><span style="background-color: #999999">' + textCTA + '</span></a>',
          timeoutValue;
        timeoutValue = Number(durationCTA) * 1000;
        timeoutID = window.setTimeout(checkTime, timeoutValue);
        document.getElementsByClassName("vjs-overlay")[0].innerHTML = hrefCTA;
        myPlayer.removeClass("hide-overlay");
      }

      function checkTime(){
          window.clearTimeout(timeoutID);
          myPlayer.addClass("hide-overlay");
      }

      function getSubArray(targetArray, objProperty, value) {
        var i, totalItems = targetArray.length,
          objFound = false,
          idxArr = [];
        for (i = 0; i < totalItems; i++) {
          if (targetArray[i][objProperty] === value) {
            objFound = true;
            idxArr.push(targetArray[i]);
          }
        }
        return idxArr;
      };
    });
	</script>
	
    
<iframe id="CSAT" src="http://survey.clicktools.com/app/survey/go.jsp?iv=3poon3e7e9spn&q1=[articleURL]" style="margin-left:25%; padding-bottom:20px;width:550px;height:475px;border:none"></iframe>
<script>
    
    var cSat = document.getElementById('CSAT'),
        cSatSrc = cSat.getAttribute('src'),
        pageurl = window.location.href;
    cSat.setAttribute('src', cSatSrc.replace('[articleURL]', pageurl));
    
</script>
<br><br>
<div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>

</html>
