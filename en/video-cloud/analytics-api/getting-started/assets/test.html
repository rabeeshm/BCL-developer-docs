<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title></title>
        <style>
        body {
        margin: 1em 2em;
        font-family: sans-serif;
        }
        h2 {
        font-size: 1.1em;
        }
        button {
        padding: .5em;
        }
        pre {
        background-color: #F1EFEE;
        border-left: .5em solid #636363;
        box-shadow: 5px 5px 10px rgba(192, 192, 192, 1.000);
        font-family: Hack, monospace;
        font-size: .8em;
        padding: 1em;
        }
        .buttonBlock {
        display: inline-block;
        padding: 0 .5em;
        }
        div:nth-of-type(2) {
        border-right: 1px solid #CCC;
        border-left: 1px solid #CCC;
        }
        #apiData {
        height: 170px;
        }
        </style>
    </head>
    <body>
        <h1>Analytics API Tester</h1>
        <p>Note that you must first create a video object, so other operations are disabled until you do that.</p>
        <div class="buttonBlock">
            <p><strong>Dimension Reports</strong></p>
            <p>
                <button id="account">Account</button>
                <button id="video">Video</button>
                <button id="player">Player</button>
                <button id="date">Date</button>
                <button id="destination_path">Destination Path</button>
                <button id="country">Country</button>
                <button id="source_type">Source Type</button>
                <button id="device_os">Device OS</button>
                <button id="videoCountry">Video and Country</button>
            </p>
        </div>
        <div class="buttonBlock">
            <p><strong>Parameters</strong></p>
            <p>
                <button id="multipleAccounts">Multiple Accounts</button>
                <button id="limitOffset">Limit and Offset</button>
                <button id="sort">Sort</button>
                <button id="dateRange">Date Range</button>
                <button id="oneDay">One Day</button>
                <button id="fields">Fields</button>
                <button id="whereDevice">Device Filter</button>
                <button id="whereTags">Filter by Tag</button>
                <button id="formatCSV">CSV Response</button>
            </p>
        </div>
        <div class="buttonBlock">
            <p><strong>Engagement Reports</strong></p>
            <p>
                <button id="accountEngagement">Account</button>
                <button id="videoEngagement">Video</button>
                <button id="playerEngagement">Player</button>
            </p>
        </div>
        <p><strong>API request:</strong></p>
    <pre id="apiRequest"></pre>
<p><strong>Request method:</strong></p>
<pre id="apiMethod"></pre>
<p><strong>Response data</strong></p>
<pre id="responseData"></pre>
<script>
var BCLS = (function (window, document) {
    var reportURL = 'https://analytics.api.brightcove.com/v1/data',
        engagementURL = 'https://analytics.api.brightcove.com/v1/engagement/accounts/20318290001',
        proxyURL = 'https://solutions.brightcove.com/bcls/bcls-proxy/training-videos-proxy.php',
        video_id = '4562259880001',
        player_id = '901fa759-2353-412c-83ff-e8be6011e9f2',
        allButtons = document.getElementsByTagName('button'),
        account = document.getElementById('account'),
        video = document.getElementById('video'),
        player = document.getElementById('player'),
        date = document.getElementById('date'),
        country = document.getElementById('country'),
        destination_path = document.getElementById('destination_path'),
        source_type = document.getElementById('source_type');
        device_os = document.getElementById('device_os');
        videoCountry = document.getElementById('videoCountry');
        multipleAccounts = document.getElementById('multipleAccounts');
        limitOffset = document.getElementById('limitOffset');
        sort = document.getElementById('sort');
        dateRange = document.getElementById('dateRange');
        oneDay = document.getElementById('oneDay');
        fields = document.getElementById('fields');
        whereDevice = document.getElementById('whereDevice');
        whereTags = document.getElementById('whereTags');
        formatCSV = document.getElementById('formatCSV');
        accountEngagement = document.getElementById('accountEngagement');
        videoEngagement = document.getElementById('videoEngagement');
        playerEngagement = document.getElementById('playerEngagement');
    /**
     * disables all buttons so user can't submit new request until current one finishes
     */
    function disableButtons() {
        var i,
            iMax = allButtons.length;
        for (i = 0; i < iMax; i++) {
            allButtons[i].setAttribute('disabled', 'disabled');
        }
    }
    /**
     * re-enables all buttons
     */
    function enableButtons() {
        var i,
            iMax = allButtons.length;
        for (i = 0; i < iMax; i++) {
            allButtons[i].removeAttribute('disabled');
        }
    }
    /**
     * sets up the data for the API request
     * @param {String} id the id of the button that was clicked
     */
    function setRequestData(id) {
        var endPoint = '',
            requestData = {};
        // disable buttons to prevent a new request before current one finishes
        disableButtons();
        switch (id) {
        case 'account':
            endPoint = '?accounts=20318290001&dimensions=account';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'video':
            endPoint = '?accounts=20318290001&dimensions=video';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'player':
            endPoint = '?accounts=20318290001&dimensions=player';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'date':
            endPoint = '?accounts=20318290001&dimensions=date';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'destination_path':
            endPoint = '?accounts=20318290001&dimensions=destination_path';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'country':
            endPoint = '?accounts=20318290001&dimensions=country';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'source_type':
            endPoint = '?accounts=20318290001&dimensions=source_type';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'device_os':
            endPoint = '?accounts=20318290001&dimensions=device_os';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'videoCountry':
            endPoint = '?accounts=20318290001&dimensions=video,country';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'multipleAccounts':
            endPoint = '?accounts=20318290001,57838016001&dimensions=video';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'limitOffset':
            endPoint = '?accounts=20318290001&dimensions=video&limit=5&offset=5';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'sort':
            endPoint = '?accounts=20318290001&dimensions=video,country&sort=country_name';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'dateRange':
            endPoint = '?accounts=20318290001&dimensions=video&from=alltime&to=now';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'oneDay':
            endPoint = '?accounts=20318290001&dimensions=video&from=2015-03-25&to=2015-03-25';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'fields':
            endPoint = '?accounts=20318290001&dimensions=video&fields=video,video_duration,video_engagement_1,video_engagement_100,video_engagement_25,video_engagement_50,video_engagement_75,video_impression,video.name,video_percent_viewed,video_seconds_viewed';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'whereDevice':
            endPoint = '?accounts=20318290001&dimensions=video&where=device_type==tablet';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'whereTags':
            endPoint = '?accounts=20318290001&dimensions=video&where=video.q==tags:drupal';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'formatCSV':
            endPoint = '?accounts=20318290001&dimensions=video,country&sort=country_name&format=csv';
            requestData.url = reportURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'accountEngagement':
            endPoint = '';
            requestData.url = engagementURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'videoEngagement':
            endPoint = '/videos/video_id';
            requestData.url = engagementURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        case 'playerEngagement':
            endPoint = '/players/player_id';
            requestData.url = engagementURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            apiMethod.textContent = requestData.requestType;
            getMediaData(requestData, id);
            break;
        }
    }
    /**
     * send API request to the proxy
     * @param  {Object} requestData options for the request
     * @param  {String} requestID the type of request = id of the button
     */
    function getMediaData(options, requestID) {
        var httpRequest = new XMLHttpRequest(),
            responseRaw,
            parsedData,
            requestParams,
            dataString,
            // response handler
            getResponse = function () {
                try {
                    if (httpRequest.readyState === 4) {
                        if (httpRequest.status === 200) {
                            if (requestID === 'formatCSV') {
                                responseData.textContent = httpRequest.responseText;
                            } else {
                                console.log(httpRequest.responseText);
                                responseRaw = httpRequest.responseText;
                                responseData.textContent = responseRaw;
                                parsedData = JSON.parse(responseRaw);
                                responseData.textContent = JSON.stringify(parsedData, null, '  ');
                            }

                            // re-enable the buttons
                            enableButtons();
                        } else {
                            alert('There was a problem with the request. Request returned ' + httpRequest.status);
                        }
                    }
                } catch (e) {
                    alert('Caught Exception: ' + e);
                }
            };
        // set up request data
        requestParams = 'url=' + encodeURIComponent(options.url) + '&requestType=' + options.requestType;
        if (options.requestBody) {
            dataString = JSON.stringify(options.requestBody);
            requestParams += '&requestBody=' + encodeURIComponent(dataString);
        }
        console.log(requestParams);
        // set response handler
        httpRequest.onreadystatechange = getResponse;
        // open the request
        httpRequest.open('POST', proxyURL);
        // set headers
        httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        // open and send request
        httpRequest.send(requestParams);
    }
    // event listeners
    video.addEventListener('click', function () {
        setRequestData('video');
    });
    player.addEventListener('click', function () {
        setRequestData('player');
    });
    country.addEventListener('click', function () {
        setRequestData('country');
    });
    date.addEventListener('click', function () {
        setRequestData('date');
    });
    destination_path.addEventListener('click', function () {
        setRequestData('destination_path');
    });
    device_os.addEventListener('click', function () {
        setRequestData('device_os');
    });
    source_type.addEventListener('click', function () {
        setRequestData('source_type');
    });
    account.addEventListener('click', function () {
        setRequestData('account');
    });
    videoCountry.addEventListener('click', function () {
        setRequestData('videoCountry');
    });
    multipleAccounts.addEventListener('click', function () {
        setRequestData('multipleAccounts');
    });
    limitOffset.addEventListener('click', function () {
        setRequestData('limitOffset');
    });
    sort.addEventListener('click', function () {
        setRequestData('sort');
    });
    fields.addEventListener('click', function () {
        setRequestData('fields');
    });
    dateRange.addEventListener('click', function () {
        setRequestData('dateRange');
    });
    oneDay.addEventListener('click', function () {
        setRequestData('oneDay');
    });
    whereDevice.addEventListener('click', function () {
        setRequestData('whereDevice');
    });
    whereTags.addEventListener('click', function () {
        setRequestData('whereTags');
    });
    formatCSV.addEventListener('click', function () {
        setRequestData('formatCSV');
    });
    accountEngagement.addEventListener('click', function () {
        setRequestData('accountEngagement');
    });
    videoEngagement.addEventListener('click', function () {
        setRequestData('videoEngagement');
    });
    playerEngagement.addEventListener('click', function () {
        setRequestData('playerEngagement');
    });
})(window, document);
</script>
<iframe id="CSAT" src="http://survey.clicktools.com/app/survey/go.jsp?iv=3poon3e7e9spn&q1=[articleURL]" style="margin-left:25%; padding-bottom:20px;width:550px;height:475px;border:none"></iframe>
<script>
    
    var cSat = document.getElementById('CSAT'),
        cSatSrc = cSat.getAttribute('src'),
        pageurl = window.location.href;
    cSat.setAttribute('src', cSatSrc.replace('[articleURL]', pageurl));
    
</script>
<br><br>
<div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>
</html>