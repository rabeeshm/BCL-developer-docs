<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <!-- change title to match the h1 heading -->
    <title>Get Status of Dynamic Ingest Requests</title>
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/atelier-forest.light.min.css" />
    <link rel="stylesheet" type="text/css" href="/en/styles/bcls-doc-site.css" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
    <script>
        (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-2728311-29', 'auto');
        ga('send', 'pageview');
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
</head>

<body>
    <!-- header navbar -->
    <div id="navWrapper" class="fixed"></div>
    <!-- breadcrumbs -->
    <nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
    <!-- search -->
    <div id="searchModal" class="reveal-modal" data-reveal></div>
    <!-- content -->
    <!-- content -->
    <div class="row">
        <div class="sidebar large-2 columns show-for-large-up">
            <div id="sidenav" class="side-nav"></div>
        </div>
        <div id="main" class="large-10 small-12 columns">
            <div id="top" class="section">
                <h1>Get Status of Dynamic Ingest Requests</h1>
                <p>When you use the Dynamic Ingest API to add videos to your Video Cloud account, what you most want to know is when the video has been processed and whether or not renditions were successfully created. This document explains how you can
                    do that using Dynamic Ingest API <a href="./notifications.html">notifications</a> and the <a href="../../cms-api/getting-started/overview-cms.html">CMS API</a>. We also provide a sample dashboard app that automates the process.</p>
            </div>
            <div class="section" id="dataSources">
                <h2>Getting the data</h2>
                <p>There are two sources of data you need to determine when an ingestion job is complete and whether or not it succeeded. This diagram summarizes the workflow:</p>
                <p><img src="./assets/ingestion-status-architecture.png" alt="status date workflow"></p>
                <dl>
                    <dt>Dynamic Ingest Notification Service</dt>
                    <dd>
                        <p>The Dynamic Ingest notification service sends you notifications for several kinds of events. The one that is useful in this context is a notification sent when processing of a video is complete. The notification looks like this:</p>
                        <pre><code>{
    "entity": "4375977109001",
    "entityType": "TITLE",
    "status": "SUCCESS",
    "version": "1",
    "action": "CREATE"
}</code></pre>
                        <p>A notification of this type, where:</p>
                        <ul>
                            <li><code>entityType</code> is <code>TITLE</code></li>
                            <li><code>status</code> is <code>SUCCESS</code></li>
                            <li><code>action</code> is <code>CREATE</code></li>
                        </ul>
                        <p>means that all processing is complete for the video.</p>
                        <p>To receive notifications, you need to include a "callbacks" field in you Dynamic Ingest API requests, pointing to one or more callback addresses:</p>
                        <pre><code>{
    "master": {
        "url": "https://s3.amazonaws.com/bucket/mysourcevideo.mp4"
    }, "profile": "high-resolution",
    <strong>"callbacks": ["http://host1/path1”, “http://host2/path2”]</strong> }</code></pre>
                    </dd>
                    <dt>CMS API</dt>
                    <dd>
                        <p>The CMS API is used to retrieve video metadata, including an array of video sources. The request looks like this:</p>
                        <pre><code>https://cms.api.brightcove.com/v1/accounts/{account_id}/videos/{video_id}/<strong>sources</strong></code></pre>
                        <p>The response will be an array of objects. Depending on how your account is configured, these may not correspond 1:1 with renditions created - for example, if your account is set up to provide streaming over SSL connections, there
                            will be 2 sources for each HLS rendition (1 secure, 1 unsecured). What's important, however, is that as long as the sources array is not empty, the video has some renditions, and the ingest was successuful. If there are no
                            sources, then something went wrong - the most common issues are:</p>
                        <ul>
                            <li>the source video file was invalid</li>
                            <li>the S3 URL was unreacheable</li>
                            <li>a transcode error was encountered</li>
                        </ul>
                    </dd>
                </dl>
            </div>
            <div class="section" id="sample">
                <h2>Sample</h2>
                <h3>An Example to create a dashboard of Dynamic Ingestion jobs</h3>
                <p>This section explains how notications and the CMS API call can be put together to build a simple dashboard for the Dynamic Ingest API. The handler for notifications parses notifications from the Dynamic Ingest API to identify processing
                    complete notifications. It then adds the video id into an array in a JavaScript file. The dashboard itself is an HTML page that includes the array of processed video ids. It uses the ids to makes 2 requests to the <a href="../../cms-api/getting-started/quick-start-cms.html">CMS API</a>                    to get the video metadata and the array of sources (renditions). Whether renditions exist or not shows whether the ingest succeeded or failed. You can view the dashboard <a href="//solutions.brightcove.com/bcls/di-api/di-log.html">here</a>.</p>
                <p>All the files for this app, along with instructions for setting it up for your account, are in <a href="https://github.com/BrightcoveLearning/dynamic-ingest-dashboard">this repository</a>.</p>
                <p>
                    Here is the high-level architecture of the app:
                </p>
                <p><img src="./assets/ingestion-dashboard-architecture.png" alt="ingest-dashboard-architecture"></p>
                <h3>The app parts</h3>
                <p>The handler for notifications is built in PHP - it looks for processing complete notifications and adds the video id to an array in a separate JavaScript file:</p>
                <h4>Notification handler</h4>
                <p>
                    <script src="https://gist.github.com/846bf4f1b8d52b442121.js"></script>
                </p>
                <h4>JavaScript file:</h4>
                <p>
                    <script src="https://gist.github.com/c4b36c1f826762be75f9.js"></script>
                </p>
                <h4>Dashboard</h4>
                <p>The dashboard include the JavaScript file, and uses additional JavaScript to fetch data from the CMS API and write the results into a table:</p>
                <p>
                    <script src="https://gist.github.com/5f93d0f1fae7c4666867.js"></script>
                </p>
                <h4>Proxy</h4>
                <p>The proxy, also built in PHP, takes the CMS API requests from the dashboard, gets an access token, and makes the API request, returning the data to the dashboard. The proxy is needed because client-side calls to the CMS-API are not allowed,
                    as this would require exposing your client credentials:</p>
                <p>
                    <script src="https://gist.github.com/b0d5f05a328840851ce5.js"></script>
                </p>
                <h4>Clear the log</h4>
                <p>This simple PHP app just restores the JavaScript file to its original state, clearing out the old video ids:</p>
                <p>
                    <script src="https://gist.github.com/d013a4d44236054a2201.js"></script>
                </p>
            </div>
            <div class="section" id="relatedTopics">
                <h2>Related topics</h2>
                <ul>
                    <li><a href="./notifications.html">Notifications</a></li>
                    <li><a href="../../di-api/getting-started/overview-di.html">Dyanamic Ingest API</a></li>
                    <li><a href="../../cms-api/getting-started/overview-cms.html">CMS API</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- bcl scripts -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/2.2/gist-embed.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.3/handlebars.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
    <script src="/en/scripts/log.js"></script>
    <script src="/en/scripts/docs-nav-data.min.js"></script>
    <script src="/en/scripts/bcls-doc-site-v1.js"></script>
    <script src="/en/scripts/bc-mapi.js"></script>
    <script>
        $(document).foundation();
    </script>
    <script type="text/javascript">
        /******** Any scripts specific to page samples should go here *********/
    </script>


    <iframe id="CSAT" src="http://survey.clicktools.com/app/survey/go.jsp?iv=3poon3e7e9spn&q1=[articleURL]" style="margin-left:25%; padding-bottom:20px;width:550px;height:475px;border:none"></iframe>
    <script>
        var cSat = document.getElementById('CSAT'),
            cSatSrc = cSat.getAttribute('src'),
            pageurl = window.location.href;
        cSat.setAttribute('src', cSatSrc.replace('[articleURL]', pageurl));
    </script>
    <br>
    <br>
    <div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
    <script>
        var feedbackMail = document.getElementById("feedbackMail");
        feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
    </script>
</body>

</html>