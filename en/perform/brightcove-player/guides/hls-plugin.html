
<!DOCTYPE html>
<html lang="en">

<head>


    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <title id="bclPageTitle">HLS Plugin Guide</title>
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

    <link rel="stylesheet" type="text/css" href="/en/styles/bcls-doc-site.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/atelier-forest.light.min.css" />
    <link rel="stylesheet" type="text/css" href="/en/styles/anytime.5.0.0-1401232312.min.css" />
    <script type="text/javascript">
        <!--//--><![CDATA[//><!--
        var _gaq = _gaq || [];
        _gaq.push(
            ["_setAccount", "UA-2728311-23"], ["_setDomainName", ".brightcove.com"], ["_trackPageview"]);
        (function () {
            var ga = document.createElement("script");
            ga.type = "text/javascript";
            ga.async = true;
            ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(ga, s);
        })();
         //--><!]]>
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
</head>

<body>
    <!-- header navbar -->
    <div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
    <!-- search -->
    <div id="searchModal" class="reveal-modal" data-reveal></div>
    <!-- content -->
    <div class="row">
        <div class="sidebar large-2 columns show-for-large-up">
            <div id="sidenav" class="side-nav"></div>
        </div>
        <div id="main" class="large-10 small-12 columns">
            <div id="top" class="section">
                <h1 id="bclPageHeading">HLS Plugin Guide</h1>
                <!-- content starts here -->
                <p class="BCL-objective">The HLS plugin is a Brightcove player plugin that relies on W3C's Media Source Extensions (MSE) to play HLS video on platforms that do not natively support it. The HLS plugin is automatically included in the player.</p>
                <p class="BCL-aside">Note: Wikipedia defines MSE as a W3C specification that allows JavaScript to send byte streams to media codecs within web browsers that support HTML5 video. Among other possible uses, this allows the implementation of client-side prefetching and buffering code for streaming media entirely in JavaScript.</p>
                <p>With the plugin you can then use HLS (m3u8) video content in the player. For instance you could create a player using this configuration for the media section:</p>
                <pre><code>"media":{
    "sources": [{
        "src": "http://example.com/video.m3u8",
        "type": "application/x-mpegURL"
    }]
}</code></pre>
                <p>Flash will be used as a fallback to play HLS only on older browsers (mostly IE10 and IE11 on Windows 7).
                <p class="BCL-aside">Cross-origin resource sharing (CORS) can be an issue when using HLS. For more information about using CORS, see the <a href="../../concepts/cors/cors.html">CORS guide</a>.</p>
            </div>
            <div id="overview" class="section">
                <h2>Overview</h2>
                    <p><a href="https://developer.apple.com/streaming/">HTTP Live Streaming</a> (HLS) has become a de-facto standard for streaming video on mobile devices thanks to its native support on iOS and Android. There are a number of reasons independent of platform to recommend the format, though:</p>
                    <ul>
                        <li>Supports (client-driven) adaptive bitrate selection</li>
                        <li>Delivered over standard HTTP ports</li>
                        <li>Simple, text-based manifest format</li>
                        <li>No proprietary streaming servers required</li>
                    </ul>
                    <p>Unfortunately, all the major desktop browsers except for Safari are missing HLS support. That leaves web developers in the unfortunate position of having to maintain alternate renditions of the same video and potentially having to forego HTML-based video entirely to provide the best desktop viewing experience.</p>
                    <p>This plugin addresses the situation by providing a polyfill for HLS on browsers that have Media Source Extensions or Flash support. You can deploy a single HLS stream, code against the regular HTML5 video APIs, and create a fast, high-quality video experience across all the big web device categories.</p>
                    <p>Currently, at this time there is <em>no</em> support for:</p>
                    <ul>
                        <li>Alternate audio and video tracks</li>
<!--                        <li>Subtitles</li>-->
                        <li>Segment codecs <em>other than</em> H.264 with AAC audio</li>
<!--                        <li>Live streams</li>-->
                        <li>Internet Explorer &lt; 10</li>
                    </ul>
                    <p class="BCL-aside">Note: For maximum compatibility with all MSE implementations, Brightcove recommends setting <strong>audio_bitrate</strong> to no less than <strong>48</strong> in your ingest profiles.</p>
                </div>
        <div id="options" class="section">
          <h2>Options</h2>
          <p>There is one option you can use to configure the HLS plugin.</p>
        <h4>withCredentials</h4>
          <p>Type: <code>boolean</code></p>
          <p>When the <code>withCredentials</code> property is set to <code>true</code>, all XHR requests for manifests and segments would have <code>withCredentials</code> set to <code>true</code> as well. This enables storing and passing cookies from the server that the manifests and segments live on. This has some implications on CORS because when set, the <code>Access-Control-Allow-Origin</code> header cannot be set to <code>*</code>, also, the response headers require the addition of <code>Access-Control-Allow-Credentials</code> header which is set to <code>true</code>. See the  <a href="http://www.html5rocks.com/en/tutorials/cors/">HTML5Rocks's article</a> for more info.</p>
          <p>You can configure the plugin using the <a href="../../player-management/index.html">Player Management API</a> using an HTTP <code>PATCH</code> method, as shown here:</p>
          <pre><code>curl \
  --header "Content-Type: application/json" \
  --user YOUR_EMAIL \
  --request PATCH \
  --data '{ "hls": { "withCredentials": true } }' \
  https://players.api.brightcove.com/v1/accounts/YOUR_ACCOUNT_ID/players/YOUR_PLAYER_ID/configuration</code></pre>
        </div>
        <div id="runtimeproperties" class="section">
        <h2>Runtime properties</h2>
          <h4>player.hls.playlists.master</h4>
          <p>Type: <code>object</code></p>
          <p>An object representing the parsed master playlist. If a media playlist is loaded directly, a master playlist with only one entry will be created.</p>
          <h4>player.hls.playlists.media</h4>
          <p>Type: <code>function</code></p>
          <p>A function that can be used to retrieve or modify the currently active media playlist. The active media playlist is referred to when additional video data needs to be downloaded. Calling this function with no arguments returns the parsed playlist object for the active media playlist. Calling this function with a playlist object from the master playlist or a URI string as specified in the master playlist will kick off an asynchronous load of the specified media playlist. Once it has been retrieved, it will become the active media playlist.</p>
          <h4>player.hls.mediaIndex</h4>
          <p>Type: <code>number</code>
          </p>
          <p>The index of the next video segment to be downloaded from
<code>player.hls.media</code>.</p>
          <h4>player.hls.segmentXhrTime</h4>
          <p>Type: <code>number</code></p>
          <p>The number of milliseconds it took to download the last media segment. This value is updated after each segment download completes.</p>
          <h4>player.hls.bandwidth</h4>
          <p>Type: <code>number</code></p>
          <p>The number of bits downloaded per second in the last segment download. This value is used by the default implementation of <code>selectPlaylist</code> to select an appropriate bitrate to play. Before the first video segment has been downloaded, it's hard to estimate bandwidth accurately. The HLS tech uses a heuristic based on the playlist download times to do this estimation by default. If you have a more accurate source of bandwidth information, you can override this value as soon as the HLS tech has loaded to provide an initial bandwidth estimate.</p>
          <h4>player.hls.bytesReceived</h4>
          <p>Type: <code>number</code></p>
          <p>The total number of content bytes downloaded by the HLS tech.</p>

          <h4 id="selectplaylist">player.hls.selectPlaylist</h4>
          <p>Type: <code>function</code>
          </p>
          <p>A function that returns the media playlist object to use to download the next segment. It is invoked by the plugin immediately before a new segment is downloaded. You can override this function to provide your adaptive streaming logic. You must, however, be sure to return a valid media playlist object that is present in <code>player.hls.master</code>.</p>
        </div>

        <div id="events" class="section">
        <h2>Events</h2>
          <h4>loadedmetadata</h4>
          <p>Fired after the first media playlist is downloaded for a stream.</p>
          <h4>loadedplaylist</h4>
          <p>Fired immediately after a new master or media playlist has been downloaded. By default, the plugin only downloads playlists as they are needed.</p>
          <h4>mediachange</h4>
          <p>Fired when a new playlist becomes the active media playlist. Note that the actual rendering quality change does not occur simultaneously with this event; a new segment must be requested and the existing buffer depleted first.</p>
      </div>
      <div id="adaptiveswitching" class="section">
        <h2>Adaptive switching</h2>
        <h3>MP4 Rendition Selection</h3>
        <p>Generally, if viewing a video on a mobile device and playing an MP4, the player will choose the MP4 that has a bitrate closest to .5 Mbit/s. If on a desktop or laptop device it will choose one that is closest to 3 Mbit/s.</p>
        <h3>HLS Rendition Selection</h3>
        <p>HLS video is broken into segments. These are typically about 10 seconds in duration but can be longer or shorter. The player always starts with the rendition closest to .5 Mbit/s. On segment boundaries it will switch to a higher or lower rendition described in the text and images below.</p>
        <p>The HLS tech tries to ensure the highest-quality viewing experience possible, given the available bandwidth and encodings. This doesn't always mean using the highest-bitrate rendition available. For instance, if the player is 300px by 150px, it would be a waste of bandwidth to download a 4k stream.</p>
        <p>By default, the player attempts to load the highest-bitrate variant that is less than the most recently detected segment bandwidth, with one condition: if there are multiple variants with dimensions greater than the current player size, it will only switch up one size greater than the current player size.</p>
        <p>The process is illustrated below:</p>
        <ol>
            <li>Whenever a new segment is downloaded, the download bitrate is calculated based on the size of the segment and the time it took to download:
            <div><img src="/en/video-cloud/brightcove-player/guides/assets/HLS-rendition-1.png" alt="HLS rendition1"></div></li>
            <li>All the renditions that have a higher bitrate than the new measurement are filtered out:
            <div><img src="/en/video-cloud/brightcove-player/guides/assets/HLS-rendition-2.png" alt="HLS rendition2"></div></li>
            <li>Any renditions that are bigger than the current player's dimensions are filtered out:
            <div><img src="/en/video-cloud/brightcove-player/guides/assets/HLS-rendition-3.png" alt="HLS rendition3"></div></li>
            <li>A significant quality drop is not wanted just because your player is one pixel too small, so we add back in the next highest resolution. The highest bitrate rendition that remains is the one that gets used:
            <div><img src="/en/video-cloud/brightcove-player/guides/assets/HLS-rendition-4.png" alt="HLS rendition4"></div></li>
        </ol>
        <p>If it turns out no rendition is acceptable based on the filtering described above, the first encoding listed in the master playlist will be used.</p>
        <p>If you'd like your player to use a different set of priorities, it's possible to completely replace the rendition selection logic. For instance, you could always choose the most appropriate rendition by resolution, even though this might mean more stalls during playback. See the documentation on <a href="#selectplaylist">player.hls.selectPlaylist</a> for more details.</p>
      </div>
      <div id="inbandmetadata" class="section">
        <h2>In-band metadata</h2>
        <p>Brightcove Player will recognize certain types of ID3 tag information embedded in an HLS video stream. The ID3 standard was originally used to provide metadata about MP3 audio tracks. (The acronym is from <strong>ID</strong>entify MP<strong>3</strong>.) When a stream is encountered with embedded metadata, an in-band metadata text track will automatically be created and populated with cues as they are encountered in the stream. A common use case is the ID3 data would direct when advertisements should be shown in a live stream.</p>
        <p>The ID3 standard defines many frame types, but only the following two UTF-8 encoded frames will be mapped to cue points and their values set as cue text:</p>
        <ul>
            <li>WXXX - User defined URL link frame</li>
            <li>TXXX - User defined text information frame</li>
        </ul>
        <p> Cues are created for all other frame types and the data is attached to the generated cue:</p>
        <pre><code>cue.frame.data</code></pre>
        <p>For more information about text tracks in general see <a href="//www.html5rocks.com/en/tutorials/track/basics/">Getting Started With the Track Element</a>. For information on Brightcove Player and cue points see <a href="cue-points-guide.html">Using Cue Points</a>.</p>
      </div>
      <div id="608captions" class="section">
        <h2>608 captions</h2>
        <p>Brightcove's HLS plugin has support for 608 captions. 608 captions, also known as CEA-608 captions, EIA-608 captions and Line 21 captions, are a standard for closed captioning for NTSC TV analog broadcasts in the United States and Canada. The 608 captions can be inserted into a live stream where they are mixed into the HLS' <strong>ts</strong> (transport stream) files.</p>
      </div>
      <div id="hosting" class="section">
          <h2>Hosting issues</h2>
          <div class="BCL-concept">
              <p>Unlike a native HLS implementation, the HLS plugin has to comply with the browser&#39;s security policies. That means that all the files that make up the stream must be served from the same domain as the page hosting the video player or from a server that has appropriate <a href="https://developer.mozilla.org/en-US/docs/HTTP/Access_control_CORS">CORS headers</a> configured. Easy <a href="http://enable-cors.org/server.html">instructions are available</a> for popular webservers and most CDNs should have no trouble turning CORS on for your account.</p> </div>
      </div>
      <div id="changelog" class="section">
        <h2>Changelog</h2>
        <h4>11 Mar 2016</h4>
        <p>v2.0.1</p>
        <ul>
          <li>First release of the ES6 version of the SourceHandler</li>
          <li>All new lint/build/test setup via the <a href="https://github.com/videojs/generator-videojs-plugin">generator-videojs-plugin</a> project</li>
        </ul>
        <h4>4 Mar 2016</h4>
        <p id="toc_1">v1.13.1</p>
        <ul>
          <li>Converted from a Tech to a SourceHandler for Video.js 5.x compatibility</li>
          <li>Implemented a Media Source Extensions-based playback engine with a Flash-based fallback</li>
          <li>Rewrote the Transmuxer and moved it into it&#39;s own project <a href="https://github.com/videojs/mux.js">mux.js</a>
          </li>
          <li>Added support for 608/708 captions</li>
        </ul>
        <h4>29 Jul 2015</h4>
        <p id="toc_2">v0.17.6</p>
        <ul>
          <li>autoplay at the live point. fix live id3 cue insertion. (<a href="https://github.com/videojs/videojs-contrib-hls/pull/353">view</a>)</li>
        </ul>
        <h4>14 Jul 2015</h4>
        <p id="toc_3">v0.17.5</p>
        <ul>
          <li>do not assume media sequence starts at zero (<a href="https://github.com/videojs/videojs-contrib-hls/pull/346">view</a>)</li>
          <li>fix error with audio- or video-only streams (<a href="https://github.com/videojs/videojs-contrib-hls/pull/348">view</a>)</li>
        </ul>
        <h4>12 Jul 2015</h4>
        <p id="toc_4">v0.17.4</p>
        <ul>
          <li>Fix seeks between segments. Improve duration calculation. (<a href="https://github.com/videojs/videojs-contrib-hls/pull/339">view</a>)</li>
        </ul>
        <h4>29 Jun 2015</h4>
        <p id="toc_5">v0.17.3</p>
        <ul>
          <li>Improved video duration calculation. (<a href="https://github.com/videojs/videojs-contrib-hls/pull/321">view</a>)</li>
          <li>Clamp seeks to the seekable range (<a href="https://github.com/videojs/videojs-contrib-hls/pull/327">view</a>)</li>
          <li>Use getComputedStyle for player dimensions when filtering variants (<a href="https://github.com/videojs/videojs-contrib-hls/pull/326">view</a>)</li>
          <li>Add a functional test that runs in SauceLabs (<a href="https://github.com/videojs/videojs-contrib-hls/pull/323">view</a>)</li>
        </ul>
        <h4>15 Jun 2015</h4>
        <p id="toc_6">v0.17.2</p>
        <ul>
          <li>Fix seeking in live streams (<a href="https://github.com/videojs/videojs-contrib-hls/pull/308">view</a>)</li>
        </ul>
        <h4>8 Jun 2015</h4>
        <p id="toc_7">v0.17.1</p>
        <ul>
          <li>Do not preload live videos (<a href="https://github.com/videojs/videojs-contrib-hls/pull/299">view</a>)</li>
        </ul>
        <h4>5 Jun 2015</h4>
        <p id="toc_8">v0.17.0</p>
        <ul>
          <li>Implement seekable for live streams. Fix in-band metadata timing for live streams. (<a href="https://github.com/videojs/videojs-contrib-hls/pull/295">view</a>)</li>
        </ul>
        <h4>29 May 2015</h4>
        <p id="toc_9">v0.16.1</p>
        <ul>
          <li>Do not unnecessarily reset to the live point when refreshing playlists. Clean up playlist loader timeouts. (<a href="https://github.com/videojs/videojs-contrib-hls/pull/274">view</a>)</li>
          <li>Ensure segments without an initial IDR are not displayed in 4:3 initially (<a href="https://github.com/videojs/videojs-contrib-hls/pull/272">view</a>)</li>
          <li>Wait for an SPS to inject metadata tags. (<a href="https://github.com/videojs/videojs-contrib-hls/pull/280">view</a>)</li>
          <li>Trim whitespace in playlist. (<a href="https://github.com/videojs/videojs-contrib-hls/pull/282">view</a>)</li>
          <li>Allow playback of TS files with NITs. Don&#x27;t warn about PCR PIDs. (<a href="https://github.com/videojs/videojs-contrib-hls/pull/284">view</a>)</li>
          <li>Quicker quality switches when bandwidth changes. (<a href="https://github.com/videojs/videojs-contrib-hls/pull/285">view</a>)</li>
          <li>Fix temporary warped display after seeking. (<a href="https://github.com/videojs/videojs-contrib-hls/pull/290">view</a>)</li>
        </ul>

        <h4 id="toc_10">v0.16.0</h4>
        <ul>
          <li>support preload=none</li>
        </ul>
        <h4 id="toc_11">v0.15.0</h4>
        <ul>
          <li>expose all ID3 frames and handle tags larger than 188 bytes</li>
        </ul>
        <h4 id="toc_12">v0.14.0</h4>
        <ul>
          <li>performance improvements for HLSe</li>
        </ul>
        <h4 id="toc_13">v0.13.0</h4>
        <ul>
          <li>Improved audio/video synchronization</li>
          <li>Fixes for live, HLSe, and discontinuities</li>
          <li>Rename internal methods to clarify their intended visibility</li>
        </ul>
        <h4 id="toc_14">v0.12.0</h4>
        <ul>
          <li>support for custom IVs with AES-128 encryption</li>
        </ul>
        <h4 id="toc_15">v0.11.0</h4>
        <ul>
          <li>embedded ID3 tags are exposed as an in-band metadata track</li>
        </ul>
        <h4 id="toc_16">v0.10.0</h4>
        <ul>
          <li>optimistic initial bitrate selection</li>
        </ul>
        <h4 id="toc_17">v0.9.0</h4>
        <ul>
          <li>support segment level AES-128 encryption</li>
        </ul>
        <h4 id="toc_18">v0.8.0</h4>
        <ul>
          <li>support for EXT-X-DISCONTINUITY</li>
        </ul>
        <h4 id="toc_19">v0.7.0</h4>
        <ul>
          <li>convert the HLS plugin to a tech</li>
        </ul>
        <h4 id="toc_20">v0.6.0</h4>
        <ul>
          <li>Refactor playlist loading</li>
          <li>Add testing via karma</li>
        </ul>
        <h4 id="toc_21">v0.5.0</h4>
        <ul>
          <li>cookie-based content protection support (see <code>withCredentials</code>)</li>
        </ul>
        <h4 id="toc_22">v0.4.0</h4>
        <ul>
          <li>Live stream support</li>
        </ul>
        <h4 id="toc_23">v0.3.0</h4>
        <ul>
          <li>Performance fixes for high-bitrate streams</li>
        </ul>
        <h4 id="toc_24">v0.2.0</h4>
        <ul>
          <li>Basic playback and adaptive bitrate selection</li>
        </ul>
        <h4 id="toc_25">v0.1.0</h4>
        <ul>
          <li>Initial release</li>
        </ul>
      </div>
      <div class="section" id="BCLreferences">
          <h2>Related Topics</h2>
          <ul>
              <li><a href="//www.html5rocks.com/en/tutorials/track/basics/">Getting Started With the Track Element</a>
              </li>
              <li><a href="ima-plugin.html">New Player Plugin: IMA</a>
              </li>
              <li><a href="../../brightcove-player/guides/plugin-dev-quick-start.html">Quick Start to Plugin Development</a>
              </li>
              <li><a href="../../player-management/getting-started/player-mgmt-quick-start.html">Quick Start to Player Management</a>
              </li>
          </ul>
      </div>
    </div>
  </div>
    <!-- bcl scripts============================================================-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/2.2/gist-embed.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.3/handlebars.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
    <script src="/en/scripts/docs-nav-data.min.js"></script>
    <script src="/en/scripts/bcls-doc-site-v1.js"></script>
    <script>
        $(document).foundation();
    </script>
    <script id="pageScript" type="text/javascript">
        /******** Any scripts specific to page samples should go here *********/
    </script>


	<iframe id="CSAT" src="http://survey.clicktools.com/app/survey/go.jsp?iv=3poon3e7e9spn&q1=[articleURL]" style="margin-left:25%; padding-bottom:20px;width:550px;height:475px;border:none"></iframe>
<script>

    var cSat = document.getElementById('CSAT'),
        cSatSrc = cSat.getAttribute('src'),
        pageurl = window.location.href;
    cSat.setAttribute('src', cSatSrc.replace('[articleURL]', pageurl));

</script>
<br><br>
<div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>

</html>
